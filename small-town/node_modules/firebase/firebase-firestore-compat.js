!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase,t.firebase.INTERNAL.modularAPIs)}(this,(function(t,e){"use strict";try{(function(){function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function o(t,e){for(var n=0,r=e.length,s=t.length;n<r;n++,s++)t[s]=e[n];return t}var a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],s=0;s<t.length;s+=3){var i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,h=i>>2,l=(3&i)<<4|a>>4,d=(15&a)<<2|u>>6,f=63&u;c||(f=64,o||(d=64)),r.push(n[h],n[l],n[d],n[f])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){var i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){var o=((7&s)<<18|(63&(i=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(o>>10)),e[r++]=String.fromCharCode(56320+(1023&o))}else{i=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],s=0;s<t.length;){var i=n[t.charAt(s++)],o=s<t.length?n[t.charAt(s)]:0,a=++s<t.length?n[t.charAt(s)]:64,c=++s<t.length?n[t.charAt(s)]:64;if(++s,null==i||null==o||null==a||null==c)throw Error();var u=i<<2|o>>4;if(r.push(u),64!==a){var h=o<<4&240|a>>2;if(r.push(h),64!==c){var l=a<<6&192|c;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){return!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var h=function(t){function e(n,r,s){var i=t.call(this,r)||this;return i.code=n,i.customData=s,i.name="FirebaseError",Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,l.prototype.create),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e}(Error),l=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},s=this.service+"/"+t,i=this.errors[t],o=i?d(i,r):"Error",a=this.serviceName+": "+o+" ("+s+").",c=new h(s,a,r);return c},t}();function d(t,e){return t.replace(f,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var f=/\{\$([^}]+)}/g;function g(t){return t&&t._delegate?t._delegate:t}var m,p,y=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}();!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(p||(p={}));var w={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},v=p.INFO,b=((m={})[p.DEBUG]="log",m[p.VERBOSE]="log",m[p.INFO]="info",m[p.WARN]="warn",m[p.ERROR]="error",m),E=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var s=(new Date).toISOString(),i=b[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,o(["["+s+"]  "+t.name+":"],n))}},T=function(){function t(t){this.name=t,this._logLevel=v,this._logHandler=E,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?w[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,o([this,p.DEBUG],t)),this._logHandler.apply(this,o([this,p.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,o([this,p.VERBOSE],t)),this._logHandler.apply(this,o([this,p.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,o([this,p.INFO],t)),this._logHandler.apply(this,o([this,p.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,o([this,p.WARN],t)),this._logHandler.apply(this,o([this,p.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,o([this,p.ERROR],t)),this._logHandler.apply(this,o([this,p.ERROR],t))},t}(),I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function _(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D=D||{},N=A||self;function x(){}function C(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function R(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),L=0;function O(t,e,n){return t.call.apply(t.bind,arguments)}function M(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function F(t,e,n){return(F=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?O:M).apply(null,arguments)}function P(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function V(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function U(){this.s=this.s,this.o=this.o}var q={};U.prototype.s=!1,U.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,k)&&t[k]||(t[k]=++L)}(this);delete q[t]}},U.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,s="string"==typeof t?t.split(""):t,i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function $(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var z,H=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function W(t,e){return t<e?-1:t>e?1:0}t:{var Y=N.navigator;if(Y){var X=Y.userAgent;if(X){z=X;break t}}z=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,s=1;s<arguments.length;s++){for(n in r=arguments[s])t[n]=r[n];for(var i=0;i<tt.length;i++)n=tt[i],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=x;var rt,st,it=Q(z,"Opera"),ot=Q(z,"Trident")||Q(z,"MSIE"),at=Q(z,"Edge"),ct=at||ot,ut=Q(z,"Gecko")&&!(Q(z.toLowerCase(),"webkit")&&!Q(z,"Edge"))&&!(Q(z,"Trident")||Q(z,"MSIE"))&&!Q(z,"Edge"),ht=Q(z.toLowerCase(),"webkit")&&!Q(z,"Edge");function lt(){var t=N.document;return t?t.documentMode:void 0}t:{var dt="",ft=(st=z,ut?/rv:([^\);]+)(\)|;)/.exec(st):at?/Edge\/([\d\.]+)/.exec(st):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):ht?/WebKit\/(\S+)/.exec(st):it?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(ft&&(dt=ft?ft[1]:""),ot){var gt=lt();if(null!=gt&&gt>parseFloat(dt)){rt=String(gt);break t}}rt=dt}var mt,pt={};function yt(){return function(t){var e=pt;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}((function(){for(var t=0,e=H(String(rt)).split("."),n=H("9").split("."),r=Math.max(e.length,n.length),s=0;0==t&&s<r;s++){var i=e[s]||"",o=n[s]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==i[0].length&&0==o[0].length)break;t=W(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||W(0==i[2].length,0==o[2].length)||W(i[2],o[2]),i=i[3],o=o[3]}while(0==t)}return 0<=t}))}if(N.document&&ot){var wt=lt();mt=wt||(parseInt(rt,10)||void 0)}else mt=void 0;var vt=mt,bt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",x,e),N.removeEventListener("test",x,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ut){t:{try{nt(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Tt.Z.h.call(this)}}Et.prototype.h=function(){this.defaultPrevented=!0},V(Tt,Et);var It={2:"touch",3:"pen",4:"mouse"};Tt.prototype.h=function(){Tt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var _t="closure_listenable_"+(1e6*Math.random()|0),St=0;function At(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=s,this.key=++St,this.ca=this.fa=!1}function Dt(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Nt(t){this.src=t,this.g={},this.h=0}function xt(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=B(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(Dt(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Ct(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==r)return s}return-1}Nt.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Ct(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new At(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var Rt="closure_lm_"+(1e6*Math.random()|0),kt={};function Lt(t,e,n,r,s){if(r&&r.once)return Mt(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Lt(t,e[i],n,r,s);return null}return n=jt(n),t&&t[_t]?t.N(e,n,R(r)?!!r.capture:!!r,s):Ot(t,e,n,!1,r,s)}function Ot(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=R(s)?!!s.capture:!!s,a=qt(t);if(a||(t[Rt]=a=new Nt(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}var e=Ut;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)bt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Mt(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Mt(t,e[i],n,r,s);return null}return n=jt(n),t&&t[_t]?t.O(e,n,R(r)?!!r.capture:!!r,s):Ot(t,e,n,!0,r,s)}function Ft(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Ft(t,e[i],n,r,s);else r=R(r)?!!r.capture:!!r,n=jt(n),t&&t[_t]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=Ct(i=t.g[e],n,r,s))&&(Dt(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--)))):t&&(t=qt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Ct(e,n,r,s)),(n=-1<t?e[t]:null)&&Pt(n))}function Pt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[_t])xt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=qt(e))?(xt(n,t),0==n.h&&(n.src=null,e[Rt]=null)):Dt(t)}}}function Vt(t){return t in kt?kt[t]:kt[t]="on"+t}function Ut(t,e){if(t.ca)t=!0;else{e=new Tt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Pt(t),t=n.call(r,e)}return t}function qt(t){return(t=t[Rt])instanceof Nt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function jt(t){return"function"==typeof t?t:(t[Bt]||(t[Bt]=function(e){return t.handleEvent(e)}),t[Bt])}function $t(){U.call(this),this.i=new Nt(this),this.P=this,this.I=null}function Kt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Et(e,t);else if(e instanceof Et)e.target=e.target||t;else{var s=e;et(e=new Et(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Gt(o,r,!0,e)&&s}if(s=Gt(o=e.g=t,r,!0,e)&&s,s=Gt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Gt(o=e.g=n[i],r,!1,e)&&s}function Gt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&xt(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}V($t,U),$t.prototype[_t]=!0,$t.prototype.removeEventListener=function(t,e,n,r){Ft(this,t,e,n,r)},$t.prototype.M=function(){if($t.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Dt(n[r]);delete e.g[t],e.h--}}this.I=null},$t.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},$t.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var zt=N.JSON.stringify;function Ht(){var t=ee,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Qt,Wt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Yt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())((function(){return new Xt}),(function(t){return t.reset()})),Xt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Jt(t){N.setTimeout((function(){throw t}),0)}function Zt(t,e){Qt||function(){var t=N.Promise.resolve(void 0);Qt=function(){t.then(ne)}}(),te||(Qt(),te=!0),ee.add(t,e)}var te=!1,ee=new Wt;function ne(){for(var t;t=Ht();){try{t.h.call(t.g)}catch(t){Jt(t)}var e=Yt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}te=!1}function re(t,e){$t.call(this),this.h=t||1,this.g=e||N,this.j=F(this.kb,this),this.l=Date.now()}function se(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ie(t,e,n){if("function"==typeof t)n&&(t=F(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=F(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}function oe(t){t.g=ie((function(){t.g=null,t.i&&(t.i=!1,oe(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}V(re,$t),(S=re.prototype).da=!1,S.S=null,S.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Kt(this,"tick"),this.da&&(se(this),this.start()))}},S.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},S.M=function(){re.Z.M.call(this),se(this),delete this.g};var ae=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:oe(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(U);function ce(t){U.call(this),this.h=t,this.g={}}V(ce,U);var ue=[];function he(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var s=0;s<n.length;s++){var i=Lt(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function le(t){J(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Pt(t)}),t),t.g={}}function de(){this.g=!0}function fe(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return zt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ce.prototype.M=function(){ce.Z.M.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},de.prototype.Aa=function(){this.g=!1},de.prototype.info=function(){};var ge={},me=null;function pe(){return me=me||new $t}function ye(t){Et.call(this,ge.Ma,t)}function we(t){var e=pe();Kt(e,new ye(e,t))}function ve(t,e){Et.call(this,ge.STAT_EVENT,t),this.stat=e}function be(t){var e=pe();Kt(e,new ve(e,t))}function Ee(t,e){Et.call(this,ge.Na,t),this.size=e}function Te(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return N.setTimeout((function(){t()}),e)}ge.Ma="serverreachability",V(ye,Et),ge.STAT_EVENT="statevent",V(ve,Et),ge.Na="timingevent",V(Ee,Et);var Ie={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},_e={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Se(){}function Ae(t){return t.h||(t.h=t.i())}function De(){}Se.prototype.h=null;var Ne,xe={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ce(){Et.call(this,"d")}function Re(){Et.call(this,"c")}function ke(){}function Le(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ce(this),this.P=Me,t=ct?125:void 0,this.W=new re(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Oe}function Oe(){this.i=null,this.g="",this.h=!1}V(Ce,Et),V(Re,Et),V(ke,Se),ke.prototype.g=function(){return new XMLHttpRequest},ke.prototype.i=function(){return{}},Ne=new ke;var Me=45e3,Fe={},Pe={};function Ve(t,e,n){t.K=1,t.v=cn(en(e)),t.s=n,t.U=!0,Ue(t,null)}function Ue(t,e){t.F=Date.now(),$e(t),t.A=en(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),En(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Oe,t.g=Tr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ae(F(t.Ia,t,t.g),t.O)),he(t.V,t.g,"readystatechange",t.gb),e=t.H?Z(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),we(1),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function qe(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function Be(t,e,n){for(var r,s=!0;!t.I&&t.C<n.length;){if((r=je(t,n))==Pe){4==e&&(t.o=4,be(14),s=!1),fe(t.j,t.m,null,"[Incomplete Response]");break}if(r==Fe){t.o=4,be(15),fe(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}fe(t.j,t.m,r,null),Qe(t,r)}qe(t)&&r!=Pe&&r!=Fe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,be(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),gr(e),e.L=!0,be(11))):(fe(t.j,t.m,n,"[Invalid Chunked Response]"),He(t),ze(t))}function je(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Fe:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.C=r+n,e))}function $e(t){t.Y=Date.now()+t.P,Ke(t,t.P)}function Ke(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Te(F(t.eb,t),e)}function Ge(t){t.B&&(N.clearTimeout(t.B),t.B=null)}function ze(t){0==t.l.G||t.I||yr(t.l,t)}function He(t){Ge(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,se(t.W),le(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Qe(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Nn(n.i,t)))if(n.I=t.N,!t.J&&Nn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(i){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;pr(n),ir(n)}fr(n),be(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=Te(F(n.ab,n),6e3));if(1>=Dn(n.i)&&n.ka){try{n.ka()}catch(i){}n.ka=void 0}}else vr(n,11)}else if((t.J||n.g==t)&&pr(n),!G(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){var i=s[e];if(n.U=i[0],i=i[1],2==n.G)if("c"==i[0]){n.J=i[1],n.la=i[2];var o=i[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=i[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c=i[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var u=t.g;if(u){var h=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Q(h,"spdy")||Q(h,"quic")||Q(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(xn(l,l.h),l.h=null))}if(r.D){var d=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;d&&(r.sa=d,an(r.F,r.D,d))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var f=t;if((r=n).oa=Er(r,r.H?r.la:null,r.W),f.J){Cn(r.i,f);var g=f,m=r.K;m&&g.setTimeout(m),g.B&&(Ge(g),$e(g)),r.g=f}else dr(r);0<n.l.length&&cr(n)}else"stop"!=i[0]&&"close"!=i[0]||vr(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?vr(n,7):sr(n):"noop"!=i[0]&&n.j&&n.j.wa(i),n.A=0)}we(4)}catch(i){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||"string"==typeof t)j(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(C(t)||"string"==typeof t){n=[];for(var r=t.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,t)n[r++]=s;s=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function Ye(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ye)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Xe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Je(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)Je(s,r=t.g[e])||(t.g[n++]=r,s[r]=1),e++;t.g.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=Le.prototype).setTimeout=function(t){this.P=t},S.gb=function(t){t=t.target;var e=this.L;e&&3==Zn(t)?e.l():this.Ia(t)},S.Ia=function(t){try{if(t==this.g)t:{var e=Zn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||ct||this.g&&(this.h.h||this.g.ga()||tr(this.g)))){this.I||4!=e||7==n||we(8==n||0>=r?3:2),Ge(this);var s=this.g.ba();this.N=s;e:if(qe(this)){var i=tr(this.g);t="";var o=i.length,a=4==Zn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){He(this),ze(this);var c="";break e}this.h.i=new N.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:a&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,c=this.h.g}else c=this.g.ga();if(this.i=200==s,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.X,e,s),this.i){if(this.$&&!this.J){e:{if(this.g){var u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(u)){var l=u;break e}}l=null}if(!(s=l)){this.i=!1,this.o=3,be(12),He(this),ze(this);break t}fe(this.j,this.m,s,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Qe(this,s)}this.U?(Be(this,e,c),ct&&this.i&&3==e&&(he(this.V,this.W,"tick",this.fb),this.W.start())):(fe(this.j,this.m,c,null),Qe(this,c)),4==e&&He(this),this.i&&!this.I&&(4==e?yr(this.l,this):(this.i=!1,$e(this)))}else 400==s&&0<c.indexOf("Unknown SID")?(this.o=3,be(12)):(this.o=0,be(13)),He(this),ze(this)}}}catch(e){}},S.fb=function(){if(this.g){var t=Zn(this.g),e=this.g.ga();this.C<e.length&&(Ge(this),Be(this,t,e),this.i&&4!=t&&$e(this))}},S.cancel=function(){this.I=!0,He(this)},S.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(we(3),be(17)),He(this),this.o=2,ze(this)):Ke(this,this.Y-t)},(S=Ye.prototype).R=function(){Xe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},S.T=function(){return Xe(this),this.g.concat()},S.get=function(t,e){return Je(this.h,t)?this.h[t]:e},S.set=function(t,e){Je(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},S.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};var Ze=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof tn){this.g=void 0!==e?e:t.g,nn(this,t.j),this.s=t.s,rn(this,t.i),sn(this,t.m),this.l=t.l,e=t.h;var n=new yn;n.i=e.i,e.g&&(n.g=new Ye(e.g),n.h=e.h),on(this,n),this.o=t.o}else t&&(n=String(t).match(Ze))?(this.g=!!e,nn(this,n[1]||"",!0),this.s=un(n[2]||""),rn(this,n[3]||"",!0),sn(this,n[4]),this.l=un(n[5]||"",!0),on(this,n[6]||"",!0),this.o=un(n[7]||"")):(this.g=!!e,this.h=new yn(null,this.g))}function en(t){return new tn(t)}function nn(t,e,n){t.j=n?un(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function rn(t,e,n){t.i=n?un(e,!0):e}function sn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function on(t,e,n){e instanceof yn?(t.h=e,function(t,e){e&&!t.j&&(wn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(vn(this,e),En(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=hn(e,mn)),t.h=new yn(e,t.g))}function an(t,e,n){t.h.set(e,n)}function cn(t){return an(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ln),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ln(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}tn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(hn(e,dn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(hn(e,dn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?gn:fn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",hn(n,pn)),t.join("")};var dn=/[#\/\?@]/g,fn=/[#\?:]/g,gn=/[#\?]/g,mn=/[#\?@]/g,pn=/#/g;function yn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function wn(t){t.g||(t.g=new Ye,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function vn(t,e){wn(t),e=Tn(t,e),Je(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Je((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Xe(t)))}function bn(t,e){return wn(t),e=Tn(t,e),Je(t.g.h,e)}function En(t,e,n){vn(t,e),0<n.length&&(t.i=null,t.g.set(Tn(t,e),K(n)),t.h+=n.length)}function Tn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(S=yn.prototype).add=function(t,e){wn(this),this.i=null,t=Tn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},S.forEach=function(t,e){wn(this),this.g.forEach((function(n,r){j(n,(function(n){t.call(e,n,r,this)}),this)}),this)},S.T=function(){wn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n},S.R=function(t){wn(this);var e=[];if("string"==typeof t)bn(this,t)&&(e=$(e,this.g.get(Tn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=$(e,t[n])}return e},S.set=function(t,e){return wn(this),this.i=null,bn(this,t=Tn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},S.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},S.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}}return this.i=t.join("&")};var In=function(t,e){this.h=t,this.g=e};function _n(t){this.l=t||Sn,N.PerformanceNavigationTiming?t=0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(N.g&&N.g.Ea&&N.g.Ea()&&N.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Sn=10;function An(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Dn(t){return t.h?1:t.g?t.g.size:0}function Nn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function xn(t,e){t.g?t.g.add(e):t.h=e}function Cn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Rn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var s=_(t.g.values()),i=s.next();!i.done;i=s.next()){var o=i.value;r=r.concat(o.D)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r}return K(t.i)}function kn(){}function Ln(){this.g=new kn}function On(t,e,n){var r=n||"";try{We(t,(function(t,n){var s=t;R(t)&&(s=zt(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Mn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function Fn(t){this.l=t.$b||null,this.j=t.ib||!1}function Pn(t,e){$t.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Vn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_n.prototype.cancel=function(){var t,e;if(this.i=Rn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=_(this.g.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},kn.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},kn.prototype.parse=function(t){return N.JSON.parse(t,void 0)},V(Fn,Se),Fn.prototype.g=function(){return new Pn(this.l,this.j)},Fn.prototype.i=function(t){return function(){return t}}({}),V(Pn,$t);var Vn=0;function Un(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function qn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Bn(t)}function Bn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(S=Pn.prototype).open=function(t,e){if(this.readyState!=Vn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Bn(this)},S.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||N).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qn(this)),this.readyState=Vn},S.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Bn(this)),this.g&&(this.readyState=3,Bn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==N.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Un(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},S.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?qn(this):Bn(this),3==this.readyState&&Un(this)}},S.Ua=function(t){this.g&&(this.response=this.responseText=t,qn(this))},S.Ta=function(t){this.g&&(this.response=t,qn(this))},S.ha=function(){this.g&&qn(this)},S.setRequestHeader=function(t,e){this.v.append(t,e)},S.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Pn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var jn=N.JSON.parse;function $n(t){$t.call(this),this.headers=new Ye,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Kn,this.K=this.L=!1}V($n,$t);var Kn="",Gn=/^https?$/i,zn=["POST","PUT"];function Hn(t){return"content-type"==t.toLowerCase()}function Qn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Wn(t),Xn(t)}function Wn(t){t.D||(t.D=!0,Kt(t,"complete"),Kt(t,"error"))}function Yn(t){if(t.h&&void 0!==D&&(!t.C[1]||4!=Zn(t)||2!=t.ba()))if(t.v&&4==Zn(t))ie(t.Fa,0,t);else if(Kt(t,"readystatechange"),4==Zn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var s;if(s=0===n){var i=String(t.H).match(Ze)[1]||null;if(!i&&N.self&&N.self.location){var o=N.self.location.protocol;i=o.substr(0,o.length-1)}s=!Gn.test(i?i.toLowerCase():"")}e=s}if(e)Kt(t,"complete"),Kt(t,"success");else{t.m=6;try{var a=2<Zn(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Wn(t)}}finally{Xn(t)}}}function Xn(t,e){if(t.g){Jn(t);var n=t.g,r=t.C[0]?x:null;t.g=null,t.C=null,e||Kt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Jn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(N.clearTimeout(t.A),t.A=null)}function Zn(t){return t.g?t.g.readyState:0}function tr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Kn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return J(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):an(t,e,n))}function nr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function rr(t){this.za=0,this.l=[],this.h=new de,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=nr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=nr("baseRetryDelayMs",5e3,t),this.$a=nr("retryDelaySeedMs",1e4,t),this.Ya=nr("forwardChannelMaxRetries",2,t),this.ra=nr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new _n(t&&t.concurrentRequestLimit),this.Ca=new Ln,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function sr(t){if(or(t),3==t.G){var e=t.V++,n=en(t.F);an(n,"SID",t.J),an(n,"RID",e),an(n,"TYPE","terminate"),hr(t,n),(e=new Le(t,t.h,e,void 0)).K=2,e.v=cn(en(n)),n=!1,N.navigator&&N.navigator.sendBeacon&&(n=N.navigator.sendBeacon(e.v.toString(),"")),!n&&N.Image&&((new Image).src=e.v,n=!0),n||(e.g=Tr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),$e(e)}br(t)}function ir(t){t.g&&(gr(t),t.g.cancel(),t.g=null)}function or(t){ir(t),t.u&&(N.clearTimeout(t.u),t.u=null),pr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&N.clearTimeout(t.m),t.m=null)}function ar(t,e){t.l.push(new In(t.Za++,e)),3==t.G&&cr(t)}function cr(t){An(t.i)||t.m||(t.m=!0,Zt(t.Ha,t),t.C=0)}function ur(t,e){var n;n=e?e.m:t.V++;var r=en(t.F);an(r,"SID",t.J),an(r,"RID",n),an(r,"AID",t.U),hr(t,r),t.o&&t.s&&er(r,t.o,t.s),n=new Le(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=lr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),xn(t.i,n),Ve(n,r,e)}function hr(t,e){t.j&&We({},(function(t,n){an(e,n,t)}))}function lr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?F(t.j.Oa,t.j,t):null;t:for(var s=t.l,i=-1;;){var o=["count="+n];-1==i?0<n?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);for(var a=!0,c=0;c<n;c++){var u=s[c].h,h=s[c].g;if(0>(u-=i))i=Math.max(0,s[c].h-100),a=!1;else try{On(h,o,"req"+u+"_")}catch(t){r&&r(h)}}if(a){r=o.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function dr(t){t.g||t.u||(t.Y=1,Zt(t.Ga,t),t.A=0)}function fr(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=Te(F(t.Ga,t),wr(t,t.A)),t.A++,!0)}function gr(t){null!=t.B&&(N.clearTimeout(t.B),t.B=null)}function mr(t){t.g=new Le(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=en(t.oa);an(e,"RID","rpc"),an(e,"SID",t.J),an(e,"CI",t.N?"0":"1"),an(e,"AID",t.U),hr(t,e),an(e,"TYPE","xmlhttp"),t.o&&t.s&&er(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=cn(en(e)),n.s=null,n.U=!0,Ue(n,t)}function pr(t){null!=t.v&&(N.clearTimeout(t.v),t.v=null)}function yr(t,e){var n=null;if(t.g==e){pr(t),gr(t),t.g=null;var r=2}else{if(!Nn(t.i,e))return;n=e.D,Cn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;Kt(r=pe(),new Ee(r,n,e,s)),cr(t)}else dr(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==r&&function(t,e){return!(Dn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Te(F(t.Ha,t,e),wr(t,t.C)),t.C++,0)))}(t,e)||2==r&&fr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:vr(t,5);break;case 4:vr(t,10);break;case 3:vr(t,6);break;default:vr(t,2)}}function wr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function vr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=F(t.jb,t);n||(n=new tn("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||nn(n,"https"),cn(n)),function(t,e){var n=new de;if(N.Image){var r=new Image;r.onload=P(Mn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=P(Mn,n,r,"TestLoadImage: error",!1,e),r.onabort=P(Mn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=P(Mn,n,r,"TestLoadImage: timeout",!1,e),N.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else be(2);t.G=0,t.j&&t.j.va(e),br(t),or(t)}function br(t){t.G=0,t.I=-1,t.j&&(0==Rn(t.i).length&&0==t.l.length||(t.i.i.length=0,K(t.l),t.l.length=0),t.j.ua())}function Er(t,e,n){var r=function(t){return t instanceof tn?en(t):new tn(t,void 0)}(n);if(""!=r.i)e&&rn(r,e+"."+r.i),sn(r,r.m);else{var s=N.location;r=function(t,e,n,r){var s=new tn(null,void 0);return t&&nn(s,t),e&&rn(s,e),n&&sn(s,n),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,n)}return t.aa&&J(t.aa,(function(t,e){an(r,e,t)})),e=t.D,n=t.sa,e&&n&&an(r,e,n),an(r,"VER",t.ma),hr(t,r),r}function Tr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new $n(new Fn({ib:!0})):new $n(t.qa)).L=t.H,e}function Ir(){}function _r(){if(ot&&!(10<=Number(vt)))throw Error("Environmental error: no available transport.")}function Sr(t,e){$t.call(this),this.g=new rr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Nr(this)}function Ar(t){Ce.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Dr(){Re.call(this),this.status=1}function Nr(t){this.g=t}(S=$n.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ne.g(),this.C=this.u?Ae(this.u):Ae(Ne),this.g.onreadystatechange=F(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Qn(this,t)}t=n||"";var s=new Ye(this.headers);r&&We(r,(function(t,e){s.set(e,t)})),r=function(t){t:{for(var e=Hn,n=t.length,r="string"==typeof t?t.split(""):t,s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=N.FormData&&t instanceof N.FormData,!(0<=B(zn,e))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Jn(this),0<this.B&&((this.K=function(t){return ot&&yt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=F(this.pa,this)):this.A=ie(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Qn(this,t)}},S.pa=function(){void 0!==D&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Kt(this,"timeout"),this.abort(8))},S.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Kt(this,"complete"),Kt(this,"abort"),Xn(this))},S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Xn(this,!0)),$n.Z.M.call(this)},S.Fa=function(){this.s||(this.F||this.v||this.l?Yn(this):this.cb())},S.cb=function(){Yn(this)},S.ba=function(){try{return 2<Zn(this)?this.g.status:-1}catch(t){return-1}},S.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},S.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),jn(e)}},S.Da=function(){return this.m},S.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(S=rr.prototype).ma=8,S.G=1,S.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},S.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Le(this,this.h,t,void 0),n=this.s;if(this.P&&(n?et(n=Z(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,s=0;s<this.l.length;s++){var i=this.l[s];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(r+=i)){r=s;break t}if(4096===r||s===this.l.length-1){r=s+1;break t}}r=1e3}else r=1e3;r=lr(this,e,r),an(s=en(this.F),"RID",t),an(s,"CVER",22),this.D&&an(s,"X-HTTP-Session-Id",this.D),hr(this,s),this.o&&n&&er(s,this.o,n),xn(this.i,e),this.Ra&&an(s,"TYPE","init"),this.ja?(an(s,"$req",r),an(s,"SID","null"),e.$=!0,Ve(e,s,null)):Ve(e,s,r),this.G=2}}else 3==this.G&&(t?ur(this,t):0==this.l.length||An(this.i)||ur(this))},S.Ga=function(){if(this.u=null,mr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Te(F(this.bb,this),t)}},S.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,be(10),ir(this),mr(this))},S.ab=function(){null!=this.v&&(this.v=null,ir(this),fr(this),be(19))},S.jb=function(t){t?(this.h.info("Successfully pinged google.com"),be(2)):(this.h.info("Failed to ping google.com"),be(1))},(S=Ir.prototype).xa=function(){},S.wa=function(){},S.va=function(){},S.ua=function(){},S.Oa=function(){},_r.prototype.g=function(t,e){return new Sr(t,e)},V(Sr,$t),Sr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Zt(F(t.hb,t,e))),be(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Er(t,null,t.W),cr(t)},Sr.prototype.close=function(){sr(this.g)},Sr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,ar(this.g,e)}else this.v?((e={}).__data__=zt(t),ar(this.g,e)):ar(this.g,t)},Sr.prototype.M=function(){this.g.j=null,delete this.j,sr(this.g),delete this.g,Sr.Z.M.call(this)},V(Ar,Ce),V(Dr,Re),V(Nr,Ir),Nr.prototype.xa=function(){Kt(this.g,"a")},Nr.prototype.wa=function(t){Kt(this.g,new Ar(t))},Nr.prototype.va=function(t){Kt(this.g,new Dr(t))},Nr.prototype.ua=function(){Kt(this.g,"b")},_r.prototype.createWebChannel=_r.prototype.g,Sr.prototype.send=Sr.prototype.u,Sr.prototype.open=Sr.prototype.m,Sr.prototype.close=Sr.prototype.close,Ie.NO_ERROR=0,Ie.TIMEOUT=8,Ie.HTTP_ERROR=6,_e.COMPLETE="complete",De.EventType=xe,xe.OPEN="a",xe.CLOSE="b",xe.ERROR="c",xe.MESSAGE="d",$t.prototype.listen=$t.prototype.N,$n.prototype.listenOnce=$n.prototype.O,$n.prototype.getLastError=$n.prototype.La,$n.prototype.getLastErrorCode=$n.prototype.Da,$n.prototype.getStatus=$n.prototype.ba,$n.prototype.getResponseJson=$n.prototype.Qa,$n.prototype.getResponseText=$n.prototype.ga,$n.prototype.send=$n.prototype.ea;var xr=Ie,Cr=_e,Rr=ge,kr=10,Lr=11,Or=Fn,Mr=De,Fr=$n;let Pr="8.7.1";class Vr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.t(t),this.i=t=>e.writeSequenceNumber(t))}t(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.i&&this.i(t),t}}Vr.o=-1;const Ur={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qr extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}const Br=new T("@firebase/firestore");function jr(){return Br.logLevel}function $r(t,...e){if(Br.logLevel<=p.DEBUG){const n=e.map(zr);Br.debug(`Firestore (${Pr}): ${t}`,...n)}}function Kr(t,...e){if(Br.logLevel<=p.ERROR){const n=e.map(zr);Br.error(`Firestore (${Pr}): ${t}`,...n)}}function Gr(t,...e){if(Br.logLevel<=p.WARN){const n=e.map(zr);Br.warn(`Firestore (${Pr}): ${t}`,...n)}}function zr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Hr(t="Unexpected state"){const e=`FIRESTORE (${Pr}) INTERNAL ASSERTION FAILED: `+t;throw Kr(e),new Error(e)}function Qr(t,e){t||Hr()}function Wr(t,e){return t}function Yr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Xr{static u(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Yr(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function Jr(t,e){return t<e?-1:t>e?1:0}function Zr(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function ts(t){return t+"\0"}class es{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new qr(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return es.fromMillis(Date.now())}static fromDate(t){return es.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new es(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Jr(this.nanoseconds,t.nanoseconds):Jr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ns{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ns(t)}static min(){return new ns(new es(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function rs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ss(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function is(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class os{constructor(t,e,n){void 0===e?e=0:e>t.length&&Hr(),void 0===n?n=t.length-e:n>t.length-e&&Hr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===os.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof os?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class as extends os{construct(t,e,n){return new as(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new qr(Ur.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new as(e)}static emptyPath(){return new as([])}}const cs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class us extends os{construct(t,e,n){return new us(t,e,n)}static isValidIdentifier(t){return cs.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),us.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new us(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new qr(Ur.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new qr(Ur.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new qr(Ur.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new qr(Ur.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new us(e)}static emptyPath(){return new us([])}}class hs{constructor(t){this.fields=t,t.sort(us.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class ls{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new ls(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ls(e)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Jr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ls.EMPTY_BYTE_STRING=new ls("");const ds=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fs(t){if(Qr(!!t),"string"==typeof t){let e=0;const n=ds.exec(t);if(Qr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:gs(t.seconds),nanos:gs(t.nanos)}}function gs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ms(t){return"string"==typeof t?ls.fromBase64String(t):ls.fromUint8Array(t)}function ps(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ys(t){const e=t.mapValue.fields.__previous_value__;return ps(e)?ys(e):e}function ws(t){const e=fs(t.mapValue.fields.__local_write_time__.timestampValue);return new es(e.seconds,e.nanos)}function vs(t){return null==t}function bs(t){return 0===t&&1/t==-1/0}function Es(t){return"number"==typeof t&&Number.isInteger(t)&&!bs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Ts{constructor(t){this.path=t}static fromPath(t){return new Ts(as.fromString(t))}static fromName(t){return new Ts(as.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===as.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return as.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Ts(new as(t.slice()))}}function Is(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ps(t)?4:10:Hr()}function _s(t,e){const n=Is(t);if(n!==Is(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ws(t).isEqual(ws(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=fs(t.timestampValue),r=fs(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ms(t.bytesValue).isEqual(ms(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return gs(t.geoPointValue.latitude)===gs(e.geoPointValue.latitude)&&gs(t.geoPointValue.longitude)===gs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return gs(t.integerValue)===gs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=gs(t.doubleValue),r=gs(e.doubleValue);return n===r?bs(n)===bs(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Zr(t.arrayValue.values||[],e.arrayValue.values||[],_s);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(rs(n)!==rs(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!_s(n[t],r[t])))return!1;return!0}(t,e);default:return Hr()}}function Ss(t,e){return void 0!==(t.values||[]).find((t=>_s(t,e)))}function As(t,e){const n=Is(t),r=Is(e);if(n!==r)return Jr(n,r);switch(n){case 0:return 0;case 1:return Jr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=gs(t.integerValue||t.doubleValue),r=gs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ds(t.timestampValue,e.timestampValue);case 4:return Ds(ws(t),ws(e));case 5:return Jr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ms(t),r=ms(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Jr(n[t],r[t]);if(0!==e)return e}return Jr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Jr(gs(t.latitude),gs(e.latitude));return 0!==n?n:Jr(gs(t.longitude),gs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=As(n[t],r[t]);if(e)return e}return Jr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=Jr(r[t],i[t]);if(0!==e)return e;const o=As(n[r[t]],s[i[t]]);if(0!==o)return o}return Jr(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Hr()}}function Ds(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Jr(t,e);const n=fs(t),r=fs(e),s=Jr(n.seconds,r.seconds);return 0!==s?s:Jr(n.nanos,r.nanos)}function Ns(t){return xs(t)}function xs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=fs(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ms(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Ts.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=xs(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${xs(t.fields[s])}`;return n+"}"}(t.mapValue):Hr();var e,n}function Cs(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Rs(t){return!!t&&"integerValue"in t}function ks(t){return!!t&&"arrayValue"in t}function Ls(t){return!!t&&"nullValue"in t}function Os(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ms(t){return!!t&&"mapValue"in t}function Fs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ss(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Fs(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Fs(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Ps{constructor(t){this.value=t}static empty(){return new Ps({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ms(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Fs(e)}setAll(t){let e=us.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Fs(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Ms(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return _s(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Ms(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ss(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ps(Fs(this.value))}}function Vs(t){const e=[];return ss(t.fields,((t,n)=>{const r=new us([t]);if(Ms(n)){const t=Vs(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new hs(e)}class Us{constructor(t,e,n,r,s){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=s}static newInvalidDocument(t){return new Us(t,0,ns.min(),Ps.empty(),0)}static newFoundDocument(t,e,n){return new Us(t,1,e,n,0)}static newNoDocument(t,e){return new Us(t,2,e,Ps.empty(),0)}static newUnknownDocument(t,e){return new Us(t,3,e,Ps.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ps.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ps.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Us&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new Us(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qs{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.h=null}}function Bs(t,e=null,n=[],r=[],s=null,i=null,o=null){return new qs(t,e,n,r,s,i,o)}function js(t){const e=Wr(t);if(null===e.h){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+Ns(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),vs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ei(e.startAt)),e.endAt&&(t+="|ub:",t+=ei(e.endAt)),e.h=t}return e.h}function $s(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ri(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!_s(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ii(t.startAt,e.startAt)&&ii(t.endAt,e.endAt)}function Ks(t){return Ts.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Gs extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new zs(t,e,n):"array-contains"===e?new Ys(t,n):"in"===e?new Xs(t,n):"not-in"===e?new Js(t,n):"array-contains-any"===e?new Zs(t,n):new Gs(t,e,n)}static l(t,e,n){return"in"===e?new Hs(t,n):new Qs(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(As(e,this.value)):null!==e&&Is(this.value)===Is(e)&&this.m(As(e,this.value))}m(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Hr()}}g(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class zs extends Gs{constructor(t,e,n){super(t,e,n),this.key=Ts.fromName(n.referenceValue)}matches(t){const e=Ts.comparator(t.key,this.key);return this.m(e)}}class Hs extends Gs{constructor(t,e){super(t,"in",e),this.keys=Ws("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Qs extends Gs{constructor(t,e){super(t,"not-in",e),this.keys=Ws("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ws(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Ts.fromName(t.referenceValue)))}class Ys extends Gs{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ks(e)&&Ss(e.arrayValue,this.value)}}class Xs extends Gs{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ss(this.value.arrayValue,e)}}class Js extends Gs{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ss(this.value.arrayValue,e)}}class Zs extends Gs{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ks(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Ss(this.value.arrayValue,t)))}}class ti{constructor(t,e){this.position=t,this.before=e}}function ei(t){return`${t.before?"b":"a"}:${t.position.map((t=>Ns(t))).join(",")}`}class ni{constructor(t,e="asc"){this.field=t,this.dir=e}}function ri(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function si(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?Ts.comparator(Ts.fromName(o.referenceValue),n.key):As(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ii(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!_s(t.position[n],e.position[n]))return!1;return!0}class oi{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt}}function ai(t,e,n,r,s,i,o,a){return new oi(t,e,n,r,s,i,o,a)}function ci(t){return new oi(t)}function ui(t){return!vs(t.limit)&&"F"===t.limitType}function hi(t){return!vs(t.limit)&&"L"===t.limitType}function li(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function di(t){for(const e of t.filters)if(e.g())return e.field;return null}function fi(t){return null!==t.collectionGroup}function gi(t){const e=Wr(t);if(null===e.p){e.p=[];const t=di(e),n=li(e);if(null!==t&&null===n)t.isKeyField()||e.p.push(new ni(t)),e.p.push(new ni(us.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.p.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ni(us.keyField(),t))}}}return e.p}function mi(t){const e=Wr(t);if(!e.T)if("F"===e.limitType)e.T=Bs(e.path,e.collectionGroup,gi(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of gi(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ni(n.field,e))}const n=e.endAt?new ti(e.endAt.position,!e.endAt.before):null,r=e.startAt?new ti(e.startAt.position,!e.startAt.before):null;e.T=Bs(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.T}function pi(t,e,n){return new oi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function yi(t,e){return $s(mi(t),mi(e))&&t.limitType===e.limitType}function wi(t){return`${js(mi(t))}|lt:${t.limitType}`}function vi(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Ns(e.value)}`;var e})).join(", ")}]`),vs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+ei(t.startAt)),t.endAt&&(e+=", endAt: "+ei(t.endAt)),`Target(${e})`}(mi(t))}; limitType=${t.limitType})`}function bi(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ts.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!si(t.startAt,gi(t),e))&&(!t.endAt||!si(t.endAt,gi(t),e))}(t,e)}function Ei(t){return(e,n)=>{let r=!1;for(const s of gi(t)){const t=Ti(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function Ti(t,e,n){const r=t.field.isKeyField()?Ts.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?As(r,s):Hr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Hr()}}function Ii(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bs(e)?"-0":e}}function _i(t){return{integerValue:""+t}}function Si(t,e){return Es(e)?_i(e):Ii(t,e)}class Ai{constructor(){this._=void 0}}function Di(t,e,n){return t instanceof Ci?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ri?ki(t,e):t instanceof Li?Oi(t,e):function(t,e){const n=xi(t,e),r=Fi(n)+Fi(t.A);return Rs(n)&&Rs(t.A)?_i(r):Ii(t.R,r)}(t,e)}function Ni(t,e,n){return t instanceof Ri?ki(t,e):t instanceof Li?Oi(t,e):n}function xi(t,e){return t instanceof Mi?Rs(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Ci extends Ai{}class Ri extends Ai{constructor(t){super(),this.elements=t}}function ki(t,e){const n=Pi(e);for(const e of t.elements)n.some((t=>_s(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Li extends Ai{constructor(t){super(),this.elements=t}}function Oi(t,e){let n=Pi(e);for(const e of t.elements)n=n.filter((t=>!_s(t,e)));return{arrayValue:{values:n}}}class Mi extends Ai{constructor(t,e){super(),this.R=t,this.A=e}}function Fi(t){return gs(t.integerValue||t.doubleValue)}function Pi(t){return ks(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Vi{constructor(t,e){this.field=t,this.transform=e}}class Ui{constructor(t,e){this.version=t,this.transformResults=e}}class qi{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new qi}static exists(t){return new qi(void 0,t)}static updateTime(t){return new qi(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Bi(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class ji{}function $i(t,e,n){t instanceof Qi?function(t,e,n){const r=t.value.clone(),s=Xi(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Wi?function(t,e,n){if(!Bi(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Xi(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Yi(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ki(t,e,n){t instanceof Qi?function(t,e,n){if(!Bi(t.precondition,e))return;const r=t.value.clone(),s=Ji(t.fieldTransforms,n,e);r.setAll(s),e.convertToFoundDocument(Hi(e),r).setHasLocalMutations()}(t,e,n):t instanceof Wi?function(t,e,n){if(!Bi(t.precondition,e))return;const r=Ji(t.fieldTransforms,n,e),s=e.data;s.setAll(Yi(t)),s.setAll(r),e.convertToFoundDocument(Hi(e),s).setHasLocalMutations()}(t,e,n):function(t,e){Bi(t.precondition,e)&&e.convertToNoDocument(ns.min())}(t,e)}function Gi(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=xi(r.transform,t||null);null!=s&&(null==n&&(n=Ps.empty()),n.set(r.field,s))}return n||null}function zi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Zr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ri&&e instanceof Ri||t instanceof Li&&e instanceof Li?Zr(t.elements,e.elements,_s):t instanceof Mi&&e instanceof Mi?_s(t.A,e.A):t instanceof Ci&&e instanceof Ci}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Hi(t){return t.isFoundDocument()?t.version:ns.min()}class Qi extends ji{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Wi extends ji{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function Yi(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Xi(t,e,n){const r=new Map;Qr(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Ni(o,a,n[s]))}return r}function Ji(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,Di(t,i,e))}return r}class Zi extends ji{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class to extends ji{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class eo{constructor(t){this.count=t}}var no,ro;function so(t){switch(t){case Ur.OK:return Hr();case Ur.CANCELLED:case Ur.UNKNOWN:case Ur.DEADLINE_EXCEEDED:case Ur.RESOURCE_EXHAUSTED:case Ur.INTERNAL:case Ur.UNAVAILABLE:case Ur.UNAUTHENTICATED:return!1;case Ur.INVALID_ARGUMENT:case Ur.NOT_FOUND:case Ur.ALREADY_EXISTS:case Ur.PERMISSION_DENIED:case Ur.FAILED_PRECONDITION:case Ur.ABORTED:case Ur.OUT_OF_RANGE:case Ur.UNIMPLEMENTED:case Ur.DATA_LOSS:return!0;default:return Hr()}}function io(t){if(void 0===t)return Kr("GRPC error has no .code"),Ur.UNKNOWN;switch(t){case no.OK:return Ur.OK;case no.CANCELLED:return Ur.CANCELLED;case no.UNKNOWN:return Ur.UNKNOWN;case no.DEADLINE_EXCEEDED:return Ur.DEADLINE_EXCEEDED;case no.RESOURCE_EXHAUSTED:return Ur.RESOURCE_EXHAUSTED;case no.INTERNAL:return Ur.INTERNAL;case no.UNAVAILABLE:return Ur.UNAVAILABLE;case no.UNAUTHENTICATED:return Ur.UNAUTHENTICATED;case no.INVALID_ARGUMENT:return Ur.INVALID_ARGUMENT;case no.NOT_FOUND:return Ur.NOT_FOUND;case no.ALREADY_EXISTS:return Ur.ALREADY_EXISTS;case no.PERMISSION_DENIED:return Ur.PERMISSION_DENIED;case no.FAILED_PRECONDITION:return Ur.FAILED_PRECONDITION;case no.ABORTED:return Ur.ABORTED;case no.OUT_OF_RANGE:return Ur.OUT_OF_RANGE;case no.UNIMPLEMENTED:return Ur.UNIMPLEMENTED;case no.DATA_LOSS:return Ur.DATA_LOSS;default:return Hr()}}(ro=no||(no={}))[ro.OK=0]="OK",ro[ro.CANCELLED=1]="CANCELLED",ro[ro.UNKNOWN=2]="UNKNOWN",ro[ro.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ro[ro.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ro[ro.NOT_FOUND=5]="NOT_FOUND",ro[ro.ALREADY_EXISTS=6]="ALREADY_EXISTS",ro[ro.PERMISSION_DENIED=7]="PERMISSION_DENIED",ro[ro.UNAUTHENTICATED=16]="UNAUTHENTICATED",ro[ro.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ro[ro.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ro[ro.ABORTED=10]="ABORTED",ro[ro.OUT_OF_RANGE=11]="OUT_OF_RANGE",ro[ro.UNIMPLEMENTED=12]="UNIMPLEMENTED",ro[ro.INTERNAL=13]="INTERNAL",ro[ro.UNAVAILABLE=14]="UNAVAILABLE",ro[ro.DATA_LOSS=15]="DATA_LOSS";class oo{constructor(t,e){this.comparator=t,this.root=e||co.EMPTY}insert(t,e){return new oo(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,co.BLACK,null,null))}remove(t){return new oo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,co.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ao(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ao(this.root,t,this.comparator,!1)}getReverseIterator(){return new ao(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ao(this.root,t,this.comparator,!0)}}class ao{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class co{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:co.RED,this.left=null!=r?r:co.EMPTY,this.right=null!=s?s:co.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new co(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return co.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return co.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,co.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,co.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Hr();if(this.right.isRed())throw Hr();const t=this.left.check();if(t!==this.right.check())throw Hr();return t+(this.isRed()?0:1)}}co.EMPTY=null,co.RED=!0,co.BLACK=!1,co.EMPTY=new class{constructor(){this.size=0}get key(){throw Hr()}get value(){throw Hr()}get color(){throw Hr()}get left(){throw Hr()}get right(){throw Hr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new co(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class uo{constructor(t){this.comparator=t,this.data=new oo(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ho(this.data.getIterator())}getIteratorFrom(t){return new ho(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof uo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new uo(this.comparator);return e.data=t,e}}class ho{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const lo=new oo(Ts.comparator);function fo(){return lo}const go=new oo(Ts.comparator);function mo(){return go}const po=new oo(Ts.comparator);function yo(){return po}const wo=new uo(Ts.comparator);function vo(...t){let e=wo;for(const n of t)e=e.add(n);return e}const bo=new uo(Jr);function Eo(){return bo}class To{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Io.createSynthesizedTargetChangeForCurrentChange(t,e)),new To(ns.min(),n,Eo(),fo(),vo())}}class Io{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Io(ls.EMPTY_BYTE_STRING,e,vo(),vo(),vo())}}class _o{constructor(t,e,n,r){this.P=t,this.removedTargetIds=e,this.key=n,this.v=r}}class So{constructor(t,e){this.targetId=t,this.V=e}}class Ao{constructor(t,e,n=ls.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class Do{constructor(){this.S=0,this.D=Co(),this.C=ls.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}get current(){return this.N}get resumeToken(){return this.C}get $(){return 0!==this.S}get O(){return this.k}F(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)}M(){let t=vo(),e=vo(),n=vo();return this.D.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Hr()}})),new Io(this.C,this.N,t,e,n)}L(){this.k=!1,this.D=Co()}B(t,e){this.k=!0,this.D=this.D.insert(t,e)}U(t){this.k=!0,this.D=this.D.remove(t)}q(){this.S+=1}K(){this.S-=1}j(){this.k=!0,this.N=!0}}class No{constructor(t){this.W=t,this.G=new Map,this.H=fo(),this.J=xo(),this.Y=new uo(Jr)}X(t){for(const e of t.P)t.v&&t.v.isFoundDocument()?this.Z(e,t.v):this.tt(e,t.key,t.v);for(const e of t.removedTargetIds)this.tt(e,t.key,t.v)}et(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.st(e)&&n.F(t.resumeToken);break;case 1:n.K(),n.$||n.L(),n.F(t.resumeToken);break;case 2:n.K(),n.$||this.removeTarget(e);break;case 3:this.st(e)&&(n.j(),n.F(t.resumeToken));break;case 4:this.st(e)&&(this.it(e),n.F(t.resumeToken));break;default:Hr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(((t,n)=>{this.st(n)&&e(n)}))}rt(t){const e=t.targetId,n=t.V.count,r=this.ot(e);if(r){const t=r.target;if(Ks(t))if(0===n){const n=new Ts(t.path);this.tt(e,n,Us.newNoDocument(n,ns.min()))}else Qr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}}ut(t){const e=new Map;this.G.forEach(((n,r)=>{const s=this.ot(r);if(s){if(n.current&&Ks(s.target)){const e=new Ts(s.target.path);null!==this.H.get(e)||this.at(r,e)||this.tt(r,e,Us.newNoDocument(e,t))}n.O&&(e.set(r,n.M()),n.L())}}));let n=vo();this.J.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.ot(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))}));const r=new To(t,e,this.Y,this.H,n);return this.H=fo(),this.J=xo(),this.Y=new uo(Jr),r}Z(t,e){if(!this.st(t))return;const n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}tt(t,e,n){if(!this.st(t))return;const r=this.nt(t);this.at(t,e)?r.B(e,1):r.U(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}removeTarget(t){this.G.delete(t)}ct(t){const e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}q(t){this.nt(t).q()}nt(t){let e=this.G.get(t);return e||(e=new Do,this.G.set(t,e)),e}ht(t){let e=this.J.get(t);return e||(e=new uo(Jr),this.J=this.J.insert(t,e)),e}st(t){const e=null!==this.ot(t);return e||$r("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.G.get(t);return e&&e.$?null:this.W.lt(t)}it(t){this.G.set(t,new Do),this.W.getRemoteKeysForTarget(t).forEach((e=>{this.tt(t,e,null)}))}at(t,e){return this.W.getRemoteKeysForTarget(t).has(e)}}function xo(){return new oo(Ts.comparator)}function Co(){return new oo(Ts.comparator)}const Ro={asc:"ASCENDING",desc:"DESCENDING"},ko={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Lo{constructor(t,e){this.databaseId=t,this.I=e}}function Oo(t,e){return t.I?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mo(t,e){return t.I?e.toBase64():e.toUint8Array()}function Fo(t,e){return Oo(t,e.toTimestamp())}function Po(t){return Qr(!!t),ns.fromTimestamp(function(t){const e=fs(t);return new es(e.seconds,e.nanos)}(t))}function Vo(t,e){return function(t){return new as(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Uo(t){const e=as.fromString(t);return Qr(ua(e)),e}function qo(t,e){return Vo(t.databaseId,e.path)}function Bo(t,e){const n=Uo(e);if(n.get(1)!==t.databaseId.projectId)throw new qr(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new qr(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ts(Go(n))}function jo(t,e){return Vo(t.databaseId,e)}function $o(t){const e=Uo(t);return 4===e.length?as.emptyPath():Go(e)}function Ko(t){return new as(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Go(t){return Qr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function zo(t,e,n){return{name:qo(t,e),fields:n.value.mapValue.fields}}function Ho(t,e,n){const r=Bo(t,e.name),s=Po(e.updateTime),i=new Ps({mapValue:{fields:e.fields}}),o=Us.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Qo(t,e){let n;if(e instanceof Qi)n={update:zo(t,e.key,e.value)};else if(e instanceof Zi)n={delete:qo(t,e.key)};else if(e instanceof Wi)n={update:zo(t,e.key,e.data),updateMask:ca(e.fieldMask)};else{if(!(e instanceof to))return Hr();n={verify:qo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ci)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ri)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Li)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Mi)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Hr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Fo(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Hr()}(t,e.precondition)),n}function Wo(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?qi.updateTime(Po(t.updateTime)):void 0!==t.exists?qi.exists(t.exists):qi.none()}(e.currentDocument):qi.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)Qr("REQUEST_TIME"===e.setToServerValue),n=new Ci;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ri(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Li(t)}else"increment"in e?n=new Mi(t,e.increment):Hr();const r=us.fromServerFormat(e.fieldPath);return new Vi(r,n)}(t,e))):[];if(e.update){e.update.name;const s=Bo(t,e.update.name),i=new Ps({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new hs(e.map((t=>us.fromServerFormat(t))))}(e.updateMask);return new Wi(s,i,t,n,r)}return new Qi(s,i,n,r)}if(e.delete){const r=Bo(t,e.delete);return new Zi(r,n)}if(e.verify){const r=Bo(t,e.verify);return new to(r,n)}return Hr()}function Yo(t,e){return{documents:[jo(t,e.path)]}}function Xo(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=jo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=jo(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Os(t.value))return{unaryFilter:{field:sa(t.field),op:"IS_NAN"}};if(Ls(t.value))return{unaryFilter:{field:sa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Os(t.value))return{unaryFilter:{field:sa(t.field),op:"IS_NOT_NAN"}};if(Ls(t.value))return{unaryFilter:{field:sa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sa(t.field),op:ra(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:sa(t.field),direction:na(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.I||vs(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=ta(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ta(e.endAt)),n}function Jo(t){let e=$o(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Qr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=Zo(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ni(ia(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,vs(e)?null:e}(n.limit));let c=null;n.startAt&&(c=ea(n.startAt));let u=null;return n.endAt&&(u=ea(n.endAt)),ai(e,s,o,i,a,"F",c,u)}function Zo(t){return t?void 0!==t.unaryFilter?[aa(t)]:void 0!==t.fieldFilter?[oa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Zo(t))).reduce(((t,e)=>t.concat(e))):Hr():[]}function ta(t){return{before:t.before,values:t.position}}function ea(t){const e=!!t.before,n=t.values||[];return new ti(n,e)}function na(t){return Ro[t]}function ra(t){return ko[t]}function sa(t){return{fieldPath:t.canonicalString()}}function ia(t){return us.fromServerFormat(t.fieldPath)}function oa(t){return Gs.create(ia(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Hr()}}(t.fieldFilter.op),t.fieldFilter.value)}function aa(t){switch(t.unaryFilter.op){case"IS_NAN":const e=ia(t.unaryFilter.field);return Gs.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=ia(t.unaryFilter.field);return Gs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ia(t.unaryFilter.field);return Gs.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ia(t.unaryFilter.field);return Gs.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Hr()}}function ca(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ua(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ha(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=da(e)),e=la(t.get(n),e);return da(e)}function la(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function da(t){return t+""}function fa(t){const e=t.length;if(Qr(e>=2),2===e)return Qr(""===t.charAt(0)&&""===t.charAt(1)),as.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&Hr(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=t.substring(i,e),s+="\0";break;case"":s+=t.substring(i,e+1);break;default:Hr()}i=e+2}return new as(r)}class ga{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class ma{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}ma.store="owner",ma.key="owner";class pa{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}pa.store="mutationQueues",pa.keyPath="userId";class ya{constructor(t,e,n,r,s){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}ya.store="mutations",ya.keyPath="batchId",ya.userMutationsIndex="userMutationsIndex",ya.userMutationsKeyPath=["userId","batchId"];class wa{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,ha(e)]}static key(t,e,n){return[t,ha(e),n]}}wa.store="documentMutations",wa.PLACEHOLDER=new wa;class va{constructor(t,e){this.path=t,this.readTime=e}}class ba{constructor(t,e){this.path=t,this.version=e}}class Ea{constructor(t,e,n,r,s,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}Ea.store="remoteDocuments",Ea.readTimeIndex="readTimeIndex",Ea.readTimeIndexPath="readTime",Ea.collectionReadTimeIndex="collectionReadTimeIndex",Ea.collectionReadTimeIndexPath=["parentPath","readTime"];class Ta{constructor(t){this.byteSize=t}}Ta.store="remoteDocumentGlobal",Ta.key="remoteDocumentGlobalKey";class Ia{constructor(t,e,n,r,s,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Ia.store="targets",Ia.keyPath="targetId",Ia.queryTargetsIndexName="queryTargetsIndex",Ia.queryTargetsKeyPath=["canonicalId","targetId"];class _a{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}_a.store="targetDocuments",_a.keyPath=["targetId","path"],_a.documentTargetsIndex="documentTargetsIndex",_a.documentTargetsKeyPath=["path","targetId"];class Sa{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Sa.key="targetGlobalKey",Sa.store="targetGlobal";class Aa{constructor(t,e){this.collectionId=t,this.parent=e}}Aa.store="collectionParents",Aa.keyPath=["collectionId","parent"];class Da{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}Da.store="clientMetadata",Da.keyPath="clientId";class Na{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Na.store="bundles",Na.keyPath="bundleId";class xa{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}xa.store="namedQueries",xa.keyPath="name";const Ca=[pa.store,ya.store,wa.store,Ea.store,Ia.store,ma.store,Sa.store,_a.store,Da.store,Ta.store,Aa.store,Na.store,xa.store],Ra="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ka{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class La{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Oa{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Hr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Oa(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Oa?e:Oa.resolve(e)}catch(t){return Oa.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Oa.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Oa.reject(e)}static resolve(t){return new Oa(((e,n)=>{e(t)}))}static reject(t){return new Oa(((e,n)=>{n(t)}))}static waitFor(t){return new Oa(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Oa.resolve(!1);for(const n of t)e=e.next((t=>t?Oa.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}}class Ma{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.ft=new La,this.transaction.oncomplete=()=>{this.ft.resolve()},this.transaction.onabort=()=>{e.error?this.ft.reject(new Va(t,e.error)):this.ft.resolve()},this.transaction.onerror=e=>{const n=$a(e.target.error);this.ft.reject(new Va(t,n))}}static open(t,e,n,r){try{return new Ma(e,t.transaction(r,n))}catch(t){throw new Va(e,t)}}get dt(){return this.ft.promise}abort(t){t&&this.ft.reject(t),this.aborted||($r("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new qa(e)}}class Fa{constructor(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===Fa._t(c())&&Kr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return $r("SimpleDb","Removing database:",t),Ba(window.indexedDB.deleteDatabase(t)).toPromise()}static gt(){if("undefined"==typeof indexedDB)return!1;if(Fa.yt())return!0;const t=c(),e=Fa._t(t),n=0<e&&e<10,r=Fa.Et(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static yt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)}static It(t,e){return t.store(e)}static _t(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Et(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async At(t){return this.db||($r("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Va(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new qr(Ur.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Va(t,r))},r.onupgradeneeded=t=>{$r("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.wt.Rt(e,r.transaction,t.oldVersion,this.version).next((()=>{$r("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Pt&&(this.db.onversionchange=t=>this.Pt(t)),this.db}bt(t){this.Pt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.At(t);const e=Ma.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).catch((t=>(e.abort(t),Oa.reject(t)))).toPromise();return i.catch((()=>{})),await e.dt,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if($r("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Pa{constructor(t){this.vt=t,this.Vt=!1,this.St=null}get isDone(){return this.Vt}get Dt(){return this.St}set cursor(t){this.vt=t}done(){this.Vt=!0}Ct(t){this.St=t}delete(){return Ba(this.vt.delete())}}class Va extends qr{constructor(t,e){super(Ur.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Ua(t){return"IndexedDbTransactionError"===t.name}class qa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?($r("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):($r("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ba(n)}add(t){return $r("SimpleDb","ADD",this.store.name,t,t),Ba(this.store.add(t))}get(t){return Ba(this.store.get(t)).next((e=>(void 0===e&&(e=null),$r("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return $r("SimpleDb","DELETE",this.store.name,t),Ba(this.store.delete(t))}count(){return $r("SimpleDb","COUNT",this.store.name),Ba(this.store.count())}Nt(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.xt(n,((t,e)=>{r.push(e)})).next((()=>r))}kt(t,e){$r("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.$t=!1;const r=this.cursor(n);return this.xt(r,((t,e,n)=>n.delete()))}Ot(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.xt(r,e)}Ft(t){const e=this.cursor({});return new Oa(((n,r)=>{e.onerror=t=>{const e=$a(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}xt(t,e){const n=[];return new Oa(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Pa(s),o=e(s.primaryKey,s.value,i);if(o instanceof Oa){const t=o.catch((t=>(i.done(),Oa.reject(t))));n.push(t)}i.isDone?r():null===i.Dt?s.continue():s.continue(i.Dt)}})).next((()=>Oa.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.$t?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ba(t){return new Oa(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=$a(t.target.error);n(e)}}))}let ja=!1;function $a(t){const e=Fa._t(c());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new qr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ja||(ja=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Ka extends ka{constructor(t,e){super(),this.Mt=t,this.currentSequenceNumber=e}}function Ga(t,e){const n=Wr(t);return Fa.It(n.Mt,e)}class za{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&$i(r,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Ki(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Ki(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(ns.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),vo())}isEqual(t){return this.batchId===t.batchId&&Zr(this.mutations,t.mutations,((t,e)=>zi(t,e)))&&Zr(this.baseMutations,t.baseMutations,((t,e)=>zi(t,e)))}}class Ha{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Qr(t.mutations.length===n.length);let r=yo();const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Ha(t,e,n,r)}}class Qa{constructor(t,e,n,r,s=ns.min(),i=ns.min(),o=ls.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new Qa(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Qa(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Qa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Wa{constructor(t){this.Lt=t}}function Ya(t,e){if(e.document)return Ho(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=Ts.fromSegments(e.noDocument.path),n=ec(e.noDocument.readTime),r=Us.newNoDocument(t,n);return e.hasCommittedMutations?r.setHasCommittedMutations():r}if(e.unknownDocument){const t=Ts.fromSegments(e.unknownDocument.path),n=ec(e.unknownDocument.version);return Us.newUnknownDocument(t,n)}return Hr()}function Xa(t,e,n){const r=Ja(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:qo(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Oo(t,e.version.toTimestamp())}}(t.Lt,e),i=e.hasCommittedMutations;return new Ea(null,null,n,i,r,s)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=tc(e.version),i=e.hasCommittedMutations;return new Ea(null,new va(t,n),null,i,r,s)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=tc(e.version);return new Ea(new ba(t,n),null,null,!0,r,s)}return Hr()}function Ja(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Za(t){const e=new es(t[0],t[1]);return ns.fromTimestamp(e)}function tc(t){const e=t.toTimestamp();return new ga(e.seconds,e.nanoseconds)}function ec(t){const e=new es(t.seconds,t.nanoseconds);return ns.fromTimestamp(e)}function nc(t,e){const n=(e.baseMutations||[]).map((e=>Wo(t.Lt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Wo(t.Lt,e))),s=es.fromMillis(e.localWriteTimeMs);return new za(e.batchId,s,n,r)}function rc(t){const e=ec(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ec(t.lastLimboFreeSnapshotVersion):ns.min();let r;var s;return void 0!==t.query.documents?(Qr(1===(s=t.query).documents.length),r=mi(ci($o(s.documents[0])))):r=function(t){return mi(Jo(t))}(t.query),new Qa(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ls.fromBase64String(t.resumeToken))}function sc(t,e){const n=tc(e.snapshotVersion),r=tc(e.lastLimboFreeSnapshotVersion);let s;s=Ks(e.target)?Yo(t.Lt,e.target):Xo(t.Lt,e.target);const i=e.resumeToken.toBase64();return new Ia(e.targetId,js(e.target),n,i,e.sequenceNumber,r,s)}function ic(t){const e=Jo({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?pi(e,e.limit,"L"):e}class oc{getBundleMetadata(t,e){return ac(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:ec(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return ac(t).put({bundleId:(n=e).id,createTime:tc(Po(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return cc(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:ic(e.bundledQuery),readTime:ec(e.readTime)};var e}))}saveNamedQuery(t,e){return cc(t).put(function(t){return{name:t.name,readTime:tc(Po(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function ac(t){return Ga(t,Na.store)}function cc(t){return Ga(t,xa.store)}class uc{constructor(){this.Bt=new hc}addToCollectionParentIndex(t,e){return this.Bt.add(e),Oa.resolve()}getCollectionParents(t,e){return Oa.resolve(this.Bt.getEntries(e))}}class hc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new uo(as.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new uo(as.comparator)).toArray()}}class lc{constructor(){this.Ut=new hc}addToCollectionParentIndex(t,e){if(!this.Ut.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.Ut.add(e)}));const s={collectionId:n,parent:ha(r)};return dc(t).put(s)}return Oa.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[ts(e),""],!1,!0);return dc(t).Nt(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(fa(r.parent))}return n}))}}function dc(t){return Ga(t,Aa.store)}const fc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new gc(t,gc.DEFAULT_COLLECTION_PERCENTILE,gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function mc(t,e,n){const r=t.store(ya.store),s=t.store(wa.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Ot({range:o},((t,e,n)=>(a++,n.delete())));i.push(c.next((()=>{Qr(1===a)})));const u=[];for(const t of n.mutations){const r=wa.key(e,t.key.path,n.batchId);i.push(s.delete(r)),u.push(t.key)}return Oa.waitFor(i).next((()=>u))}function pc(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Hr();e=t.noDocument}return JSON.stringify(e).length}gc.DEFAULT_COLLECTION_PERCENTILE=10,gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gc.DEFAULT=new gc(41943040,gc.DEFAULT_COLLECTION_PERCENTILE,gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gc.DISABLED=new gc(-1,0,0);class yc{constructor(t,e,n,r){this.userId=t,this.R=e,this.qt=n,this.referenceDelegate=r,this.Kt={}}static jt(t,e,n,r){Qr(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new yc(s,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vc(t).Ot({index:ya.userMutationsIndex,range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const s=bc(t),i=vc(t);return i.add({}).next((o=>{Qr("number"==typeof o);const a=new za(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map((e=>Qo(t.Lt,e))),s=n.mutations.map((e=>Qo(t.Lt,e)));return new ya(e,n.batchId,n.localWriteTime.toMillis(),r,s)}(this.R,this.userId,a),u=[];let h=new uo(((t,e)=>Jr(t.canonicalString(),e.canonicalString())));for(const t of r){const e=wa.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(i.put(c)),u.push(s.put(e,wa.PLACEHOLDER))}return h.forEach((e=>{u.push(this.qt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Kt[o]=a.keys()})),Oa.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return vc(t).get(e).next((t=>t?(Qr(t.userId===this.userId),nc(this.R,t)):null))}Qt(t,e){return this.Kt[e]?Oa.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Kt[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return vc(t).Ot({index:ya.userMutationsIndex,range:r},((t,e,r)=>{e.userId===this.userId&&(Qr(e.batchId>=n),s=nc(this.R,e)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return vc(t).Ot({index:ya.userMutationsIndex,range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vc(t).Nt(ya.userMutationsIndex,e).next((t=>t.map((t=>nc(this.R,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=wa.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return bc(t).Ot({range:r},((n,r,i)=>{const[o,a,c]=n,u=fa(a);if(o===this.userId&&e.path.isEqual(u))return vc(t).get(c).next((t=>{if(!t)throw Hr();Qr(t.userId===this.userId),s.push(nc(this.R,t))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new uo(Jr);const r=[];return e.forEach((e=>{const s=wa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=bc(t).Ot({range:i},((t,r,s)=>{const[i,o,a]=t,c=fa(o);i===this.userId&&e.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),Oa.waitFor(r).next((()=>this.Wt(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,s=wa.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new uo(Jr);return bc(t).Ot({range:i},((t,e,s)=>{const[i,a,c]=t,u=fa(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.Wt(t,o)))}Wt(t,e){const n=[],r=[];return e.forEach((e=>{r.push(vc(t).get(e).next((t=>{if(null===t)throw Hr();Qr(t.userId===this.userId),n.push(nc(this.R,t))})))})),Oa.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return mc(t.Mt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Gt(e.batchId)})),Oa.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Gt(t){delete this.Kt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Oa.resolve();const n=IDBKeyRange.lowerBound(wa.prefixForUser(this.userId)),r=[];return bc(t).Ot({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=fa(t[1]);r.push(e)}else n.done()})).next((()=>{Qr(0===r.length)}))}))}containsKey(t,e){return wc(t,this.userId,e)}zt(t){return Ec(t).get(this.userId).next((t=>t||new pa(this.userId,-1,"")))}}function wc(t,e,n){const r=wa.prefixForPath(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return bc(t).Ot({range:i,$t:!0},((t,n,r)=>{const[i,a,c]=t;i===e&&a===s&&(o=!0),r.done()})).next((()=>o))}function vc(t){return Ga(t,ya.store)}function bc(t){return Ga(t,wa.store)}function Ec(t){return Ga(t,pa.store)}class Tc{constructor(t){this.Ht=t}next(){return this.Ht+=2,this.Ht}static Jt(){return new Tc(0)}static Yt(){return new Tc(-1)}}class Ic{constructor(t,e){this.referenceDelegate=t,this.R=e}allocateTargetId(t){return this.Xt(t).next((e=>{const n=new Tc(e.highestTargetId);return e.highestTargetId=n.next(),this.Zt(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Xt(t).next((t=>ns.fromTimestamp(new es(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Xt(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Xt(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Zt(t,r))))}addTargetData(t,e){return this.te(t,e).next((()=>this.Xt(t).next((n=>(n.targetCount+=1,this.ee(e,n),this.Zt(t,n))))))}updateTargetData(t,e){return this.te(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>_c(t).delete(e.targetId))).next((()=>this.Xt(t))).next((e=>(Qr(e.targetCount>0),e.targetCount-=1,this.Zt(t,e))))}removeTargets(t,e,n){let r=0;const s=[];return _c(t).Ot(((i,o)=>{const a=rc(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(t,a)))})).next((()=>Oa.waitFor(s))).next((()=>r))}forEachTarget(t,e){return _c(t).Ot(((t,n)=>{const r=rc(n);e(r)}))}Xt(t){return Sc(t).get(Sa.key).next((t=>(Qr(null!==t),t)))}Zt(t,e){return Sc(t).put(Sa.key,e)}te(t,e){return _c(t).put(sc(this.R,e))}ee(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Xt(t).next((t=>t.targetCount))}getTargetData(t,e){const n=js(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return _c(t).Ot({range:r,index:Ia.queryTargetsIndexName},((t,n,r)=>{const i=rc(n);$s(e,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(t,e,n){const r=[],s=Ac(t);return e.forEach((e=>{const i=ha(e.path);r.push(s.put(new _a(n,i))),r.push(this.referenceDelegate.addReference(t,n,e))})),Oa.waitFor(r)}removeMatchingKeys(t,e,n){const r=Ac(t);return Oa.forEach(e,(e=>{const s=ha(e.path);return Oa.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Ac(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ac(t);let s=vo();return r.Ot({range:n,$t:!0},((t,e,n)=>{const r=fa(t[1]),i=new Ts(r);s=s.add(i)})).next((()=>s))}containsKey(t,e){const n=ha(e.path),r=IDBKeyRange.bound([n],[ts(n)],!1,!0);let s=0;return Ac(t).Ot({index:_a.documentTargetsIndex,$t:!0,range:r},(([t,e],n,r)=>{0!==t&&(s++,r.done())})).next((()=>s>0))}lt(t,e){return _c(t).get(e).next((t=>t?rc(t):null))}}function _c(t){return Ga(t,Ia.store)}function Sc(t){return Ga(t,Sa.store)}function Ac(t){return Ga(t,_a.store)}async function Dc(t){if(t.code!==Ur.FAILED_PRECONDITION||t.message!==Ra)throw t;$r("LocalStore","Unexpectedly lost primary lease")}function Nc([t,e],[n,r]){const s=Jr(t,n);return 0===s?Jr(e,r):s}class xc{constructor(t){this.ne=t,this.buffer=new uo(Nc),this.se=0}ie(){return++this.se}re(t){const e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Nc(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Cc{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)}stop(){this.ce&&(this.ce.cancel(),this.ce=null)}get started(){return null!==this.ce}ue(t){const e=this.oe?3e5:6e4;$r("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.ce=null,this.oe=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){Ua(t)?$r("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Dc(t)}await this.ue(t)}))}}class Rc{constructor(t,e){this.ae=t,this.params=e}calculateTargetCount(t,e){return this.ae.he(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Oa.resolve(Vr.o);const n=new xc(e);return this.ae.forEachTarget(t,(t=>n.re(t.sequenceNumber))).next((()=>this.ae.le(t,(t=>n.re(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.ae.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.ae.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?($r("LruGarbageCollector","Garbage collection skipped; disabled"),Oa.resolve(fc)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?($r("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fc):this.fe(t,e)))}getCacheSize(t){return this.ae.getCacheSize(t)}fe(t,e){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?($r("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),jr()<=p.DEBUG&&$r("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Oa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}class kc{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Rc(t,e)}(this,e)}he(t){const e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}de(t){let e=0;return this.le(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}le(t,e){return this.we(t,((t,n)=>e(n)))}addReference(t,e,n){return Lc(t,n)}removeReference(t,e,n){return Lc(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Lc(t,e)}_e(t,e){return function(t,e){let n=!1;return Ec(t).Ft((r=>wc(t,r,e).next((t=>(t&&(n=!0),Oa.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.we(t,((i,o)=>{if(o<=e){const e=this._e(t,i).next((e=>{if(!e)return s++,n.getEntry(t,i).next((()=>(n.removeEntry(i),Ac(t).delete([0,ha(i.path)]))))}));r.push(e)}})).next((()=>Oa.waitFor(r))).next((()=>n.apply(t))).next((()=>s))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Lc(t,e)}we(t,e){const n=Ac(t);let r,s=Vr.o;return n.Ot({index:_a.documentTargetsIndex},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==Vr.o&&e(new Ts(fa(r)),s),s=o,r=i):s=Vr.o})).next((()=>{s!==Vr.o&&e(new Ts(fa(r)),s)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Lc(t,e){return Ac(t).put(function(t,e){return new _a(0,ha(t.path),e)}(e,t.currentSequenceNumber))}class Oc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1}forEach(t){ss(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return is(this.inner)}}class Mc{constructor(){this.changes=new Oc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:ns.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:Us.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Oa.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Fc{constructor(t,e){this.R=t,this.qt=e}addEntry(t,e,n){return Uc(t).put(qc(e),n)}removeEntry(t,e){const n=Uc(t),r=qc(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.me(t,n))))}getEntry(t,e){return Uc(t).get(qc(e)).next((t=>this.ge(e,t)))}ye(t,e){return Uc(t).get(qc(e)).next((t=>({document:this.ge(e,t),size:pc(t)})))}getEntries(t,e){let n=fo();return this.pe(t,e,((t,e)=>{const r=this.ge(t,e);n=n.insert(t,r)})).next((()=>n))}Ee(t,e){let n=fo(),r=new oo(Ts.comparator);return this.pe(t,e,((t,e)=>{const s=this.ge(t,e);n=n.insert(t,s),r=r.insert(t,pc(e))})).next((()=>({documents:n,Te:r})))}pe(t,e,n){if(e.isEmpty())return Oa.resolve();const r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),s=e.getIterator();let i=s.getNext();return Uc(t).Ot({range:r},((t,e,r)=>{const o=Ts.fromSegments(t);for(;i&&Ts.comparator(i,o)<0;)n(i,null),i=s.getNext();i&&i.isEqual(o)&&(n(i,e),i=s.hasNext()?s.getNext():null),i?r.Ct(i.path.toArray()):r.done()})).next((()=>{for(;i;)n(i,null),i=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(t,e,n){let r=fo();const s=e.path.length+1,i={};if(n.isEqual(ns.min())){const t=e.path.toArray();i.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),r=Ja(n);i.range=IDBKeyRange.lowerBound([t,r],!0),i.index=Ea.collectionReadTimeIndex}return Uc(t).Ot(i,((t,n,i)=>{if(t.length!==s)return;const o=Ya(this.R,n);e.path.isPrefixOf(o.key.path)?bi(e,o)&&(r=r.insert(o.key,o)):i.done()})).next((()=>r))}newChangeBuffer(t){return new Pc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Vc(t).get(Ta.key).next((t=>(Qr(!!t),t)))}me(t,e){return Vc(t).put(Ta.key,e)}ge(t,e){if(e){const t=Ya(this.R,e);if(!t.isNoDocument()||!t.version.isEqual(ns.min()))return t}return Us.newInvalidDocument(t)}}class Pc extends Mc{constructor(t,e){super(),this.Ie=t,this.trackRemovals=e,this.Ae=new Oc((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new uo(((t,e)=>Jr(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.Ae.get(s);if(i.document.isValidDocument()){const a=Xa(this.Ie.R,i.document,this.getReadTime(s));r=r.add(s.path.popLast());const c=pc(a);n+=c-o,e.push(this.Ie.addEntry(t,s,a))}else if(n-=o,this.trackRemovals){const n=Xa(this.Ie.R,Us.newNoDocument(s,ns.min()),this.getReadTime(s));e.push(this.Ie.addEntry(t,s,n))}else e.push(this.Ie.removeEntry(t,s))})),r.forEach((n=>{e.push(this.Ie.qt.addToCollectionParentIndex(t,n))})),e.push(this.Ie.updateMetadata(t,n)),Oa.waitFor(e)}getFromCache(t,e){return this.Ie.ye(t,e).next((t=>(this.Ae.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Ie.Ee(t,e).next((({documents:t,Te:e})=>(e.forEach(((t,e)=>{this.Ae.set(t,e)})),t)))}}function Vc(t){return Ga(t,Ta.store)}function Uc(t){return Ga(t,Ea.store)}function qc(t){return t.path.toArray()}class Bc{constructor(t){this.R=t}Rt(t,e,n,r){Qr(n<r&&n>=0&&r<=11);const s=new Ma("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ma.store)}(t),function(t){t.createObjectStore(pa.store,{keyPath:pa.keyPath}),t.createObjectStore(ya.store,{keyPath:ya.keyPath,autoIncrement:!0}).createIndex(ya.userMutationsIndex,ya.userMutationsKeyPath,{unique:!0}),t.createObjectStore(wa.store)}(t),jc(t),function(t){t.createObjectStore(Ea.store)}(t));let i=Oa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(_a.store),t.deleteObjectStore(Ia.store),t.deleteObjectStore(Sa.store)}(t),jc(t)),i=i.next((()=>function(t){const e=t.store(Sa.store),n=new Sa(0,0,ns.min().toTimestamp(),0);return e.put(Sa.key,n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store(ya.store).Nt().next((n=>{t.deleteObjectStore(ya.store),t.createObjectStore(ya.store,{keyPath:ya.keyPath,autoIncrement:!0}).createIndex(ya.userMutationsIndex,ya.userMutationsKeyPath,{unique:!0});const r=e.store(ya.store),s=n.map((t=>r.put(t)));return Oa.waitFor(s)}))}(t,s)))),i=i.next((()=>{!function(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath})}(t)}))),n<5&&r>=5&&(i=i.next((()=>this.Re(s)))),n<6&&r>=6&&(i=i.next((()=>(function(t){t.createObjectStore(Ta.store)}(t),this.Pe(s))))),n<7&&r>=7&&(i=i.next((()=>this.be(s)))),n<8&&r>=8&&(i=i.next((()=>this.ve(t,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Ea.store);e.createIndex(Ea.readTimeIndex,Ea.readTimeIndexPath,{unique:!1}),e.createIndex(Ea.collectionReadTimeIndex,Ea.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(i=i.next((()=>this.Ve(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(t){t.createObjectStore(Na.store,{keyPath:Na.keyPath})}(t),function(t){t.createObjectStore(xa.store,{keyPath:xa.keyPath})}(t)}))),i}Pe(t){let e=0;return t.store(Ea.store).Ot(((t,n)=>{e+=pc(n)})).next((()=>{const n=new Ta(e);return t.store(Ta.store).put(Ta.key,n)}))}Re(t){const e=t.store(pa.store),n=t.store(ya.store);return e.Nt().next((e=>Oa.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Nt(ya.userMutationsIndex,r).next((n=>Oa.forEach(n,(n=>{Qr(n.userId===e.userId);const r=nc(this.R,n);return mc(t,e.userId,r).next((()=>{}))}))))}))))}be(t){const e=t.store(_a.store),n=t.store(Ea.store);return t.store(Sa.store).get(Sa.key).next((t=>{const r=[];return n.Ot(((n,s)=>{const i=new as(n),o=function(t){return[0,ha(t)]}(i);r.push(e.get(o).next((n=>n?Oa.resolve():(n=>e.put(new _a(0,ha(n),t.highestListenSequenceNumber)))(i))))})).next((()=>Oa.waitFor(r)))}))}ve(t,e){t.createObjectStore(Aa.store,{keyPath:Aa.keyPath});const n=e.store(Aa.store),r=new hc,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:ha(r)})}};return e.store(Ea.store).Ot({$t:!0},((t,e)=>{const n=new as(t);return s(n.popLast())})).next((()=>e.store(wa.store).Ot({$t:!0},(([t,e,n],r)=>{const i=fa(e);return s(i.popLast())}))))}Ve(t){const e=t.store(Ia.store);return e.Ot(((t,n)=>{const r=rc(n),s=sc(this.R,r);return e.put(s)}))}}function jc(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath}).createIndex(_a.documentTargetsIndex,_a.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ia.store,{keyPath:Ia.keyPath}).createIndex(Ia.queryTargetsIndexName,Ia.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Sa.store)}const $c="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Kc{constructor(t,e,n,r,s,i,o,a,c,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=s,this.window=i,this.document=o,this.De=c,this.Ce=u,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.$e=null,this.Oe=null,this.Fe=Number.NEGATIVE_INFINITY,this.Me=t=>Promise.resolve(),!Kc.gt())throw new qr(Ur.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kc(this,r),this.Le=e+"main",this.R=new Wa(a),this.Be=new Fa(this.Le,11,new Bc(this.R)),this.Ue=new Ic(this.referenceDelegate,this.R),this.qt=new lc,this.qe=function(t,e){return new Fc(t,e)}(this.R,this.qt),this.Ke=new oc,this.window&&this.window.localStorage?this.je=this.window.localStorage:(this.je=null,!1===u&&Kr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Qe().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new qr(Ur.FAILED_PRECONDITION,$c);return this.We(),this.Ge(),this.ze(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Ue.getHighestSequenceNumber(t)))})).then((t=>{this.Ne=new Vr(t,this.De)})).then((()=>{this.xe=!0})).catch((t=>(this.Be&&this.Be.close(),Promise.reject(t))))}He(t){return this.Me=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Be.bt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((async()=>{this.started&&await this.Qe()})))}Qe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>zc(t).put(new Da(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.Je(t).next((t=>{t||(this.isPrimary=!1,this.Se.enqueueRetryable((()=>this.Me(!1))))}))})).next((()=>this.Ye(t))).next((e=>this.isPrimary&&!e?this.Xe(t).next((()=>!1)):!!e&&this.Ze(t).next((()=>!0)))))).catch((t=>{if(Ua(t))return $r("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return $r("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Se.enqueueRetryable((()=>this.Me(t))),this.isPrimary=t}))}Je(t){return Gc(t).get(ma.key).next((t=>Oa.resolve(this.tn(t))))}en(t){return zc(t).delete(this.clientId)}async nn(){if(this.isPrimary&&!this.sn(this.Fe,18e5)){this.Fe=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=Ga(t,Da.store);return e.Nt().next((t=>{const n=this.rn(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return Oa.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.je)for(const e of t)this.je.removeItem(this.on(e.clientId))}}ze(){this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Qe().then((()=>this.nn())).then((()=>this.ze()))))}tn(t){return!!t&&t.ownerId===this.clientId}Ye(t){return this.Ce?Oa.resolve(!0):Gc(t).get(ma.key).next((e=>{if(null!==e&&this.sn(e.leaseTimestampMs,5e3)&&!this.cn(e.ownerId)){if(this.tn(e)&&this.networkEnabled)return!0;if(!this.tn(e)){if(!e.allowTabSynchronization)throw new qr(Ur.FAILED_PRECONDITION,$c);return!1}}return!(!this.networkEnabled||!this.inForeground)||zc(t).Nt().next((t=>void 0===this.rn(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&$r("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),await this.Be.runTransaction("shutdown","readwrite",[ma.store,Da.store],(t=>{const e=new Ka(t,Vr.o);return this.Xe(e).next((()=>this.en(e)))})),this.Be.close(),this.ln()}rn(t,e){return t.filter((t=>this.sn(t.updateTimeMs,e)&&!this.cn(t.clientId)))}fn(){return this.runTransaction("getActiveClients","readonly",(t=>zc(t).Nt().next((t=>this.rn(t,18e5).map((t=>t.clientId))))))}get started(){return this.xe}getMutationQueue(t){return yc.jt(t,this.R,this.qt,this.referenceDelegate)}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getIndexManager(){return this.qt}getBundleCache(){return this.Ke}runTransaction(t,e,n){$r("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite";let s;return this.Be.runTransaction(t,r,Ca,(r=>(s=new Ka(r,this.Ne?this.Ne.next():Vr.o),"readwrite-primary"===e?this.Je(s).next((t=>!!t||this.Ye(s))).next((e=>{if(!e)throw Kr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Se.enqueueRetryable((()=>this.Me(!1))),new qr(Ur.FAILED_PRECONDITION,Ra);return n(s)})).next((t=>this.Ze(s).next((()=>t)))):this.dn(s).next((()=>n(s)))))).then((t=>(s.raiseOnCommittedEvent(),t)))}dn(t){return Gc(t).get(ma.key).next((t=>{if(null!==t&&this.sn(t.leaseTimestampMs,5e3)&&!this.cn(t.ownerId)&&!this.tn(t)&&!(this.Ce||this.allowTabSynchronization&&t.allowTabSynchronization))throw new qr(Ur.FAILED_PRECONDITION,$c)}))}Ze(t){const e=new ma(this.clientId,this.allowTabSynchronization,Date.now());return Gc(t).put(ma.key,e)}static gt(){return Fa.gt()}Xe(t){const e=Gc(t);return e.get(ma.key).next((t=>this.tn(t)?($r("IndexedDbPersistence","Releasing primary lease."),e.delete(ma.key)):Oa.resolve()))}sn(t,e){const n=Date.now();return!(t<n-e||t>n&&(Kr(`Detected an update time that is in the future: ${t} > ${n}`),1))}We(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.$e=()=>{this.Se.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Qe())))},this.document.addEventListener("visibilitychange",this.$e),this.inForeground="visible"===this.document.visibilityState)}an(){this.$e&&(this.document.removeEventListener("visibilitychange",this.$e),this.$e=null)}Ge(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=()=>{this.un(),u()&&navigator.appVersion.match("Version/14")&&this.Se.enterRestrictedMode(!0),this.Se.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ke))}hn(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)}cn(t){var e;try{const n=null!==(null===(e=this.je)||void 0===e?void 0:e.getItem(this.on(t)));return $r("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Kr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}un(){if(this.je)try{this.je.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Kr("Failed to set zombie client id.",t)}}ln(){if(this.je)try{this.je.removeItem(this.on(this.clientId))}catch(t){}}on(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Gc(t){return Ga(t,ma.store)}function zc(t){return Ga(t,Da.store)}function Hc(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Qc{constructor(t,e){this.progress=t,this.wn=e}}class Wc{constructor(t,e,n){this.qe=t,this._n=e,this.qt=n}mn(t,e){return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.gn(t,e,n)))}gn(t,e,n){return this.qe.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}yn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}pn(t,e){return this.qe.getEntries(t,e).next((e=>this.En(t,e).next((()=>e))))}En(t,e){return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.yn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Ts.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):fi(e)?this.In(t,e,n):this.An(t,e,n)}Tn(t,e){return this.mn(t,new Ts(e)).next((t=>{let e=mo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}In(t,e,n){const r=e.collectionGroup;let s=mo();return this.qt.getCollectionParents(t,r).next((i=>Oa.forEach(i,(i=>{const o=function(t,e){return new oi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.An(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}An(t,e,n){let r,s;return this.qe.getDocumentsMatchingQuery(t,e,n).next((n=>(r=n,this._n.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(s=e,this.Rn(t,s,r).next((t=>{r=t;for(const t of s)for(const e of t.mutations){const n=e.key;let s=r.get(n);null==s&&(s=Us.newInvalidDocument(n),r=r.insert(n,s)),Ki(e,s,t.localWriteTime),s.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((t,n)=>{bi(e,n)||(r=r.remove(t))})),r)))}Rn(t,e,n){let r=vo();for(const t of e)for(const e of t.mutations)e instanceof Wi&&null===n.get(e.key)&&(r=r.add(e.key));let s=n;return this.qe.getEntries(t,r).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(s=s.insert(t,e))})),s)))}}class Yc{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Pn=n,this.bn=r}static vn(t,e){let n=vo(),r=vo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Yc(t,e.fromCache,n,r)}}class Xc{Vn(t){this.Sn=t}getDocumentsMatchingQuery(t,e,n,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(ns.min())?this.Dn(t,e):this.Sn.pn(t,r).next((s=>{const i=this.Cn(e,s);return(ui(e)||hi(e))&&this.Nn(e.limitType,i,r,n)?this.Dn(t,e):(jr()<=p.DEBUG&&$r("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),vi(e)),this.Sn.getDocumentsMatchingQuery(t,e,n).next((t=>(i.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Cn(t,e){let n=new uo(Ei(t));return e.forEach(((e,r)=>{bi(t,r)&&(n=n.add(r))})),n}Nn(t,e,n,r){if(n.size!==e.size)return!0;const s="F"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Dn(t,e){return jr()<=p.DEBUG&&$r("QueryEngine","Using full collection scan to execute query:",vi(e)),this.Sn.getDocumentsMatchingQuery(t,e,ns.min())}}class Jc{constructor(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new oo(Jr),this.$n=new Oc((t=>js(t)),$s),this.On=ns.min(),this._n=t.getMutationQueue(n),this.Fn=t.getRemoteDocumentCache(),this.Ue=t.getTargetCache(),this.Mn=new Wc(this.Fn,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.kn)))}}function Zc(t,e,n,r){return new Jc(t,e,n,r)}async function tu(t,e){const n=Wr(t);let r=n._n,s=n.Mn;const i=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n._n.getAllMutationBatches(t).next((o=>(i=o,r=n.persistence.getMutationQueue(e),s=new Wc(n.Fn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)))).next((e=>{const n=[],r=[];let o=vo();for(const t of i){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return s.pn(t,o).next((t=>({Ln:t,removedBatchIds:n,addedBatchIds:r})))}))}));return n._n=r,n.Mn=s,n.xn.Vn(n.Mn),i}function eu(t){const e=Wr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ue.getLastRemoteSnapshotVersion(t)))}function nu(t,e,n,r,s){let i=vo();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=fo();return n.forEach(((n,o)=>{const a=t.get(n),c=(null==s?void 0:s.get(n))||r;o.isNoDocument()&&o.version.isEqual(ns.min())?(e.removeEntry(n,c),i=i.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o,c),i=i.insert(n,o)):$r("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),i}))}function ru(t,e){const n=Wr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e))))}function su(t,e){const n=Wr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Ue.getTargetData(t,e).next((s=>s?(r=s,Oa.resolve(r)):n.Ue.allocateTargetId(t).next((s=>(r=new Qa(e,s,0,t.currentSequenceNumber),n.Ue.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.$n.set(e,t.targetId)),t}))}async function iu(t,e,n){const r=Wr(t),s=r.kn.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Ua(t))throw t;$r("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.kn=r.kn.remove(e),r.$n.delete(s.target)}function ou(t,e,n){const r=Wr(t);let s=ns.min(),i=vo();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=Wr(t),s=r.$n.get(n);return void 0!==s?Oa.resolve(r.kn.get(s)):r.Ue.getTargetData(e,n)}(r,t,mi(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Ue.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.xn.getDocumentsMatchingQuery(t,e,n?s:ns.min(),n?i:vo()))).next((t=>({documents:t,Bn:i})))))}function au(t,e){const n=Wr(t),r=Wr(n.Ue),s=n.kn.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(t=>r.lt(t,e).next((t=>t?t.target:null))))}function cu(t){const e=Wr(t);return e.persistence.runTransaction("Get new document changes","readonly",(t=>function(t,e,n){const r=Wr(t);let s=fo(),i=Ja(n);const o=Uc(e),a=IDBKeyRange.lowerBound(i,!0);return o.Ot({index:Ea.readTimeIndex,range:a},((t,e)=>{const n=Ya(r.R,e);s=s.insert(n.key,n),i=e.readTime})).next((()=>({wn:s,readTime:Za(i)})))}(e.Fn,t,e.On))).then((({wn:t,readTime:n})=>(e.On=n,t)))}async function uu(t,e,n=vo()){const r=await su(t,mi(ic(e.bundledQuery))),s=Wr(t);return s.persistence.runTransaction("Save named query","readwrite",(t=>{const i=Po(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Ke.saveNamedQuery(t,e);const o=r.withResumeToken(ls.EMPTY_BYTE_STRING,i);return s.kn=s.kn.insert(o.targetId,o),s.Ue.updateTargetData(t,o).next((()=>s.Ue.removeMatchingKeysForTargetId(t,r.targetId))).next((()=>s.Ue.addMatchingKeys(t,n,r.targetId))).next((()=>s.Ke.saveNamedQuery(t,e)))}))}class hu{constructor(t){this.R=t,this.jn=new Map,this.Qn=new Map}getBundleMetadata(t,e){return Oa.resolve(this.jn.get(e))}saveBundleMetadata(t,e){var n;return this.jn.set(e.id,{id:(n=e).id,version:n.version,createTime:Po(n.createTime)}),Oa.resolve()}getNamedQuery(t,e){return Oa.resolve(this.Qn.get(e))}saveNamedQuery(t,e){return this.Qn.set(e.name,function(t){return{name:t.name,query:ic(t.bundledQuery),readTime:Po(t.readTime)}}(e)),Oa.resolve()}}class lu{constructor(){this.Wn=new uo(du.Gn),this.zn=new uo(du.Hn)}isEmpty(){return this.Wn.isEmpty()}addReference(t,e){const n=new du(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)}Jn(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Yn(new du(t,e))}Xn(t,e){t.forEach((t=>this.removeReference(t,e)))}Zn(t){const e=new Ts(new as([])),n=new du(e,t),r=new du(e,t+1),s=[];return this.zn.forEachInRange([n,r],(t=>{this.Yn(t),s.push(t.key)})),s}ts(){this.Wn.forEach((t=>this.Yn(t)))}Yn(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)}es(t){const e=new Ts(new as([])),n=new du(e,t),r=new du(e,t+1);let s=vo();return this.zn.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new du(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class du{constructor(t,e){this.key=t,this.ns=e}static Gn(t,e){return Ts.comparator(t.key,e.key)||Jr(t.ns,e.ns)}static Hn(t,e){return Jr(t.ns,e.ns)||Ts.comparator(t.key,e.key)}}class fu{constructor(t,e){this.qt=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new uo(du.Gn)}checkEmpty(t){return Oa.resolve(0===this._n.length)}addMutationBatch(t,e,n,r){const s=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];const i=new za(s,e,n,r);this._n.push(i);for(const e of r)this.rs=this.rs.add(new du(e.key,s)),this.qt.addToCollectionParentIndex(t,e.key.path.popLast());return Oa.resolve(i)}lookupMutationBatch(t,e){return Oa.resolve(this.os(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.cs(n),s=r<0?0:r;return Oa.resolve(this._n.length>s?this._n[s]:null)}getHighestUnacknowledgedBatchId(){return Oa.resolve(0===this._n.length?-1:this.ss-1)}getAllMutationBatches(t){return Oa.resolve(this._n.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new du(e,0),r=new du(e,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([n,r],(t=>{const e=this.os(t.ns);s.push(e)})),Oa.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new uo(Jr);return e.forEach((t=>{const e=new du(t,0),r=new du(t,Number.POSITIVE_INFINITY);this.rs.forEachInRange([e,r],(t=>{n=n.add(t.ns)}))})),Oa.resolve(this.us(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;Ts.isDocumentKey(s)||(s=s.child(""));const i=new du(new Ts(s),0);let o=new uo(Jr);return this.rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.ns)),!0)}),i),Oa.resolve(this.us(o))}us(t){const e=[];return t.forEach((t=>{const n=this.os(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Qr(0===this.hs(e.batchId,"removed")),this._n.shift();let n=this.rs;return Oa.forEach(e.mutations,(r=>{const s=new du(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.rs=n}))}Gt(t){}containsKey(t,e){const n=new du(e,0),r=this.rs.firstAfterOrEqual(n);return Oa.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this._n.length,Oa.resolve()}hs(t,e){return this.cs(t)}cs(t){return 0===this._n.length?0:t-this._n[0].batchId}os(t){const e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]}}class gu{constructor(t,e){this.qt=t,this.ls=e,this.docs=new oo(Ts.comparator),this.size=0}addEntry(t,e,n){const r=e.key,s=this.docs.get(r),i=s?s.size:0,o=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-i,this.qt.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Oa.resolve(n?n.document.clone():Us.newInvalidDocument(e))}getEntries(t,e){let n=fo();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():Us.newInvalidDocument(t))})),Oa.resolve(n)}getDocumentsMatchingQuery(t,e,n){let r=fo();const s=new Ts(e.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s,readTime:o}}=i.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||bi(e,s)&&(r=r.insert(s.key,s.clone()))}return Oa.resolve(r)}fs(t,e){return Oa.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new mu(this)}getSize(t){return Oa.resolve(this.size)}}class mu extends Mc{constructor(t){super(),this.Ie=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?e.push(this.Ie.addEntry(t,r.document,this.getReadTime(n))):this.Ie.removeEntry(n)})),Oa.waitFor(e)}getFromCache(t,e){return this.Ie.getEntry(t,e)}getAllFromCache(t,e){return this.Ie.getEntries(t,e)}}class pu{constructor(t){this.persistence=t,this.ds=new Oc((t=>js(t)),$s),this.lastRemoteSnapshotVersion=ns.min(),this.highestTargetId=0,this.ws=0,this._s=new lu,this.targetCount=0,this.gs=Tc.Jt()}forEachTarget(t,e){return this.ds.forEach(((t,n)=>e(n))),Oa.resolve()}getLastRemoteSnapshotVersion(t){return Oa.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Oa.resolve(this.ws)}allocateTargetId(t){return this.highestTargetId=this.gs.next(),Oa.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Oa.resolve()}te(t){this.ds.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.gs=new Tc(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)}addTargetData(t,e){return this.te(e),this.targetCount+=1,Oa.resolve()}updateTargetData(t,e){return this.te(e),Oa.resolve()}removeTargetData(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Oa.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.ds.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.ds.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Oa.waitFor(s).next((()=>r))}getTargetCount(t){return Oa.resolve(this.targetCount)}getTargetData(t,e){const n=this.ds.get(e)||null;return Oa.resolve(n)}addMatchingKeys(t,e,n){return this._s.Jn(e,n),Oa.resolve()}removeMatchingKeys(t,e,n){this._s.Xn(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Oa.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._s.Zn(e),Oa.resolve()}getMatchingKeysForTargetId(t,e){const n=this._s.es(e);return Oa.resolve(n)}containsKey(t,e){return Oa.resolve(this._s.containsKey(e))}}class yu{constructor(t,e){this.ys={},this.Ne=new Vr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.Ue=new pu(this),this.qt=new uc,this.qe=function(t,e){return new gu(t,e)}(this.qt,(t=>this.referenceDelegate.ps(t))),this.R=new Wa(e),this.Ke=new hu(this.R)}start(){return Promise.resolve()}shutdown(){return this.xe=!1,Promise.resolve()}get started(){return this.xe}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.qt}getMutationQueue(t){let e=this.ys[t.toKey()];return e||(e=new fu(this.qt,this.referenceDelegate),this.ys[t.toKey()]=e),e}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getBundleCache(){return this.Ke}runTransaction(t,e,n){$r("MemoryPersistence","Starting transaction:",t);const r=new wu(this.Ne.next());return this.referenceDelegate.Es(),n(r).next((t=>this.referenceDelegate.Ts(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Is(t,e){return Oa.or(Object.values(this.ys).map((n=>()=>n.containsKey(t,e))))}}class wu extends ka{constructor(t){super(),this.currentSequenceNumber=t}}class vu{constructor(t){this.persistence=t,this.As=new lu,this.Rs=null}static Ps(t){return new vu(t)}get bs(){if(this.Rs)return this.Rs;throw Hr()}addReference(t,e,n){return this.As.addReference(n,e),this.bs.delete(n.toString()),Oa.resolve()}removeReference(t,e,n){return this.As.removeReference(n,e),this.bs.add(n.toString()),Oa.resolve()}markPotentiallyOrphaned(t,e){return this.bs.add(e.toString()),Oa.resolve()}removeTarget(t,e){this.As.Zn(e.targetId).forEach((t=>this.bs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.bs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Es(){this.Rs=new Set}Ts(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Oa.forEach(this.bs,(n=>{const r=Ts.fromPath(n);return this.vs(t,r).next((t=>{t||e.removeEntry(r)}))})).next((()=>(this.Rs=null,e.apply(t))))}updateLimboDocument(t,e){return this.vs(t,e).next((t=>{t?this.bs.delete(e.toString()):this.bs.add(e.toString())}))}ps(t){return 0}vs(t,e){return Oa.or([()=>Oa.resolve(this.As.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Is(t,e)])}}class bu{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}function Eu(t,e){return`firestore_clients_${t}_${e}`}function Tu(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Iu(t,e){return`firestore_targets_${t}_${e}`}bu.UNAUTHENTICATED=new bu(null),bu.GOOGLE_CREDENTIALS=new bu("google-credentials-uid"),bu.FIRST_PARTY=new bu("first-party-uid");class _u{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Vs(t,e,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new qr(r.error.code,r.error.message))),i?new _u(t,e,r.state,s):(Kr("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ss(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Su{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Vs(t,e){const n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new qr(n.error.code,n.error.message))),s?new Su(t,n.state,r):(Kr("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Ss(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Au{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Vs(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Eo();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Es(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new Au(t,s):(Kr("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Du{constructor(t,e){this.clientId=t,this.onlineState=e}static Vs(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Du(e.clientId,e.onlineState):(Kr("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Nu{constructor(){this.activeTargetIds=Eo()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}Cs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class xu{constructor(t,e,n,r,s){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.$s=new oo(Jr),this.started=!1,this.Os=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Fs=Eu(this.persistenceKey,this.Ns),this.Ms=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.$s=this.$s.insert(this.Ns,new Nu),this.Ls=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Bs=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.Us=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.qs=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Ks=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}static gt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.fn();for(const e of t){if(e===this.Ns)continue;const t=this.getItem(Eu(this.persistenceKey,e));if(t){const n=Au.Vs(e,t);n&&(this.$s=this.$s.insert(n.clientId,n))}}this.js();const e=this.storage.getItem(this.qs);if(e){const t=this.Qs(e);t&&this.Ws(t)}for(const t of this.Os)this.ks(t);this.Os=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Ms,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Gs(this.$s)}isActiveQueryTarget(t){let e=!1;return this.$s.forEach(((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.zs(t,"pending")}updateMutationState(t,e,n){this.zs(t,e,n),this.Hs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(Iu(this.persistenceKey,t));if(n){const r=Su.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.js(),e}removeLocalQueryTarget(t){this.Js.Cs(t),this.js()}isLocalQueryTarget(t){return this.Js.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Iu(this.persistenceKey,t))}updateQueryState(t,e,n){this.Ys(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Hs(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Xs(t)}notifyBundleLoaded(){this.Zs()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Fs),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return $r("SharedClientState","READ",t,e),e}setItem(t,e){$r("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){$r("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ks(t){const e=t;if(e.storageArea===this.storage){if($r("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Fs)return void Kr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Ls.test(e.key)){if(null==e.newValue){const t=this.ti(e.key);return this.ei(t,null)}{const t=this.ni(e.key,e.newValue);if(t)return this.ei(t.clientId,t)}}else if(this.Bs.test(e.key)){if(null!==e.newValue){const t=this.si(e.key,e.newValue);if(t)return this.ii(t)}}else if(this.Us.test(e.key)){if(null!==e.newValue){const t=this.ri(e.key,e.newValue);if(t)return this.oi(t)}}else if(e.key===this.qs){if(null!==e.newValue){const t=this.Qs(e.newValue);if(t)return this.Ws(t)}}else if(e.key===this.Ms){const t=function(t){let e=Vr.o;if(null!=t)try{const n=JSON.parse(t);Qr("number"==typeof n),e=n}catch(t){Kr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Vr.o&&this.sequenceNumberHandler(t)}else if(e.key===this.Ks)return this.syncEngine.ci()}else this.Os.push(e)}))}}get Js(){return this.$s.get(this.Ns)}js(){this.setItem(this.Fs,this.Js.Ss())}zs(t,e,n){const r=new _u(this.currentUser,t,e,n),s=Tu(this.persistenceKey,this.currentUser,t);this.setItem(s,r.Ss())}Hs(t){const e=Tu(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Xs(t){const e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.qs,JSON.stringify(e))}Ys(t,e,n){const r=Iu(this.persistenceKey,t),s=new Su(t,e,n);this.setItem(r,s.Ss())}Zs(){this.setItem(this.Ks,"value-not-used")}ti(t){const e=this.Ls.exec(t);return e?e[1]:null}ni(t,e){const n=this.ti(t);return Au.Vs(n,e)}si(t,e){const n=this.Bs.exec(t),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return _u.Vs(new bu(s),r,e)}ri(t,e){const n=this.Us.exec(t),r=Number(n[1]);return Su.Vs(r,e)}Qs(t){return Du.Vs(t)}async ii(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.ui(t.batchId,t.state,t.error);$r("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}oi(t){return this.syncEngine.ai(t.targetId,t.state,t.error)}ei(t,e){const n=e?this.$s.insert(t,e):this.$s.remove(t),r=this.Gs(this.$s),s=this.Gs(n),i=[],o=[];return s.forEach((t=>{r.has(t)||i.push(t)})),r.forEach((t=>{s.has(t)||o.push(t)})),this.syncEngine.hi(i,o).then((()=>{this.$s=n}))}Ws(t){this.$s.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Gs(t){let e=Eo();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class Cu{constructor(){this.li=new Nu,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.li.Ds(t),this.fi[t]||"not-current"}updateQueryState(t,e,n){this.fi[t]=e}removeLocalQueryTarget(t){this.li.Cs(t)}isLocalQueryTarget(t){return this.li.activeTargetIds.has(t)}clearQueryState(t){delete this.fi[t]}getAllActiveQueryTargets(){return this.li.activeTargetIds}isActiveQueryTarget(t){return this.li.activeTargetIds.has(t)}start(){return this.li=new Nu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class Ru{di(t){}shutdown(){}}class ku{constructor(){this.wi=()=>this._i(),this.mi=()=>this.gi(),this.yi=[],this.pi()}di(t){this.yi.push(t)}shutdown(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)}pi(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)}_i(){$r("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.yi)t(0)}gi(){$r("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.yi)t(1)}static gt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Lu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Ou{constructor(t){this.Ei=t.Ei,this.Ti=t.Ti}Ii(t){this.Ai=t}Ri(t){this.Pi=t}onMessage(t){this.bi=t}close(){this.Ti()}send(t){this.Ei(t)}vi(){this.Ai()}Vi(t){this.Pi(t)}Si(t){this.bi(t)}}class Mu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Ni(t,e,n,r){const s=this.xi(t,e);$r("RestConnection","Sending: ",s,n);const i={};return this.ki(i,r),this.$i(t,s,i,n).then((t=>($r("RestConnection","Received: ",t),t)),(e=>{throw Gr("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e}))}Oi(t,e,n,r){return this.Ni(t,e,n,r)}ki(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+Pr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}xi(t,e){const n=Lu[t];return`${this.Di}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}$i(t,e,n,r){return new Promise(((s,i)=>{const o=new Fr;o.listenOnce(Cr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case xr.NO_ERROR:const e=o.getResponseJson();$r("Connection","XHR received:",JSON.stringify(e)),s(e);break;case xr.TIMEOUT:$r("Connection",'RPC "'+t+'" timed out'),i(new qr(Ur.DEADLINE_EXCEEDED,"Request time out"));break;case xr.HTTP_ERROR:const n=o.getStatus();if($r("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Ur).indexOf(e)>=0?e:Ur.UNKNOWN}(t.status);i(new qr(e,t.message))}else i(new qr(Ur.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new qr(Ur.UNAVAILABLE,"Connection failed."));break;default:Hr()}}finally{$r("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}Fi(t,e){const n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new _r,s=pe(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};var o;this.useFetchStreams&&(i.xmlHttpFactory=new Or({})),this.ki(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())||"object"==typeof navigator&&"ReactNative"===navigator.product||c().indexOf("Electron/")>=0||function(){var t=c();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||c().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(i.httpHeadersOverwriteParam="$httpHeaders");const a=n.join("");$r("Connection","Creating WebChannel: "+a,i);const u=r.createWebChannel(a,i);let h=!1,l=!1;const d=new Ou({Ei:t=>{l?$r("Connection","Not sending because WebChannel is closed:",t):(h||($r("Connection","Opening WebChannel transport."),u.open(),h=!0),$r("Connection","WebChannel sending:",t),u.send(t))},Ti:()=>u.close()}),f=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return f(u,Mr.EventType.OPEN,(()=>{l||$r("Connection","WebChannel transport opened.")})),f(u,Mr.EventType.CLOSE,(()=>{l||(l=!0,$r("Connection","WebChannel transport closed"),d.Vi())})),f(u,Mr.EventType.ERROR,(t=>{l||(l=!0,Gr("Connection","WebChannel transport errored:",t),d.Vi(new qr(Ur.UNAVAILABLE,"The operation could not be completed")))})),f(u,Mr.EventType.MESSAGE,(t=>{var e;if(!l){const n=t.data[0];Qr(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){$r("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=no[t];if(void 0!==e)return io(e)}(t),n=s.message;void 0===e&&(e=Ur.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),l=!0,d.Vi(new qr(e,n)),u.close()}else $r("Connection","WebChannel received:",n),d.Si(n)}})),f(s,Rr.STAT_EVENT,(t=>{t.stat===kr?$r("Connection","Detected buffering proxy"):t.stat===Lr&&$r("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.vi()}),0),d}}function Fu(){return"undefined"!=typeof window?window:null}function Pu(){return"undefined"!=typeof document?document:null}function Vu(t){return new Lo(t,!0)}class Uu{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=s,this.Ui=0,this.qi=null,this.Ki=Date.now(),this.reset()}reset(){this.Ui=0}ji(){this.Ui=this.Bi}Qi(t){this.cancel();const e=Math.floor(this.Ui+this.Wi()),n=Math.max(0,Date.now()-this.Ki),r=Math.max(0,e-n);r>0&&$r("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ui} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qi=this.Se.enqueueAfterDelay(this.timerId,r,(()=>(this.Ki=Date.now(),t()))),this.Ui*=this.Li,this.Ui<this.Mi&&(this.Ui=this.Mi),this.Ui>this.Bi&&(this.Ui=this.Bi)}Gi(){null!==this.qi&&(this.qi.skipDelay(),this.qi=null)}cancel(){null!==this.qi&&(this.qi.cancel(),this.qi=null)}Wi(){return(Math.random()-.5)*this.Ui}}class qu{constructor(t,e,n,r,s,i){this.Se=t,this.zi=n,this.Hi=r,this.Ji=s,this.listener=i,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Uu(t,e)}tr(){return 1===this.state||2===this.state||4===this.state}er(){return 2===this.state}start(){3!==this.state?this.auth():this.nr()}async stop(){this.tr()&&await this.close(0)}sr(){this.state=0,this.Zi.reset()}ir(){this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(()=>this.rr())))}cr(t){this.ur(),this.stream.send(t)}async rr(){if(this.er())return this.close(0)}ur(){this.Xi&&(this.Xi.cancel(),this.Xi=null)}async close(t,e){this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Ur.RESOURCE_EXHAUSTED?(Kr(e.toString()),Kr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.ji()):e&&e.code===Ur.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ri(e)}ar(){}auth(){this.state=1;const t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then((t=>{this.Yi===e&&this.lr(t)}),(e=>{t((()=>{const t=new qr(Ur.UNKNOWN,"Fetching auth token failed: "+e.message);return this.dr(t)}))}))}lr(t){const e=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((()=>{e((()=>(this.state=2,this.listener.Ii())))})),this.stream.Ri((t=>{e((()=>this.dr(t)))})),this.stream.onMessage((t=>{e((()=>this.onMessage(t)))}))}nr(){this.state=4,this.Zi.Qi((async()=>{this.state=0,this.start()}))}dr(t){return $r("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}hr(t){return e=>{this.Se.enqueueAndForget((()=>this.Yi===t?e():($r("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Bu extends qu{constructor(t,e,n,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,s),this.R=r}wr(t){return this.Hi.Fi("Listen",t)}onMessage(t){this.Zi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Hr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.I?(Qr(void 0===e||"string"==typeof e),ls.fromBase64String(e||"")):(Qr(void 0===e||e instanceof Uint8Array),ls.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ur.UNKNOWN:io(t.code);return new qr(e,t.message||"")}(o);n=new Ao(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Bo(t,r.document.name),i=Po(r.document.updateTime),o=new Ps({mapValue:{fields:r.document.fields}}),a=Us.newFoundDocument(s,i,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new _o(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Bo(t,r.document),i=r.readTime?Po(r.readTime):ns.min(),o=Us.newNoDocument(s,i),a=r.removedTargetIds||[];n=new _o([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Bo(t,r.document),i=r.removedTargetIds||[];n=new _o([],i,s,null)}else{if(!("filter"in e))return Hr();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,s=new eo(r),i=t.targetId;n=new So(i,s)}}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return ns.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ns.min():e.readTime?Po(e.readTime):ns.min()}(t);return this.listener._r(e,n)}mr(t){const e={};e.database=Ko(this.R),e.addTarget=function(t,e){let n;const r=e.target;return n=Ks(r)?{documents:Yo(t,r)}:{query:Xo(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Mo(t,e.resumeToken):e.snapshotVersion.compareTo(ns.min())>0&&(n.readTime=Oo(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Hr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)}gr(t){const e={};e.database=Ko(this.R),e.removeTarget=t,this.cr(e)}}class ju extends qu{constructor(t,e,n,r,s){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,s),this.R=r,this.yr=!1}get pr(){return this.yr}start(){this.yr=!1,this.lastStreamToken=void 0,super.start()}ar(){this.yr&&this.Er([])}wr(t){return this.Hi.Fi("Write",t)}onMessage(t){if(Qr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.yr){this.Zi.reset();const e=function(t,e){return t&&t.length>0?(Qr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Po(t.updateTime):Po(e);return n.isEqual(ns.min())&&(n=Po(e)),new Ui(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Po(t.commitTime);return this.listener.Tr(n,e)}return Qr(!t.writeResults||0===t.writeResults.length),this.yr=!0,this.listener.Ir()}Ar(){const t={};t.database=Ko(this.R),this.cr(t)}Er(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Qo(this.R,t)))};this.cr(e)}}class $u extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Hi=e,this.R=n,this.Rr=!1}Pr(){if(this.Rr)throw new qr(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}Ni(t,e,n){return this.Pr(),this.credentials.getToken().then((r=>this.Hi.Ni(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new qr(Ur.UNKNOWN,t.toString())}))}Oi(t,e,n){return this.Pr(),this.credentials.getToken().then((r=>this.Hi.Oi(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new qr(Ur.UNKNOWN,t.toString())}))}terminate(){this.Rr=!0}}class Ku{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.br=0,this.vr=null,this.Vr=!0}Sr(){0===this.br&&(this.Dr("Unknown"),this.vr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.vr=null,this.Cr("Backend didn't respond within 10 seconds."),this.Dr("Offline"),Promise.resolve()))))}Nr(t){"Online"===this.state?this.Dr("Unknown"):(this.br++,this.br>=1&&(this.kr(),this.Cr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Dr("Offline")))}set(t){this.kr(),this.br=0,"Online"===t&&(this.Vr=!1),this.Dr(t)}Dr(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Cr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(Kr(e),this.Vr=!1):$r("OnlineStateTracker",e)}kr(){null!==this.vr&&(this.vr.cancel(),this.vr=null)}}class Gu{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.$r=[],this.Or=new Map,this.Fr=new Set,this.Mr=[],this.Lr=s,this.Lr.di((t=>{n.enqueueAndForget((async()=>{th(this)&&($r("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Wr(t);e.Fr.add(4),await Hu(e),e.Br.set("Unknown"),e.Fr.delete(4),await zu(e)}(this))}))})),this.Br=new Ku(n,r)}}async function zu(t){if(th(t))for(const e of t.Mr)await e(!0)}async function Hu(t){for(const e of t.Mr)await e(!1)}function Qu(t,e){const n=Wr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Zu(n)?Ju(n):yh(n).er()&&Yu(n,e))}function Wu(t,e){const n=Wr(t),r=yh(n);n.Or.delete(e),r.er()&&Xu(n,e),0===n.Or.size&&(r.er()?r.ir():th(n)&&n.Br.set("Unknown"))}function Yu(t,e){t.Ur.q(e.targetId),yh(t).mr(e)}function Xu(t,e){t.Ur.q(e),yh(t).gr(e)}function Ju(t){t.Ur=new No({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.Or.get(e)||null}),yh(t).start(),t.Br.Sr()}function Zu(t){return th(t)&&!yh(t).tr()&&t.Or.size>0}function th(t){return 0===Wr(t).Fr.size}function eh(t){t.Ur=void 0}async function nh(t){t.Or.forEach(((e,n)=>{Yu(t,e)}))}async function rh(t,e){eh(t),Zu(t)?(t.Br.Nr(e),Ju(t)):t.Br.set("Unknown")}async function sh(t,e,n){if(t.Br.set("Online"),e instanceof Ao&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Or.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Or.delete(r),t.Ur.removeTarget(r))}(t,e)}catch(n){$r("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ih(t,n)}else if(e instanceof _o?t.Ur.X(e):e instanceof So?t.Ur.rt(e):t.Ur.et(e),!n.isEqual(ns.min()))try{const e=await eu(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Ur.ut(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Or.get(r);s&&t.Or.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.Or.get(e);if(!n)return;t.Or.set(e,n.withResumeToken(ls.EMPTY_BYTE_STRING,n.snapshotVersion)),Xu(t,e);const r=new Qa(n.target,e,1,n.sequenceNumber);Yu(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){$r("RemoteStore","Failed to raise snapshot:",e),await ih(t,e)}}async function ih(t,e,n){if(!Ua(e))throw e;t.Fr.add(1),await Hu(t),t.Br.set("Offline"),n||(n=()=>eu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{$r("RemoteStore","Retrying IndexedDB access"),await n(),t.Fr.delete(1),await zu(t)}))}function oh(t,e){return e().catch((n=>ih(t,n,e)))}async function ah(t){const e=Wr(t),n=wh(e);let r=e.$r.length>0?e.$r[e.$r.length-1].batchId:-1;for(;ch(e);)try{const t=await ru(e.localStore,r);if(null===t){0===e.$r.length&&n.ir();break}r=t.batchId,uh(e,t)}catch(t){await ih(e,t)}hh(e)&&lh(e)}function ch(t){return th(t)&&t.$r.length<10}function uh(t,e){t.$r.push(e);const n=wh(t);n.er()&&n.pr&&n.Er(e.mutations)}function hh(t){return th(t)&&!wh(t).tr()&&t.$r.length>0}function lh(t){wh(t).start()}async function dh(t){wh(t).Ar()}async function fh(t){const e=wh(t);for(const n of t.$r)e.Er(n.mutations)}async function gh(t,e,n){const r=t.$r.shift(),s=Ha.from(r,e,n);await oh(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await ah(t)}async function mh(t,e){e&&wh(t).pr&&await async function(t,e){if(so(n=e.code)&&n!==Ur.ABORTED){const n=t.$r.shift();wh(t).sr(),await oh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await ah(t)}var n}(t,e),hh(t)&&lh(t)}async function ph(t,e){const n=Wr(t);e?(n.Fr.delete(2),await zu(n)):e||(n.Fr.add(2),await Hu(n),n.Br.set("Unknown"))}function yh(t){return t.qr||(t.qr=function(t,e,n){const r=Wr(t);return r.Pr(),new Bu(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:nh.bind(null,t),Ri:rh.bind(null,t),_r:sh.bind(null,t)}),t.Mr.push((async e=>{e?(t.qr.sr(),Zu(t)?Ju(t):t.Br.set("Unknown")):(await t.qr.stop(),eh(t))}))),t.qr}function wh(t){return t.Kr||(t.Kr=function(t,e,n){const r=Wr(t);return r.Pr(),new ju(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:dh.bind(null,t),Ri:mh.bind(null,t),Ir:fh.bind(null,t),Tr:gh.bind(null,t)}),t.Mr.push((async e=>{e?(t.Kr.sr(),await ah(t)):(await t.Kr.stop(),t.$r.length>0&&($r("RemoteStore",`Stopping write stream with ${t.$r.length} pending writes`),t.$r=[]))}))),t.Kr}class vh{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new La,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new vh(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qr(Ur.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bh(t,e){if(Kr("AsyncQueue",`${e}: ${t}`),Ua(t))return new qr(Ur.UNAVAILABLE,`${e}: ${t}`);throw t}class Eh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Ts.comparator(e.key,n.key):(t,e)=>Ts.comparator(t.key,e.key),this.keyedMap=mo(),this.sortedSet=new oo(this.comparator)}static emptySet(t){return new Eh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Eh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Eh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Th{constructor(){this.jr=new oo(Ts.comparator)}track(t){const e=t.doc.key,n=this.jr.get(e);n?0!==t.type&&3===n.type?this.jr=this.jr.insert(e,t):3===t.type&&1!==n.type?this.jr=this.jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.jr=this.jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.jr=this.jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.jr=this.jr.remove(e):1===t.type&&2===n.type?this.jr=this.jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.jr=this.jr.insert(e,{type:2,doc:t.doc}):Hr():this.jr=this.jr.insert(e,t)}Qr(){const t=[];return this.jr.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Ih{constructor(t,e,n,r,s,i,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Ih(t,e,Eh.emptySet(e),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&yi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class _h{constructor(){this.Wr=void 0,this.listeners=[]}}class Sh{constructor(){this.queries=new Oc((t=>wi(t)),yi),this.onlineState="Unknown",this.Gr=new Set}}async function Ah(t,e){const n=Wr(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new _h),s)try{i.Wr=await n.onListen(r)}catch(t){const n=bh(t,`Initialization of query '${vi(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.zr(n.onlineState),i.Wr&&e.Hr(i.Wr)&&Ch(n)}async function Dh(t,e){const n=Wr(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Nh(t,e){const n=Wr(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Hr(t)&&(r=!0);s.Wr=t}}r&&Ch(n)}function xh(t,e,n){const r=Wr(t),s=r.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);r.queries.delete(e)}function Ch(t){t.Gr.forEach((t=>{t.next()}))}class Rh{constructor(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}Hr(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ih(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),e=!0):this.eo(t,this.onlineState)&&(this.no(t),e=!0),this.Xr=t,e}onError(t){this.Jr.error(t)}zr(t){this.onlineState=t;let e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e}eo(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)}Zr(t){if(t.docChanges.length>0)return!0;const e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}no(t){t=Ih.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)}}class kh{constructor(t,e){this.payload=t,this.byteLength=e}io(){return"metadata"in this.payload}}class Lh{constructor(t){this.R=t}Un(t){return Bo(this.R,t)}qn(t){return t.metadata.exists?Ho(this.R,t.document,!1):Us.newNoDocument(this.Un(t.metadata.name),this.Kn(t.metadata.readTime))}Kn(t){return Po(t)}}class Oh{constructor(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=Mh(t)}oo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}co(t){const e=new Map,n=new Lh(this.R);for(const r of t)if(r.metadata.queries){const t=n.Un(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||vo()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=Wr(t);let i=vo(),o=fo(),a=yo();for(const t of n){const n=e.Un(t.metadata.name);t.document&&(i=i.add(n)),o=o.insert(n,e.qn(t)),a=a.insert(n,e.Kn(t.metadata.readTime))}const c=s.Fn.newChangeBuffer({trackRemovals:!0}),u=await su(s,function(t){return mi(ci(as.fromString(`__bundle__/docs/${t}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(t=>nu(t,c,o,ns.min(),a).next((e=>(c.apply(t),e))).next((e=>s.Ue.removeMatchingKeysForTargetId(t,u.targetId).next((()=>s.Ue.addMatchingKeys(t,i,u.targetId))).next((()=>s.Mn.En(t,e))).next((()=>e))))))}(this.localStore,new Lh(this.R),this.documents,this.ro.id),e=this.co(this.documents);for(const t of this.queries)await uu(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new Qc(Object.assign({},this.progress),t)}}function Mh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class Fh{constructor(t){this.key=t}}class Ph{constructor(t){this.key=t}}class Vh{constructor(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=vo(),this.mutatedKeys=vo(),this.lo=Ei(t),this.fo=new Eh(this.lo)}get wo(){return this.uo}_o(t,e){const n=e?e.mo:new Th,r=e?e.fo:this.fo;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a=ui(this.query)&&r.size===this.query.limit?r.last():null,c=hi(this.query)&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=bi(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.yo(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.lo(h,a)>0||c&&this.lo(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),ui(this.query)||hi(this.query))for(;i.size>this.query.limit;){const t=ui(this.query)?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{fo:i,mo:n,Nn:o,mutatedKeys:s}}yo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;const s=t.mo.Qr();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Hr()}};return n(t)-n(e)}(t.type,e.type)||this.lo(t.doc,e.doc))),this.po(n);const i=e?this.Eo():[],o=0===this.ho.size&&this.current?1:0,a=o!==this.ao;return this.ao=o,0!==s.length||a?{snapshot:new Ih(this.query,t.fo,r,s,t.mutatedKeys,0===o,a,!1),To:i}:{To:i}}zr(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Th,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}}Io(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations}po(t){t&&(t.addedDocuments.forEach((t=>this.uo=this.uo.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.uo=this.uo.delete(t))),this.current=t.current)}Eo(){if(!this.current)return[];const t=this.ho;this.ho=vo(),this.fo.forEach((t=>{this.Io(t.key)&&(this.ho=this.ho.add(t.key))}));const e=[];return t.forEach((t=>{this.ho.has(t)||e.push(new Ph(t))})),this.ho.forEach((n=>{t.has(n)||e.push(new Fh(n))})),e}Ao(t){this.uo=t.Bn,this.ho=vo();const e=this._o(t.documents);return this.applyChanges(e,!0)}Ro(){return Ih.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)}}class Uh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class qh{constructor(t){this.key=t,this.Po=!1}}class Bh{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.bo={},this.vo=new Oc((t=>wi(t)),yi),this.Vo=new Map,this.So=new Set,this.Do=new oo(Ts.comparator),this.Co=new Map,this.No=new lu,this.xo={},this.ko=new Map,this.$o=Tc.Yt(),this.onlineState="Unknown",this.Oo=void 0}get isPrimaryClient(){return!0===this.Oo}}async function jh(t,e){const n=gl(t);let r,s;const i=n.vo.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Ro();else{const t=await su(n.localStore,mi(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await $h(n,e,r,"current"===i),n.isPrimaryClient&&Qu(n.remoteStore,t)}return s}async function $h(t,e,n,r){t.Fo=(e,n,r)=>async function(t,e,n,r){let s=e.view._o(n);s.Nn&&(s=await ou(t.localStore,e.query,!1).then((({documents:t})=>e.view._o(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return tl(t,e.targetId,o.To),o.snapshot}(t,e,n,r);const s=await ou(t.localStore,e,!0),i=new Vh(e,s.Bn),o=i._o(s.documents),a=Io.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=i.applyChanges(o,t.isPrimaryClient,a);tl(t,n,c.To);const u=new Uh(e,n,i);return t.vo.set(e,u),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot}async function Kh(t,e){const n=Wr(t),r=n.vo.get(e),s=n.Vo.get(r.targetId);if(s.length>1)return n.Vo.set(r.targetId,s.filter((t=>!yi(t,e)))),void n.vo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await iu(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Wu(n.remoteStore,r.targetId),Jh(n,r.targetId)})).catch(Dc)):(Jh(n,r.targetId),await iu(n.localStore,r.targetId,!0))}async function Gh(t,e){const n=Wr(t);try{const t=await function(t,e){const n=Wr(t),r=e.snapshotVersion;let s=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Fn.newChangeBuffer({trackRemovals:!0});s=n.kn;const o=[];e.targetChanges.forEach(((e,i)=>{const a=s.get(i);if(!a)return;o.push(n.Ue.removeMatchingKeys(t,e.removedDocuments,i).next((()=>n.Ue.addMatchingKeys(t,e.addedDocuments,i))));const c=e.resumeToken;if(c.approximateByteSize()>0){const u=a.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber);s=s.insert(i,u),function(t,e,n){return Qr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,e)&&o.push(n.Ue.updateTargetData(t,u))}}));let a=fo();if(e.documentUpdates.forEach(((r,s)=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(nu(t,i,e.documentUpdates,r,void 0).next((t=>{a=t}))),!r.isEqual(ns.min())){const e=n.Ue.getLastRemoteSnapshotVersion(t).next((e=>n.Ue.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Oa.waitFor(o).next((()=>i.apply(t))).next((()=>n.Mn.En(t,a))).next((()=>a))})).then((t=>(n.kn=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Co.get(e);r&&(Qr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Po=!0:t.modifiedDocuments.size>0?Qr(r.Po):t.removedDocuments.size>0&&(Qr(r.Po),r.Po=!1))})),await rl(n,t,e)}catch(t){await Dc(t)}}function zh(t,e,n){const r=Wr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.vo.forEach(((n,r)=>{const s=r.view.zr(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Wr(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.zr(e)&&(r=!0)})),r&&Ch(n)}(r.eventManager,e),t.length&&r.bo._r(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Hh(t,e,n){const r=Wr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Co.get(e),i=s&&s.key;if(i){let t=new oo(Ts.comparator);t=t.insert(i,Us.newNoDocument(i,ns.min()));const n=vo().add(i),s=new To(ns.min(),new Map,new uo(Jr),t,n);await Gh(r,s),r.Do=r.Do.remove(i),r.Co.delete(e),nl(r)}else await iu(r.localStore,e,!1).then((()=>Jh(r,e,n))).catch(Dc)}async function Qh(t,e){const n=Wr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Wr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Fn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Oa.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);Qr(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),o.next((()=>t._n.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n._n.performConsistencyCheck(t))).next((()=>n.Mn.pn(t,r)))}))}(n.localStore,e);Xh(n,r,null),Yh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await rl(n,t)}catch(t){await Dc(t)}}async function Wh(t,e,n){const r=Wr(t);try{const t=await function(t,e){const n=Wr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n._n.lookupMutationBatch(t,e).next((e=>(Qr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)))).next((()=>n._n.performConsistencyCheck(t))).next((()=>n.Mn.pn(t,r)))}))}(r.localStore,e);Xh(r,e,n),Yh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await rl(r,t)}catch(n){await Dc(n)}}function Yh(t,e){(t.ko.get(e)||[]).forEach((t=>{t.resolve()})),t.ko.delete(e)}function Xh(t,e,n){const r=Wr(t);let s=r.xo[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.xo[r.currentUser.toKey()]=s}}function Jh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Vo.get(e))t.vo.delete(r),n&&t.bo.Mo(r,n);t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((e=>{t.No.containsKey(e)||Zh(t,e)}))}function Zh(t,e){t.So.delete(e.path.canonicalString());const n=t.Do.get(e);null!==n&&(Wu(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),nl(t))}function tl(t,e,n){for(const r of n)r instanceof Fh?(t.No.addReference(r.key,e),el(t,r)):r instanceof Ph?($r("SyncEngine","Document no longer in limbo: "+r.key),t.No.removeReference(r.key,e),t.No.containsKey(r.key)||Zh(t,r.key)):Hr()}function el(t,e){const n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||($r("SyncEngine","New document in limbo: "+n),t.So.add(r),nl(t))}function nl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){const e=t.So.values().next().value;t.So.delete(e);const n=new Ts(as.fromString(e)),r=t.$o.next();t.Co.set(r,new qh(n)),t.Do=t.Do.insert(n,r),Qu(t.remoteStore,new Qa(mi(ci(n.path)),r,2,Vr.o))}}async function rl(t,e,n){const r=Wr(t),s=[],i=[],o=[];r.vo.isEmpty()||(r.vo.forEach(((t,a)=>{o.push(r.Fo(a,e,n).then((t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=Yc.vn(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.bo._r(s),await async function(t,e){const n=Wr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Oa.forEach(e,(e=>Oa.forEach(e.Pn,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Oa.forEach(e.bn,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Ua(t))throw t;$r("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.kn.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.kn=n.kn.insert(e,s)}}}(r.localStore,i))}async function sl(t,e){const n=Wr(t);if(!n.currentUser.isEqual(e)){$r("SyncEngine","User change. New user:",e.toKey());const t=await tu(n.localStore,e);n.currentUser=e,function(t,e){t.ko.forEach((t=>{t.forEach((t=>{t.reject(new qr(Ur.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await rl(n,t.Ln)}}function il(t,e){const n=Wr(t),r=n.Co.get(e);if(r&&r.Po)return vo().add(r.key);{let t=vo();const r=n.Vo.get(e);if(!r)return t;for(const e of r){const r=n.vo.get(e);t=t.unionWith(r.view.wo)}return t}}async function ol(t,e){const n=Wr(t),r=await ou(n.localStore,e.query,!0),s=e.view.Ao(r);return n.isPrimaryClient&&tl(n,e.targetId,s.To),s}async function al(t){const e=Wr(t);return cu(e.localStore).then((t=>rl(e,t)))}async function cl(t,e,n,r){const s=Wr(t),i=await function(t,e){const n=Wr(t),r=Wr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>r.Qt(t,e).next((e=>e?n.Mn.pn(t,e):Oa.resolve(null)))))}(s.localStore,e);null!==i?("pending"===n?await ah(s.remoteStore):"acknowledged"===n||"rejected"===n?(Xh(s,e,r||null),Yh(s,e),function(t,e){Wr(Wr(t)._n).Gt(e)}(s.localStore,e)):Hr(),await rl(s,i)):$r("SyncEngine","Cannot apply mutation batch with id: "+e)}async function ul(t,e,n){const r=Wr(t),s=[],i=[];for(const t of e){let e;const n=r.Vo.get(t);if(n&&0!==n.length){e=await su(r.localStore,mi(n[0]));for(const t of n){const e=r.vo.get(t),n=await ol(r,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await au(r.localStore,t);e=await su(r.localStore,n),await $h(r,hl(n),t,!1)}s.push(e)}return r.bo._r(i),s}function hl(t){return ai(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ll(t){const e=Wr(t);return Wr(Wr(e.localStore).persistence).fn()}async function dl(t,e,n,r){const s=Wr(t);if(s.Oo)$r("SyncEngine","Ignoring unexpected query state notification.");else if(s.Vo.has(e))switch(n){case"current":case"not-current":{const t=await cu(s.localStore),r=To.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await rl(s,t,r);break}case"rejected":await iu(s.localStore,e,!0),Jh(s,e,r);break;default:Hr()}}async function fl(t,e,n){const r=gl(t);if(r.Oo){for(const t of e){if(r.Vo.has(t)){$r("SyncEngine","Adding an already active target "+t);continue}const e=await au(r.localStore,t),n=await su(r.localStore,e);await $h(r,hl(e),n.targetId,!1),Qu(r.remoteStore,n)}for(const t of n)r.Vo.has(t)&&await iu(r.localStore,t,!1).then((()=>{Wu(r.remoteStore,t),Jh(r,t)})).catch(Dc)}}function gl(t){const e=Wr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Gh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=il.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Hh.bind(null,e),e.bo._r=Nh.bind(null,e.eventManager),e.bo.Mo=xh.bind(null,e.eventManager),e}function ml(t){const e=Wr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Qh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Wh.bind(null,e),e}class pl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.R=Vu(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.Uo(t),await this.persistence.start(),this.gcScheduler=this.qo(t),this.localStore=this.Ko(t)}qo(t){return null}Ko(t){return Zc(this.persistence,new Xc,t.initialUser,this.R)}Uo(t){return new yu(vu.Ps,this.R)}Bo(t){return new Cu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class yl extends pl{constructor(t,e,n){super(),this.jo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=Wr(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=Uc(t);let n=ns.min();return e.Ot({index:Ea.readTimeIndex,reverse:!0},((t,e,r)=>{e.readTime&&(n=Za(e.readTime)),r.done()})).next((()=>n))}(t))).then((t=>{e.On=t}))}(this.localStore),await this.jo.initialize(this,t),await ml(this.jo.syncEngine),await ah(this.jo.remoteStore)}Ko(t){return Zc(this.persistence,new Xc,t.initialUser,this.R)}qo(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Cc(e,t.asyncQueue)}Uo(t){const e=Hc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?gc.withCacheSize(this.cacheSizeBytes):gc.DEFAULT;return new Kc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Fu(),Pu(),this.R,this.sharedClientState,!!this.forceOwnership)}Bo(t){return new Cu}}class wl extends yl{constructor(t,e){super(t,e,!1),this.jo=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.jo.syncEngine;this.sharedClientState instanceof xu&&(this.sharedClientState.syncEngine={ui:cl.bind(null,e),ai:dl.bind(null,e),hi:fl.bind(null,e),fn:ll.bind(null,e),ci:al.bind(null,e)},await this.sharedClientState.start()),await this.persistence.He((async t=>{await async function(t,e){const n=Wr(t);if(gl(n),ml(n),!0===e&&!0!==n.Oo){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await ul(n,t.toArray());n.Oo=!0,await ph(n.remoteStore,!0);for(const t of e)Qu(n.remoteStore,t)}else if(!1===e&&!1!==n.Oo){const t=[];let e=Promise.resolve();n.Vo.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?t.push(s):e=e.then((()=>(Jh(n,s),iu(n.localStore,s,!0)))),Wu(n.remoteStore,s)})),await e,await ul(n,t),function(t){const e=Wr(t);e.Co.forEach(((t,n)=>{Wu(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new oo(Ts.comparator)}(n),n.Oo=!1,await ph(n.remoteStore,!1)}}(this.jo.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}Bo(t){const e=Fu();if(!xu.gt(e))throw new qr(Ur.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Hc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new xu(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class vl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>zh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=sl.bind(null,this.syncEngine),await ph(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Sh}createDatastore(t){const e=Vu(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new Mu(r));var r;return function(t,e,n){return new $u(t,e,n)}(t.credentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>zh(this.syncEngine,t,0),i=ku.gt()?new ku:new Ru,new Gu(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Bh(t,e,n,r,s,i);return o&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Wr(t);$r("RemoteStore","RemoteStore shutting down."),e.Fr.add(5),await Hu(e),e.Lr.shutdown(),e.Br.set("Unknown")}(this.remoteStore)}}function bl(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class El{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Qo(this.observer.next,t)}error(t){this.observer.error?this.Qo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Wo(){this.muted=!0}Qo(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Tl{constructor(t,e){this.Go=t,this.R=e,this.metadata=new La,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((t=>{t&&t.io()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Go.cancel()}async getMetadata(){return this.metadata.promise}async Lo(){return await this.getMetadata(),this.Ho()}async Ho(){const t=await this.Jo();if(null===t)return null;const e=this.zo.decode(t),n=Number(e);isNaN(n)&&this.Yo(`length string (${e}) is not valid number`);const r=await this.Xo(n);return new kh(JSON.parse(r),t.length+n)}Zo(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async Jo(){for(;this.Zo()<0&&!await this.tc(););if(0===this.buffer.length)return null;const t=this.Zo();t<0&&this.Yo("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Xo(t){for(;this.buffer.length<t;)await this.tc()&&this.Yo("Reached the end of bundle when more is expected.");const e=this.zo.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Yo(t){throw this.Go.cancel(),new Error(`Invalid bundle format: ${t}`)}async tc(){const t=await this.Go.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Il{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new qr(Ur.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Wr(t),r=Ko(n.R)+"/documents",s={documents:e.map((t=>qo(n.R,t)))},i=await n.Oi("BatchGetDocuments",r,s),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){Qr(!!e.found),e.found.name,e.found.updateTime;const n=Bo(t,e.found.name),r=Po(e.found.updateTime),s=new Ps({mapValue:{fields:e.found.fields}});return Us.newFoundDocument(n,r,s)}(t,e):"missing"in e?function(t,e){Qr(!!e.missing),Qr(!!e.readTime);const n=Bo(t,e.missing),r=Po(e.readTime);return Us.newNoDocument(n,r)}(t,e):Hr()}(n.R,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());Qr(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Zi(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=Ts.fromPath(e);this.mutations.push(new to(n,this.precondition(n)))})),await async function(t,e){const n=Wr(t),r=Ko(n.R)+"/documents",s={writes:e.map((t=>Qo(n.R,t)))};await n.Ni("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Hr();e=ns.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new qr(Ur.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?qi.updateTime(e):qi.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ns.min()))throw new qr(Ur.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qi.updateTime(e)}return qi.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class _l{constructor(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Uu(this.asyncQueue,"transaction_retry")}run(){this.ec-=1,this.nc()}nc(){this.Zi.Qi((async()=>{const t=new Il(this.datastore),e=this.sc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.ic(t)}))))})).catch((t=>{this.ic(t)}))}))}sc(t){try{const e=this.updateFunction(t);return!vs(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ic(t){this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((()=>(this.nc(),Promise.resolve())))):this.deferred.reject(t)}rc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!so(e)}return!1}}class Sl{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=bu.UNAUTHENTICATED,this.clientId=Xr.u(),this.credentialListener=()=>Promise.resolve(),this.credentials.setChangeListener(e,(async t=>{$r("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t}))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new qr(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new La;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.removeChangeListener(),t.resolve()}catch(e){const n=bh(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Al(t,e){t.asyncQueue.verifyOperationInProgress(),$r("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await tu(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function Dl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Nl(t);$r("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>async function(t,e){const n=Wr(t);n.asyncQueue.verifyOperationInProgress(),$r("RemoteStore","RemoteStore received new credentials");const r=th(n);n.Fr.add(3),await Hu(n),r&&n.Br.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Fr.delete(3),await zu(n)}(e.remoteStore,t))),t.onlineComponents=e}async function Nl(t){return t.offlineComponents||($r("FirestoreClient","Using default OfflineComponentProvider"),await Al(t,new pl)),t.offlineComponents}async function xl(t){return t.onlineComponents||($r("FirestoreClient","Using default OnlineComponentProvider"),await Dl(t,new vl)),t.onlineComponents}function Cl(t){return Nl(t).then((t=>t.persistence))}function Rl(t){return Nl(t).then((t=>t.localStore))}function kl(t){return xl(t).then((t=>t.remoteStore))}function Ll(t){return xl(t).then((t=>t.syncEngine))}async function Ol(t){const e=await xl(t),n=e.eventManager;return n.onListen=jh.bind(null,e.syncEngine),n.onUnlisten=Kh.bind(null,e.syncEngine),n}function Ml(t,e,n={}){const r=new La;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new El({next:i=>{e.enqueueAndForget((()=>Dh(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new qr(Ur.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new qr(Ur.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new Rh(ci(n.path),i,{includeMetadataChanges:!0,so:!0});return Ah(t,o)}(await Ol(t),t.asyncQueue,e,n,r))),r.promise}function Fl(t,e,n={}){const r=new La;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new El({next:n=>{e.enqueueAndForget((()=>Dh(t,o))),n.fromCache&&"server"===r.source?s.reject(new qr(Ur.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Rh(n,i,{includeMetadataChanges:!0,so:!0});return Ah(t,o)}(await Ol(t),t.asyncQueue,e,n,r))),r.promise}function Pl(t,e,n,r){const s=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new Tl(t,e)}(function(t,e){if(t instanceof Uint8Array)return bl(t,e);if(t instanceof ArrayBuffer)return bl(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Vu(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const r=Wr(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=Wr(t),r=Po(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Ke.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(r)>=0))}(t.localStore,r))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r));n._updateProgress(Mh(r));const s=new Oh(r,t.localStore,e.R);let i=await e.Lo();for(;i;){const t=await s.oo(i);t&&n._updateProgress(t),i=await e.Lo()}const o=await s.complete();await rl(t,o.wn,void 0),await function(t,e){const n=Wr(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Ke.saveBundleMetadata(t,e)))}(t.localStore,r),n._completeWith(o.progress)}catch(t){Gr("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(r,e,n).then((()=>{r.sharedClientState.notifyBundleLoaded()}))}(await Ll(t),s,r)}))}class Vl{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Ul{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ul&&t.projectId===this.projectId&&t.database===this.database}}const ql=new Map;class Bl{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class jl{constructor(){this.changeListener=null}getToken(){return Promise.resolve(null)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(bu.UNAUTHENTICATED)))}removeChangeListener(){this.changeListener=null}}class $l{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}removeChangeListener(){this.changeListener=null}}class Kl{constructor(t){this.currentUser=bu.UNAUTHENTICATED,this.oc=new La,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=()=>{this.cc++,this.currentUser=this.ac(),this.oc.resolve(),this.changeListener&&this.asyncQueue.enqueueRetryable((()=>this.changeListener(this.currentUser)))};const e=t=>{$r("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.uc)};t.onInit((t=>e(t))),setTimeout((()=>{if(!this.auth){const n=t.getImmediate({optional:!0});n?e(n):($r("FirebaseCredentialsProvider","Auth not yet detected"),this.oc.resolve())}}),0)}getToken(){const t=this.cc,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.cc!==t?($r("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Qr("string"==typeof e.accessToken),new Bl(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}setChangeListener(t,e){this.asyncQueue=t,this.asyncQueue.enqueueRetryable((async()=>{await this.oc.promise,await e(this.currentUser),this.changeListener=e}))}removeChangeListener(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=()=>Promise.resolve()}ac(){const t=this.auth&&this.auth.getUid();return Qr(null===t||"string"==typeof t),new bu(t)}}class Gl{constructor(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=bu.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t}}class zl{constructor(t,e,n){this.hc=t,this.lc=e,this.fc=n}getToken(){return Promise.resolve(new Gl(this.hc,this.lc,this.fc))}setChangeListener(t,e){t.enqueueRetryable((()=>e(bu.FIRST_PARTY)))}removeChangeListener(){}invalidateToken(){}}function Hl(t,e,n){if(!n)throw new qr(Ur.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ql(t){if(!Ts.isDocumentKey(t))throw new qr(Ur.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Wl(t){if(Ts.isDocumentKey(t))throw new qr(Ur.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Yl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Hr()}function Xl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new qr(Ur.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yl(t);throw new qr(Ur.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Jl(t,e){if(e<=0)throw new qr(Ur.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Zl{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new qr(Ur.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new qr(Ur.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,r){if(!0===e&&!0===r)throw new qr(Ur.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class td{constructor(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Zl({}),this._settingsFrozen=!1,t instanceof Ul?(this._databaseId=t,this._credentials=new jl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new qr(Ur.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ul(t.options.projectId)}(t),this._credentials=new Kl(e))}get app(){if(!this._app)throw new qr(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new qr(Ur.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Zl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new jl;switch(t.type){case"gapi":const e=t.client;return Qr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new zl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new qr(Ur.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ql.get(t);e&&($r("ComponentProvider","Removing Datastore"),ql.delete(t),e.terminate())}(this),Promise.resolve()}}function ed(t,e,n,r={}){const s=(t=Xl(t,td))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Gr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){const e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var o=i({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),a.encodeString(JSON.stringify(o),!1),""].join(".")}(r.mockUserToken),n=r.mockUserToken.sub||r.mockUserToken.user_id;if(!n)throw new qr(Ur.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new $l(new Bl(e,new bu(n)))}}class nd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new nd(this.firestore,t,this._key)}}class rd{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new rd(this.firestore,t,this._query)}}class sd extends rd{constructor(t,e,n){super(t,e,ci(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new nd(this.firestore,null,new Ts(t))}withConverter(t){return new sd(this.firestore,t,this._path)}}function id(t,e,...n){if(t=g(t),Hl("collection","path",e),t instanceof td){const r=as.fromString(e,...n);return Wl(r),new sd(t,null,r)}{if(!(t instanceof nd||t instanceof sd))throw new qr(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=as.fromString(t.path,...n).child(as.fromString(e));return Wl(r),new sd(t.firestore,null,r)}}function od(t,e,...n){if(t=g(t),1===arguments.length&&(e=Xr.u()),Hl("doc","path",e),t instanceof td){const r=as.fromString(e,...n);return Ql(r),new nd(t,null,new Ts(r))}{if(!(t instanceof nd||t instanceof sd))throw new qr(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(as.fromString(e,...n));return Ql(r),new nd(t.firestore,t instanceof sd?t.converter:null,new Ts(r))}}function ad(t,e){return t=g(t),e=g(e),(t instanceof nd||t instanceof sd)&&(e instanceof nd||e instanceof sd)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function cd(t,e){return t=g(t),e=g(e),t instanceof rd&&e instanceof rd&&t.firestore===e.firestore&&yi(t._query,e._query)&&t.converter===e.converter}class ud{constructor(){this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.gc=null,this.yc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Uu(this,"async_queue_retry"),this.Ic=()=>{const t=Pu();t&&$r("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Zi.Gi()};const t=Pu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ic)}get isShuttingDown(){return this._c}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ac(),this.Rc(t)}enterRestrictedMode(t){if(!this._c){this._c=!0,this.Ec=t||!1;const e=Pu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}}enqueue(t){if(this.Ac(),this._c)return new Promise((()=>{}));const e=new La;return this.Rc((()=>this._c&&this.Ec?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.wc.push(t),this.Pc())))}async Pc(){if(0!==this.wc.length){try{await this.wc[0](),this.wc.shift(),this.Zi.reset()}catch(t){if(!Ua(t))throw t;$r("AsyncQueue","Operation failed with retryable error: "+t)}this.wc.length>0&&this.Zi.Qi((()=>this.Pc()))}}Rc(t){const e=this.dc.then((()=>(this.yc=!0,t().catch((t=>{throw this.gc=t,this.yc=!1,Kr("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((t=>(this.yc=!1,t))))));return this.dc=e,e}enqueueAfterDelay(t,e,n){this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);const r=vh.createAndSchedule(this,t,e,n,(t=>this.bc(t)));return this.mc.push(r),r}Ac(){this.gc&&Hr()}verifyOperationInProgress(){}async vc(){let t;do{t=this.dc,await t}while(t!==this.dc)}Vc(t){for(const e of this.mc)if(e.timerId===t)return!0;return!1}Sc(t){return this.vc().then((()=>{this.mc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.mc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.vc()}))}Dc(t){this.Tc.push(t)}bc(t){const e=this.mc.indexOf(t);this.mc.splice(e,1)}}function hd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class ld{constructor(){this._progressObserver={},this._taskCompletionResolver=new La,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}class dd extends td{constructor(t,e){super(t,e),this.type="firestore",this._queue=new ud,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||gd(this),this._firestoreClient.terminate()}}function fd(t){return t._firestoreClient||gd(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function gd(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new Vl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Sl(t._credentials,t._queue,r)}function md(t,e,n){const r=new La;return t.asyncQueue.enqueue((async()=>{try{await Al(t,n),await Dl(t,e),r.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===Ur.FAILED_PRECONDITION||t.code===Ur.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}function pd(t){return function(t){const e=new La;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Wr(t);th(n.remoteStore)||$r("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=Wr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e._n.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const r=n.ko.get(t)||[];r.push(e),n.ko.set(t,r)}catch(t){const n=bh(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Ll(t),e))),e.promise}(fd(t=Xl(t,dd)))}function yd(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Cl(t),n=await kl(t);return e.setNetworkEnabled(!0),function(t){const e=Wr(t);return e.Fr.delete(0),zu(e)}(n)}))}(fd(t=Xl(t,dd)))}function wd(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Cl(t),n=await kl(t);return e.setNetworkEnabled(!1),async function(t){const e=Wr(t);e.Fr.add(0),await Hu(e),e.Br.set("Offline")}(n)}))}(fd(t=Xl(t,dd)))}function vd(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=Wr(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Ke.getNamedQuery(t,e)))}(await Rl(t),e)))}(fd(t=Xl(t,dd)),e).then((e=>e?new rd(t,null,e.query):null))}function bd(t){if(t._initialized||t._terminated)throw new qr(Ur.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ed{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new qr(Ur.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new us(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Td{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Td(ls.fromBase64String(t))}catch(t){throw new qr(Ur.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Td(ls.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Id{constructor(t){this._methodName=t}}class _d{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new qr(Ur.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new qr(Ur.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Jr(this._lat,t._lat)||Jr(this._long,t._long)}}const Sd=/^__.*__$/;class Ad{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Wi(t,this.data,this.fieldMask,e,this.fieldTransforms):new Qi(t,this.data,e,this.fieldTransforms)}}class Dd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Wi(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Nd(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Hr()}}class xd{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Cc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Nc(){return this.settings.Nc}xc(t){return new xd(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}kc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,$c:!1});return r.Oc(t),r}Fc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,$c:!1});return r.Cc(),r}Mc(t){return this.xc({path:void 0,$c:!0})}Lc(t){return Wd(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.Uc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Cc(){if(this.path)for(let t=0;t<this.path.length;t++)this.Oc(this.path.get(t))}Oc(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Nd(this.Nc)&&Sd.test(t))throw this.Lc('Document fields cannot begin and end with "__"')}}class Cd{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Vu(t)}qc(t,e,n,r=!1){return new xd({Nc:t,methodName:e,Uc:n,path:us.emptyPath(),$c:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)}}function Rd(t){const e=t._freezeSettings(),n=Vu(t._databaseId);return new Cd(t._databaseId,!!e.ignoreUndefinedProperties,n)}function kd(t,e,n,r,s,i={}){const o=t.qc(i.merge||i.mergeFields?2:0,e,n,s);Gd("Data must be an object, but it was:",o,r);const a=$d(r,o);let c,u;if(i.merge)c=new hs(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=zd(e,r,n);if(!o.contains(s))throw new qr(Ur.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Yd(t,s)||t.push(s)}c=new hs(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Ad(new Ps(a),c,u)}class Ld extends Id{_toFieldTransform(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(`${this._methodName}() can only appear at the top level of your update data`):t.Lc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Ld}}function Od(t,e,n){return new xd({Nc:3,Uc:e.settings.Uc,methodName:t._methodName,$c:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}class Md extends Id{_toFieldTransform(t){return new Vi(t.path,new Ci)}isEqual(t){return t instanceof Md}}class Fd extends Id{constructor(t,e){super(t),this.Kc=e}_toFieldTransform(t){const e=Od(this,t,!0),n=this.Kc.map((t=>jd(t,e))),r=new Ri(n);return new Vi(t.path,r)}isEqual(t){return this===t}}class Pd extends Id{constructor(t,e){super(t),this.Kc=e}_toFieldTransform(t){const e=Od(this,t,!0),n=this.Kc.map((t=>jd(t,e))),r=new Li(n);return new Vi(t.path,r)}isEqual(t){return this===t}}class Vd extends Id{constructor(t,e){super(t),this.jc=e}_toFieldTransform(t){const e=new Mi(t.R,Si(t.R,this.jc));return new Vi(t.path,e)}isEqual(t){return this===t}}function Ud(t,e,n,r){const s=t.qc(1,e,n);Gd("Data must be an object, but it was:",s,r);const i=[],o=Ps.empty();ss(r,((t,r)=>{const a=Qd(e,t,n);r=g(r);const c=s.Fc(a);if(r instanceof Ld)i.push(a);else{const t=jd(r,c);null!=t&&(i.push(a),o.set(a,t))}}));const a=new hs(i);return new Dd(o,a,s.fieldTransforms)}function qd(t,e,n,r,s,i){const o=t.qc(1,e,n),a=[zd(e,r,n)],c=[s];if(i.length%2!=0)throw new qr(Ur.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(zd(e,i[t])),c.push(i[t+1]);const u=[],h=Ps.empty();for(let t=a.length-1;t>=0;--t)if(!Yd(u,a[t])){const e=a[t];let n=c[t];n=g(n);const r=o.Fc(e);if(n instanceof Ld)u.push(e);else{const t=jd(n,r);null!=t&&(u.push(e),h.set(e,t))}}const l=new hs(u);return new Dd(h,l,o.fieldTransforms)}function Bd(t,e,n,r=!1){return jd(n,t.qc(r?4:3,e))}function jd(t,e){if(Kd(t=g(t)))return Gd("Unsupported field value:",e,t),$d(t,e);if(t instanceof Id)return function(t,e){if(!Nd(e.Nc))throw e.Lc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Lc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.$c&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=jd(s,e.Mc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=g(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Si(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=es.fromDate(t);return{timestampValue:Oo(e.R,n)}}if(t instanceof es){const n=new es(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Oo(e.R,n)}}if(t instanceof _d)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Td)return{bytesValue:Mo(e.R,t._byteString)};if(t instanceof nd){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Vo(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc(`Unsupported field value: ${Yl(t)}`)}(t,e)}function $d(t,e){const n={};return is(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ss(t,((t,r)=>{const s=jd(r,e.kc(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function Kd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof es||t instanceof _d||t instanceof Td||t instanceof nd||t instanceof Id)}function Gd(t,e,n){if(!Kd(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Yl(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function zd(t,e,n){if((e=g(e))instanceof Ed)return e._internalPath;if("string"==typeof e)return Qd(t,e);throw Wd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Hd=new RegExp("[~\\*/\\[\\]]");function Qd(t,e,n){if(e.search(Hd)>=0)throw Wd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ed(...e.split("."))._internalPath}catch(r){throw Wd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Wd(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new qr(Ur.INVALID_ARGUMENT,a+t+c)}function Yd(t,e){return t.some((t=>t.isEqual(e)))}class Xd{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new nd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Jd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Zd("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Jd extends Xd{data(){return super.data()}}function Zd(t,e){return"string"==typeof e?Qd(t,e):e instanceof Ed?e._internalPath:e._delegate._internalPath}class tf{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ef extends Xd{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Zd("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class nf extends ef{data(t={}){return super.data(t)}}class rf{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new tf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new nf(this._firestore,this._userDataWriter,n.key,n,new tf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new qr(Ur.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new nf(t._firestore,t._userDataWriter,n.doc.key,n.doc,new tf(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new nf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new tf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:sf(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function sf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Hr()}}function of(t,e){return t instanceof ef&&e instanceof ef?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof rf&&e instanceof rf&&t._firestore===e._firestore&&cd(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function af(t){if(hi(t)&&0===t.explicitOrderBy.length)throw new qr(Ur.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cf{}function uf(t,...e){for(const n of e)t=n._apply(t);return t}class hf extends cf{constructor(t,e,n){super(),this.Qc=t,this.Wc=e,this.Gc=n,this.type="where"}_apply(t){const e=Rd(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new qr(Ur.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){yf(o,i);const e=[];for(const n of o)e.push(pf(r,t,n));a={arrayValue:{values:e}}}else a=pf(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||yf(o,i),a=Bd(n,"where",o,"in"===i||"not-in"===i);const c=Gs.create(s,i,a);return function(t,e){if(e.g()){const n=di(t);if(null!==n&&!n.isEqual(e.field))throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=li(t);null!==r&&wf(t,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new qr(Ur.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new qr(Ur.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Wc,this.Gc);return new rd(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new oi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}class lf extends cf{constructor(t,e){super(),this.Qc=t,this.zc=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ni(e,n);return function(t,e){if(null===li(t)){const n=di(t);null!==n&&wf(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.zc);return new rd(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new oi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}class df extends cf{constructor(t,e,n){super(),this.type=t,this.Hc=e,this.Jc=n}_apply(t){return new rd(t.firestore,t.converter,pi(t._query,this.Hc,this.Jc))}}class ff extends cf{constructor(t,e,n){super(),this.type=t,this.Yc=e,this.Xc=n}_apply(t){const e=mf(t,this.type,this.Yc,this.Xc);return new rd(t.firestore,t.converter,function(t,e){return new oi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}class gf extends cf{constructor(t,e,n){super(),this.type=t,this.Yc=e,this.Xc=n}_apply(t){const e=mf(t,this.type,this.Yc,this.Xc);return new rd(t.firestore,t.converter,function(t,e){return new oi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function mf(t,e,n,r){if(n[0]=g(n[0]),n[0]instanceof Xd)return function(t,e,n,r,s){if(!r)throw new qr(Ur.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of gi(t))if(n.field.isKeyField())i.push(Cs(e,r.key));else{const t=r.data.field(n.field);if(ps(t))throw new qr(Ur.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new ti(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=Rd(t.firestore);return function(t,e,n,r,s,i){const o=t.explicitOrderBy;if(s.length>o.length)throw new qr(Ur.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!fi(t)&&-1!==c.indexOf("/"))throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(as.fromString(c));if(!Ts.isDocumentKey(n))throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new Ts(n);a.push(Cs(e,s))}else{const t=Bd(n,r,c);a.push(t)}}return new ti(a,i)}(t._query,t.firestore._databaseId,s,e,n,r)}}function pf(t,e,n){if("string"==typeof(n=g(n))){if(""===n)throw new qr(Ur.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!fi(e)&&-1!==n.indexOf("/"))throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(as.fromString(n));if(!Ts.isDocumentKey(r))throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Cs(t,new Ts(r))}if(n instanceof nd)return Cs(t,n._key);throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yl(n)}.`)}function yf(t,e){if(!Array.isArray(t)||0===t.length)throw new qr(Ur.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new qr(Ur.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function wf(t,e,n){if(!n.isEqual(e))throw new qr(Ur.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class vf{convertValue(t,e="none"){switch(Is(t)){case 0:return null;case 1:return t.booleanValue;case 2:return gs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ms(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Hr()}}convertObject(t,e){const n={};return ss(t.fields,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new _d(gs(t.latitude),gs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ys(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ws(t));default:return null}}convertTimestamp(t){const e=fs(t);return new es(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=as.fromString(t);Qr(ua(n));const r=new Ul(n.get(1),n.get(3)),s=new Ts(n.popFirst(5));return r.isEqual(e)||Kr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function bf(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Ef extends vf{constructor(t){super(),this.firestore=t}convertBytes(t){return new Td(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new nd(this.firestore,null,e)}}class Tf{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Rd(t)}set(t,e,n){this._verifyNotCommitted();const r=If(t,this._firestore),s=bf(r.converter,e,n),i=kd(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,qi.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const s=If(t,this._firestore);let i;return i="string"==typeof(e=g(e))||e instanceof Ed?qd(this._dataReader,"WriteBatch.update",s._key,e,n,r):Ud(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(i.toMutation(s._key,qi.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=If(t,this._firestore);return this._mutations=this._mutations.concat(new Zi(e._key,qi.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new qr(Ur.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function If(t,e){if((t=g(t)).firestore!==e)throw new qr(Ur.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class _f extends vf{constructor(t){super(),this.firestore=t}convertBytes(t){return new Td(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new nd(this.firestore,null,e)}}function Sf(t){t=Xl(t,nd);const e=Xl(t.firestore,dd),n=fd(e),r=new _f(e);return function(t,e){const n=new La;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await function(t,e){const n=Wr(t);return n.persistence.runTransaction("read document","readonly",(t=>n.Mn.mn(t,e)))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new qr(Ur.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=bh(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await Rl(t),e,n))),n.promise}(n,t._key).then((n=>new ef(e,r,t._key,n,new tf(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Af(t){t=Xl(t,rd);const e=Xl(t.firestore,dd),n=fd(e),r=new _f(e);return function(t,e){const n=new La;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await ou(t,e,!0),s=new Vh(e,r.Bn),i=s._o(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const r=bh(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await Rl(t),e,n))),n.promise}(n,t._query).then((n=>new rf(e,r,t,n)))}function Df(t,e,n,...r){t=Xl(t,nd);const s=Xl(t.firestore,dd),i=Rd(s);let o;return o="string"==typeof(e=g(e))||e instanceof Ed?qd(i,"updateDoc",t._key,e,n,r):Ud(i,"updateDoc",t._key,e),Cf(s,[o.toMutation(t._key,qi.exists(!0))])}function Nf(t,...e){var n,r,s;t=g(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||hd(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(hd(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let c,u,h;if(t instanceof nd)u=Xl(t.firestore,dd),h=ci(t._key.path),c={next:n=>{e[o]&&e[o](Rf(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Xl(t,rd);u=Xl(n.firestore,dd),h=n._query;const r=new _f(u);c={next:t=>{e[o]&&e[o](new rf(u,r,n,t))},error:e[o+1],complete:e[o+2]},af(t._query)}return function(t,e,n,r){const s=new El(r),i=new Rh(e,s,n);return t.asyncQueue.enqueueAndForget((async()=>Ah(await Ol(t),i))),()=>{s.Wo(),t.asyncQueue.enqueueAndForget((async()=>Dh(await Ol(t),i)))}}(fd(u),h,a,c)}function xf(t,e){return function(t,e){const n=new El(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){Wr(t).Gr.add(e),e.next()}(await Ol(t),n))),()=>{n.Wo(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){Wr(t).Gr.delete(e)}(await Ol(t),n)))}}(fd(t=Xl(t,dd)),hd(e)?e:{next:e})}function Cf(t,e){return function(t,e){const n=new La;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=ml(t);try{const t=await function(t,e){const n=Wr(t),r=es.now(),s=e.reduce(((t,e)=>t.add(e.key)),vo());let i;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Mn.pn(t,s).next((s=>{i=s;const o=[];for(const t of e){const e=Gi(t,i.get(t.key));null!=e&&o.push(new Wi(t.key,e,Vs(e.value.mapValue),qi.exists(!0)))}return n._n.addMutationBatch(t,r,o,e)})))).then((t=>(t.applyToLocalDocumentSet(i),{batchId:t.batchId,changes:i})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.xo[t.currentUser.toKey()];r||(r=new oo(Jr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,t.batchId,n),await rl(r,t.changes),await ah(r.remoteStore)}catch(t){const e=bh(t,"Failed to persist write");n.reject(e)}}(await Ll(t),e,n))),n.promise}(fd(t),e)}function Rf(t,e,n){const r=n.docs.get(e._key),s=new _f(t);return new ef(t,s,e._key,r,new tf(n.hasPendingWrites,n.fromCache),e.converter)}class kf extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Rd(t)}get(t){const e=If(t,this._firestore),n=new Ef(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return Hr();const r=t[0];if(r.isFoundDocument())return new Xd(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new Xd(this._firestore,n,e._key,null,e.converter);throw Hr()}))}set(t,e,n){const r=If(t,this._firestore),s=bf(r.converter,e,n),i=kd(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(t,e,n,...r){const s=If(t,this._firestore);let i;return i="string"==typeof(e=g(e))||e instanceof Ed?qd(this._dataReader,"Transaction.update",s._key,e,n,r):Ud(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,i),this}delete(t){const e=If(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=If(t,this._firestore),n=new _f(this._firestore);return super.get(t).then((t=>new ef(this._firestore,n,e._key,t._document,new tf(!1,!1),e.converter)))}}function Lf(t,e){return function(t,e){const n=new La;return t.asyncQueue.enqueueAndForget((async()=>{const r=await function(t){return xl(t).then((t=>t.datastore))}(t);new _l(t.asyncQueue,r,e,n).run()})),n.promise}(fd(t),(n=>e(new kf(t,n))))}!function(t){Pr=t}(e.SDK_VERSION),e._registerComponent(new y("firestore-exp",((t,{options:e})=>{const n=t.getProvider("app-exp").getImmediate(),r=new dd(n,t.getProvider("auth-internal"));return e=Object.assign({useFetchStreams:!1},e),r._setSettings(e),r}),"PUBLIC")),e.registerVersion("@firebase/firestore","0.0.900-exp.6ef484a04",undefined);const Of="(default)";class Mf{constructor(t,e){this.projectId=t,this.database=e||Of}get isDefaultDatabase(){return this.database===Of}isEqual(t){return t instanceof Mf&&t.projectId===this.projectId&&t.database===this.database}}let Ff="8.7.1";const Pf=new T("@firebase/firestore");function Vf(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Uf(t="Unexpected state"){const e=`FIRESTORE (${Ff}) INTERNAL ASSERTION FAILED: `+t;throw function(t,...e){if(Pf.logLevel<=p.ERROR){const n=e.map(Vf);Pf.error(`Firestore (${Ff}): ${t}`,...n)}}(e),new Error(e)}const qf="invalid-argument",Bf="failed-precondition",jf="unimplemented";class $f extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}const Kf="__name__";class Gf{constructor(t,e,n){void 0===e?e=0:e>t.length&&Uf(),void 0===n?n=t.length-e:n>t.length-e&&Uf(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Gf.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Gf?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class zf extends Gf{construct(t,e,n){return new zf(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new $f(qf,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new zf(e)}static emptyPath(){return new zf([])}}const Hf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Qf extends Gf{construct(t,e,n){return new Qf(t,e,n)}static isValidIdentifier(t){return Hf.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Qf.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Kf}static keyField(){return new Qf([Kf])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new $f(qf,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new $f(qf,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new $f(qf,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new $f(qf,"Unterminated ` in path: "+t);return new Qf(e)}static emptyPath(){return new Qf([])}}class Wf{constructor(t){this.path=t}static fromPath(t){return new Wf(zf.fromString(t))}static fromName(t){return new Wf(zf.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===zf.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return zf.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Wf(new zf(t.slice()))}}function Yf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new $f(qf,`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function Xf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new $f(qf,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Uf()}(t);throw new $f(qf,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Jf(){if("undefined"==typeof Uint8Array)throw new $f(jf,"Uint8Arrays are not available in this environment.")}function Zf(){if("undefined"==typeof atob)throw new $f(jf,"Blobs are unavailable in Firestore in this environment.")}class tg{constructor(t){this._delegate=t}static fromBase64String(t){return Zf(),new tg(Td.fromBase64String(t))}static fromUint8Array(t){return Jf(),new tg(Td.fromUint8Array(t))}toBase64(){return Zf(),this._delegate.toBase64()}toUint8Array(){return Jf(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function eg(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}(t,["next","error","complete"])}class ng{enableIndexedDbPersistence(t,e){return function(t,e){bd(t=Xl(t,dd));const n=fd(t),r=t._freezeSettings(),s=new vl;return md(n,s,new yl(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return function(t){bd(t=Xl(t,dd));const e=fd(t),n=t._freezeSettings(),r=new vl;return md(e,r,new wl(r,n.cacheSizeBytes))}(t._delegate)}clearIndexedDbPersistence(t){return function(t){if(t._initialized&&!t._terminated)throw new qr(Ur.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new La;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Fa.gt())return Promise.resolve();const e=t+"main";await Fa.delete(e)}(Hc(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}(t._delegate)}}class rg{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof Mf||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||function(t,...e){if(Pf.logLevel<=p.WARN){const n=e.map(Vf);Pf.warn(`Firestore (${Ff}): ${t}`,...n)}}("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){ed(this._delegate,t,e,n)}enableNetwork(){return yd(this._delegate)}disableNetwork(){return wd(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,function(t,e,n,r){if(!0===e&&!0===r)throw new $f(qf,`${t} and ${n} cannot be used together.`)}("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore"),this._appCompat._removeServiceInstance("firestore-exp")),this._delegate._delete()}waitForPendingWrites(){return pd(this._delegate)}onSnapshotsInSync(t){return xf(this._delegate,t)}get app(){if(!this._appCompat)throw new $f(Bf,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new yg(this,id(this._delegate,t))}catch(t){throw ug(t,"collection()","Firestore.collection()")}}doc(t){try{return new cg(this,od(this._delegate,t))}catch(t){throw ug(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new gg(this,function(t,e){if(t=Xl(t,td),Hl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new qr(Ur.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new rd(t,null,function(t){return new oi(as.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw ug(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Lf(this._delegate,(e=>t(new ig(this,e))))}batch(){return fd(this._delegate),new og(new Tf(this._delegate,(t=>Cf(this._delegate,t))))}loadBundle(t){throw new $f(Bf,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')}namedQuery(t){throw new $f(Bf,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')}}class sg extends vf{constructor(t){super(),this.firestore=t}convertBytes(t){return new tg(new Td(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return cg.forKey(e,this.firestore,null)}}class ig{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new sg(t)}get(t){const e=wg(t);return this._delegate.get(e).then((t=>new dg(this._firestore,new ef(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,e,n){const r=wg(t);return n?(Yf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this}update(t,e,n,...r){const s=wg(t);return 2===arguments.length?this._delegate.update(s,e):this._delegate.update(s,e,n,...r),this}delete(t){const e=wg(t);return this._delegate.delete(e),this}}class og{constructor(t){this._delegate=t}set(t,e,n){const r=wg(t);return n?(Yf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this}update(t,e,n,...r){const s=wg(t);return 2===arguments.length?this._delegate.update(s,e):this._delegate.update(s,e,n,...r),this}delete(t){const e=wg(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class ag{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new nf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new fg(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=ag.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let s=r.get(e);return s||(s=new ag(t,new sg(t),e),r.set(e,s)),s}}ag.INSTANCES=new WeakMap;class cg{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sg(t)}static forPath(t,e,n){if(t.length%2!=0)throw new $f(qf,`Invalid document reference. Document references must have an even number of segments, but ${t.canonicalString()} has ${t.length}`);return new cg(e,new nd(e._delegate,n,new Wf(t)))}static forKey(t,e,n){return new cg(e,new nd(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new yg(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new yg(this.firestore,id(this._delegate,t))}catch(t){throw ug(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=g(t))instanceof nd&&ad(this._delegate,t)}set(t,e){e=Yf("DocumentReference.set",e);try{return function(t,e,n){t=Xl(t,nd);const r=Xl(t.firestore,dd),s=bf(t.converter,e,n);return Cf(r,[kd(Rd(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,qi.none())])}(this._delegate,t,e)}catch(t){throw ug(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Df(this._delegate,t):Df(this._delegate,t,e,...n)}catch(t){throw ug(t,"updateDoc()","DocumentReference.update()")}}delete(){return function(t){return Cf(Xl(t.firestore,dd),[new Zi(t._key,qi.none())])}(this._delegate)}onSnapshot(...t){const e=hg(t),n=lg(t,(t=>new dg(this.firestore,new ef(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Nf(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Sf(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Xl(t,nd);const e=Xl(t.firestore,dd);return Ml(fd(e),t._key,{source:"server"}).then((n=>Rf(e,t,n)))}(this._delegate):function(t){t=Xl(t,nd);const e=Xl(t.firestore,dd);return Ml(fd(e),t._key).then((n=>Rf(e,t,n)))}(this._delegate),e.then((t=>new dg(this.firestore,new ef(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new cg(this.firestore,t?this._delegate.withConverter(ag.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function ug(t,e,n){return t.message=t.message.replace(e,n),t}function hg(t){for(const e of t)if("object"==typeof e&&!eg(e))return e;return{}}function lg(t,e){var n,r;let s;return s=eg(t[0])?t[0]:eg(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{s.next&&s.next(e(t))},error:null===(n=s.error)||void 0===n?void 0:n.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class dg{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new cg(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return of(this._delegate,t._delegate)}}class fg extends dg{data(t){return this._delegate.data(t)}}class gg{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sg(t)}where(t,e,n){try{return new gg(this.firestore,uf(this._delegate,function(t,e,n){const r=e,s=Zd("where",t);return new hf(s,r,n)}(t,e,n)))}catch(t){throw ug(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new gg(this.firestore,uf(this._delegate,function(t,e="asc"){const n=e,r=Zd("orderBy",t);return new lf(r,n)}(t,e)))}catch(t){throw ug(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new gg(this.firestore,uf(this._delegate,function(t){return Jl("limit",t),new df("limit",t,"F")}(t)))}catch(t){throw ug(t,"limit()","Query.limit()")}}limitToLast(t){try{return new gg(this.firestore,uf(this._delegate,function(t){return Jl("limitToLast",t),new df("limitToLast",t,"L")}(t)))}catch(t){throw ug(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new gg(this.firestore,uf(this._delegate,function(...t){return new ff("startAt",t,!0)}(...t)))}catch(t){throw ug(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new gg(this.firestore,uf(this._delegate,function(...t){return new ff("startAfter",t,!1)}(...t)))}catch(t){throw ug(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new gg(this.firestore,uf(this._delegate,function(...t){return new gf("endBefore",t,!0)}(...t)))}catch(t){throw ug(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new gg(this.firestore,uf(this._delegate,function(...t){return new gf("endAt",t,!1)}(...t)))}catch(t){throw ug(t,"endAt()","Query.endAt()")}}isEqual(t){return cd(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Af(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Xl(t,rd);const e=Xl(t.firestore,dd),n=fd(e),r=new _f(e);return Fl(n,t._query,{source:"server"}).then((n=>new rf(e,r,t,n)))}(this._delegate):function(t){t=Xl(t,rd);const e=Xl(t.firestore,dd),n=fd(e),r=new _f(e);return af(t._query),Fl(n,t._query).then((n=>new rf(e,r,t,n)))}(this._delegate),e.then((t=>new pg(this.firestore,new rf(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=hg(t),n=lg(t,(t=>new pg(this.firestore,new rf(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Nf(this._delegate,e,n)}withConverter(t){return new gg(this.firestore,t?this._delegate.withConverter(ag.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class mg{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new fg(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class pg{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new gg(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new fg(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new mg(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new fg(this._firestore,n))}))}isEqual(t){return of(this._delegate,t._delegate)}}class yg extends gg{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new cg(this.firestore,t):null}doc(t){try{return new cg(this.firestore,void 0===t?od(this._delegate):od(this._delegate,t))}catch(t){throw ug(t,"doc()","CollectionReference.doc()")}}add(t){return function(t,e){const n=Xl(t.firestore,dd),r=od(t),s=bf(t.converter,e);return Cf(n,[kd(Rd(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,qi.exists(!1))]).then((()=>r))}(this._delegate,t).then((t=>new cg(this.firestore,t)))}isEqual(t){return ad(this._delegate,t._delegate)}withConverter(t){return new yg(this.firestore,t?this._delegate.withConverter(ag.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function wg(t){return Xf(t,nd)}function vg(t){return function(t,e){const n=fd(t=Xl(t,dd)),r=new ld;return Pl(n,t._databaseId,e,r),r}(this._delegate,t)}function bg(t){return vd(this._delegate,t).then((t=>t?new gg(this,t):null))}class Eg{constructor(...t){this._delegate=new Ed(...t)}static documentId(){return new Eg(Qf.keyField().canonicalString())}isEqual(t){return(t=g(t))instanceof Ed&&this._delegate._internalPath.isEqual(t._internalPath)}}class Tg{constructor(t){this._delegate=t}static serverTimestamp(){const t=new Md("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Tg(t)}static delete(){const t=new Ld("deleteField");return t._methodName="FieldValue.delete",new Tg(t)}static arrayUnion(...t){const e=function(...t){return new Fd("arrayUnion",t)}(...t);return e._methodName="FieldValue.arrayUnion",new Tg(e)}static arrayRemove(...t){const e=function(...t){return new Pd("arrayRemove",t)}(...t);return e._methodName="FieldValue.arrayRemove",new Tg(e)}static increment(t){const e=function(t){return new Vd("increment",t)}(t);return e._methodName="FieldValue.increment",new Tg(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const Ig={Firestore:rg,GeoPoint:_d,Timestamp:es,Blob:tg,Transaction:ig,WriteBatch:og,DocumentReference:cg,DocumentSnapshot:dg,Query:gg,QueryDocumentSnapshot:fg,QuerySnapshot:pg,CollectionReference:yg,FieldPath:Eg,FieldValue:Tg,setLogLevel:function(t){var e;e=t,Pf.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};var _g;(function(t){Ff=t})((_g=r.default).SDK_VERSION),function(t,e){t.INTERNAL.registerComponent(new y("firestore-compat",(t=>{const n=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore-exp").getImmediate();return e(n,r)}),"PUBLIC").setServiceProps(Object.assign({},Ig)))}(_g,((t,e)=>new rg(t,e,new ng))),_g.registerVersion("@firebase/firestore-compat","0.0.900-exp.6ef484a04"),function(t){t.prototype.loadBundle=vg,t.prototype.namedQuery=bg}(rg)}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}}));
//# sourceMappingURL=firebase-firestore-compat.js.map
