import{_getProvider as t,getApp as e,_removeServiceInstance as n,_registerComponent as r,registerVersion as s,SDK_VERSION as i}from"https://www.gstatic.com/firebasejs/9.0.0-beta.7/firebase-app.js";var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function c(t,e){for(var n=0,r=e.length,s=t.length;n<r;n++,s++)t[s]=e[n];return t}var u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],s=0;s<t.length;s+=3){var i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,u=c?t[s+2]:0,h=i>>2,l=(3&i)<<4|a>>4,d=(15&a)<<2|u>>6,f=63&u;c||(f=64,o||(d=64)),r.push(n[h],n[l],n[d],n[f])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){var i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){var o=((7&s)<<18|(63&(i=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(o>>10)),e[r++]=String.fromCharCode(56320+(1023&o))}else{i=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],s=0;s<t.length;){var i=n[t.charAt(s++)],o=s<t.length?n[t.charAt(s)]:0,a=++s<t.length?n[t.charAt(s)]:64,c=++s<t.length?n[t.charAt(s)]:64;if(++s,null==i||null==o||null==a||null==c)throw Error();var u=i<<2|o>>4;if(r.push(u),64!==a){var h=o<<4&240|a>>2;if(r.push(h),64!==c){var l=a<<6&192|c;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){return!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var d=function(t){function e(n,r,s){var i=t.call(this,r)||this;return i.code=n,i.customData=s,i.name="FirebaseError",Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,f.prototype.create),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e}(Error),f=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},s=this.service+"/"+t,i=this.errors[t],o=i?g(i,r):"Error",a=this.serviceName+": "+o+" ("+s+").",c=new d(s,a,r);return c},t}();function g(t,e){return t.replace(m,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var m=/\{\$([^}]+)}/g;function p(t){return t&&t._delegate?t._delegate:t}var y,w,v=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}();!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(w||(w={}));var b={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},T=w.INFO,E=((y={})[w.DEBUG]="log",y[w.VERBOSE]="log",y[w.INFO]="info",y[w.WARN]="warn",y[w.ERROR]="error",y),I=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var s=(new Date).toISOString(),i=E[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,c(["["+s+"]  "+t.name+":"],n))}},S=function(){function t(t){this.name=t,this._logLevel=T,this._logHandler=I,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in w))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?b[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,w.DEBUG],t)),this._logHandler.apply(this,c([this,w.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,w.VERBOSE],t)),this._logHandler.apply(this,c([this,w.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,w.INFO],t)),this._logHandler.apply(this,c([this,w.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,w.WARN],t)),this._logHandler.apply(this,c([this,w.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,w.ERROR],t)),this._logHandler.apply(this,c([this,w.ERROR],t))},t}(),_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var D,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},C=C||{},x=N||self;function k(){}function R(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var O="closure_uid_"+(1e9*Math.random()>>>0),M=0;function F(t,e,n){return t.call.apply(t.bind,arguments)}function P(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function V(t,e,n){return(V=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?F:P).apply(null,arguments)}function U(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function q(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function B(){this.s=this.s,this.o=this.o}var j={};B.prototype.s=!1,B.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,O)&&t[O]||(t[O]=++M)}(this);delete j[t]}},B.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var $=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},K=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,s="string"==typeof t?t.split(""):t,i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var Q,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:t>e?1:0}t:{var J=x.navigator;if(J){var Z=J.userAgent;if(Z){Q=Z;break t}}Q=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e={};for(var n in t)e[n]=t[n];return e}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,s=1;s<arguments.length;s++){for(n in r=arguments[s])t[n]=r[n];for(var i=0;i<nt.length;i++)n=nt[i],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function st(t){return st[" "](t),t}st[" "]=k;var it,ot,at=Y(Q,"Opera"),ct=Y(Q,"Trident")||Y(Q,"MSIE"),ut=Y(Q,"Edge"),ht=ut||ct,lt=Y(Q,"Gecko")&&!(Y(Q.toLowerCase(),"webkit")&&!Y(Q,"Edge"))&&!(Y(Q,"Trident")||Y(Q,"MSIE"))&&!Y(Q,"Edge"),dt=Y(Q.toLowerCase(),"webkit")&&!Y(Q,"Edge");function ft(){var t=x.document;return t?t.documentMode:void 0}t:{var gt="",mt=(ot=Q,lt?/rv:([^\);]+)(\)|;)/.exec(ot):ut?/Edge\/([\d\.]+)/.exec(ot):ct?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ot):dt?/WebKit\/(\S+)/.exec(ot):at?/(?:Version)[ \/]?(\S+)/.exec(ot):void 0);if(mt&&(gt=mt?mt[1]:""),ct){var pt=ft();if(null!=pt&&pt>parseFloat(gt)){it=String(pt);break t}}it=gt}var yt,wt={};function vt(){return function(t){var e=wt;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}((function(){for(var t=0,e=W(String(it)).split("."),n=W("9").split("."),r=Math.max(e.length,n.length),s=0;0==t&&s<r;s++){var i=e[s]||"",o=n[s]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==i[0].length&&0==o[0].length)break;t=X(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||X(0==i[2].length,0==o[2].length)||X(i[2],o[2]),i=i[3],o=o[3]}while(0==t)}return 0<=t}))}if(x.document&&ct){var bt=ft();yt=bt||(parseInt(it,10)||void 0)}else yt=void 0;var Tt=yt,Et=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{x.addEventListener("test",k,e),x.removeEventListener("test",k,e)}catch(t){}return t}();function It(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function St(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(lt){t:{try{st(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&St.Z.h.call(this)}}It.prototype.h=function(){this.defaultPrevented=!0},q(St,It);var _t={2:"touch",3:"pen",4:"mouse"};St.prototype.h=function(){St.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var At="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Nt(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=s,this.key=++Dt,this.ca=this.fa=!1}function Ct(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function xt(t){this.src=t,this.g={},this.h=0}function kt(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=$(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(Ct(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Rt(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==r)return s}return-1}xt.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=Rt(t,e,r,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new Nt(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Ot={};function Mt(t,e,n,r,s){if(r&&r.once)return Pt(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Mt(t,e[i],n,r,s);return null}return n=Kt(n),t&&t[At]?t.N(e,n,L(r)?!!r.capture:!!r,s):Ft(t,e,n,!1,r,s)}function Ft(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=L(s)?!!s.capture:!!s,a=jt(t);if(a||(t[Lt]=a=new xt(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}var e=Bt;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Et||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(qt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Pt(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Pt(t,e[i],n,r,s);return null}return n=Kt(n),t&&t[At]?t.O(e,n,L(r)?!!r.capture:!!r,s):Ft(t,e,n,!0,r,s)}function Vt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Vt(t,e[i],n,r,s);else r=L(r)?!!r.capture:!!r,n=Kt(n),t&&t[At]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=Rt(i=t.g[e],n,r,s))&&(Ct(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--)))):t&&(t=jt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Rt(e,n,r,s)),(n=-1<t?e[t]:null)&&Ut(n))}function Ut(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[At])kt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(qt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(kt(n,t),0==n.h&&(n.src=null,e[Lt]=null)):Ct(t)}}}function qt(t){return t in Ot?Ot[t]:Ot[t]="on"+t}function Bt(t,e){if(t.ca)t=!0;else{e=new St(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Ut(t),t=n.call(r,e)}return t}function jt(t){return(t=t[Lt])instanceof xt?t:null}var $t="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kt(t){return"function"==typeof t?t:(t[$t]||(t[$t]=function(e){return t.handleEvent(e)}),t[$t])}function Gt(){B.call(this),this.i=new xt(this),this.P=this,this.I=null}function zt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new It(e,t);else if(e instanceof It)e.target=e.target||t;else{var s=e;rt(e=new It(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=Ht(o,r,!0,e)&&s}if(s=Ht(o=e.g=t,r,!0,e)&&s,s=Ht(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Ht(o=e.g=n[i],r,!1,e)&&s}function Ht(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&kt(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}q(Gt,B),Gt.prototype[At]=!0,Gt.prototype.removeEventListener=function(t,e,n,r){Vt(this,t,e,n,r)},Gt.prototype.M=function(){if(Gt.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Ct(n[r]);delete e.g[t],e.h--}}this.I=null},Gt.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Gt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Qt=x.JSON.stringify;function Wt(){var t=re,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Yt,Xt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Jt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Jt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},t}())((function(){return new Zt}),(function(t){return t.reset()})),Zt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function te(t){x.setTimeout((function(){throw t}),0)}function ee(t,e){Yt||function(){var t=x.Promise.resolve(void 0);Yt=function(){t.then(se)}}(),ne||(Yt(),ne=!0),re.add(t,e)}var ne=!1,re=new Xt;function se(){for(var t;t=Wt();){try{t.h.call(t.g)}catch(t){te(t)}var e=Jt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ne=!1}function ie(t,e){Gt.call(this),this.h=t||1,this.g=e||x,this.j=V(this.kb,this),this.l=Date.now()}function oe(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ae(t,e,n){if("function"==typeof t)n&&(t=V(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=V(t.handleEvent,t)}return 2147483647<Number(e)?-1:x.setTimeout(t,e||0)}function ce(t){t.g=ae((function(){t.g=null,t.i&&(t.i=!1,ce(t))}),t.j);var e=t.h;t.h=null,t.m.apply(null,e)}q(ie,Gt),(D=ie.prototype).da=!1,D.S=null,D.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),zt(this,"tick"),this.da&&(oe(this),this.start()))}},D.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},D.M=function(){ie.Z.M.call(this),oe(this),delete this.g};var ue=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:ce(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(B);function he(t){B.call(this),this.h=t,this.g={}}q(he,B);var le=[];function de(t,e,n,r){Array.isArray(n)||(n&&(le[0]=n.toString()),n=le);for(var s=0;s<n.length;s++){var i=Mt(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function fe(t){tt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Ut(t)}),t),t.g={}}function ge(){this.g=!0}function me(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}he.prototype.M=function(){he.Z.M.call(this),fe(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ge.prototype.Aa=function(){this.g=!1},ge.prototype.info=function(){};var pe={},ye=null;function we(){return ye=ye||new Gt}function ve(t){It.call(this,pe.Ma,t)}function be(t){var e=we();zt(e,new ve(e,t))}function Te(t,e){It.call(this,pe.STAT_EVENT,t),this.stat=e}function Ee(t){var e=we();zt(e,new Te(e,t))}function Ie(t,e){It.call(this,pe.Na,t),this.size=e}function Se(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return x.setTimeout((function(){t()}),e)}pe.Ma="serverreachability",q(ve,It),pe.STAT_EVENT="statevent",q(Te,It),pe.Na="timingevent",q(Ie,It);var _e={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ae={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function De(){}function Ne(t){return t.h||(t.h=t.i())}function Ce(){}De.prototype.h=null;var xe,ke={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Re(){It.call(this,"d")}function Le(){It.call(this,"c")}function Oe(){}function Me(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new he(this),this.P=Pe,t=ht?125:void 0,this.W=new ie(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Fe}function Fe(){this.i=null,this.g="",this.h=!1}q(Re,It),q(Le,It),q(Oe,De),Oe.prototype.g=function(){return new XMLHttpRequest},Oe.prototype.i=function(){return{}},xe=new Oe;var Pe=45e3,Ve={},Ue={};function qe(t,e,n){t.K=1,t.v=hn(rn(e)),t.s=n,t.U=!0,Be(t,null)}function Be(t,e){t.F=Date.now(),Ge(t),t.A=rn(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),In(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Fe,t.g=Sr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ue(V(t.Ia,t,t.g),t.O)),de(t.V,t.g,"readystatechange",t.gb),e=t.H?et(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),be(1),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function je(t){return!!t.g&&("GET"==t.u&&2!=t.K&&t.l.Ba)}function $e(t,e,n){for(var r,s=!0;!t.I&&t.C<n.length;){if((r=Ke(t,n))==Ue){4==e&&(t.o=4,Ee(14),s=!1),me(t.j,t.m,null,"[Incomplete Response]");break}if(r==Ve){t.o=4,Ee(15),me(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}me(t.j,t.m,r,null),Ye(t,r)}je(t)&&r!=Ue&&r!=Ve&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Ee(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),pr(e),e.L=!0,Ee(11))):(me(t.j,t.m,n,"[Invalid Chunked Response]"),We(t),Qe(t))}function Ke(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ue:(n=Number(e.substring(n,r)),isNaN(n)?Ve:(r+=1)+n>e.length?Ue:(e=e.substr(r,n),t.C=r+n,e))}function Ge(t){t.Y=Date.now()+t.P,ze(t,t.P)}function ze(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Se(V(t.eb,t),e)}function He(t){t.B&&(x.clearTimeout(t.B),t.B=null)}function Qe(t){0==t.l.G||t.I||vr(t.l,t)}function We(t){He(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,oe(t.W),fe(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Ye(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||xn(n.i,t)))if(n.I=t.N,!t.J&&xn(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(i){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;wr(n),ar(n)}mr(n),Ee(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=Se(V(n.ab,n),6e3));if(1>=Cn(n.i)&&n.ka){try{n.ka()}catch(i){}n.ka=void 0}}else Tr(n,11)}else if((t.J||n.g==t)&&wr(n),!H(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){var i=s[e];if(n.U=i[0],i=i[1],2==n.G)if("c"==i[0]){n.J=i[1],n.la=i[2];var o=i[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=i[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c=i[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var u=t.g;if(u){var h=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Y(h,"spdy")||Y(h,"quic")||Y(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(kn(l,l.h),l.h=null))}if(r.D){var d=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;d&&(r.sa=d,un(r.F,r.D,d))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var f=t;if((r=n).oa=Ir(r,r.H?r.la:null,r.W),f.J){Rn(r.i,f);var g=f,m=r.K;m&&g.setTimeout(m),g.B&&(He(g),Ge(g)),r.g=f}else gr(r);0<n.l.length&&hr(n)}else"stop"!=i[0]&&"close"!=i[0]||Tr(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Tr(n,7):or(n):"noop"!=i[0]&&n.j&&n.j.wa(i),n.A=0)}be(4)}catch(i){}}function Xe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(R(t)||"string"==typeof t)K(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(R(t)||"string"==typeof t){n=[];for(var r=t.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,t)n[r++]=s;s=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(R(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function Je(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Je)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ze(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];tn(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)tn(s,r=t.g[e])||(t.g[n++]=r,s[r]=1),e++;t.g.length=n}}function tn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(D=Me.prototype).setTimeout=function(t){this.P=t},D.gb=function(t){t=t.target;var e=this.L;e&&3==er(t)?e.l():this.Ia(t)},D.Ia=function(t){try{if(t==this.g)t:{var e=er(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||ht||this.g&&(this.h.h||this.g.ga()||nr(this.g)))){this.I||4!=e||7==n||be(8==n||0>=r?3:2),He(this);var s=this.g.ba();this.N=s;e:if(je(this)){var i=nr(this.g);t="";var o=i.length,a=4==er(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){We(this),Qe(this);var c="";break e}this.h.i=new x.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,t+=this.h.i.decode(i[n],{stream:a&&n==o-1});i.splice(0,o),this.h.g+=t,this.C=0,c=this.h.g}else c=this.g.ga();if(this.i=200==s,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.X,e,s),this.i){if(this.$&&!this.J){e:{if(this.g){var u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(u)){var l=u;break e}}l=null}if(!(s=l)){this.i=!1,this.o=3,Ee(12),We(this),Qe(this);break t}me(this.j,this.m,s,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ye(this,s)}this.U?($e(this,e,c),ht&&this.i&&3==e&&(de(this.V,this.W,"tick",this.fb),this.W.start())):(me(this.j,this.m,c,null),Ye(this,c)),4==e&&We(this),this.i&&!this.I&&(4==e?vr(this.l,this):(this.i=!1,Ge(this)))}else 400==s&&0<c.indexOf("Unknown SID")?(this.o=3,Ee(12)):(this.o=0,Ee(13)),We(this),Qe(this)}}}catch(e){}},D.fb=function(){if(this.g){var t=er(this.g),e=this.g.ga();this.C<e.length&&(He(this),$e(this,t,e),this.i&&4!=t&&Ge(this))}},D.cancel=function(){this.I=!0,We(this)},D.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(be(3),Ee(17)),We(this),this.o=2,Qe(this)):ze(this,this.Y-t)},(D=Je.prototype).R=function(){Ze(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},D.T=function(){return Ze(this),this.g.concat()},D.get=function(t,e){return tn(this.h,t)?this.h[t]:e},D.set=function(t,e){tn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},D.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};var en=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function nn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof nn){this.g=void 0!==e?e:t.g,sn(this,t.j),this.s=t.s,on(this,t.i),an(this,t.m),this.l=t.l,e=t.h;var n=new vn;n.i=e.i,e.g&&(n.g=new Je(e.g),n.h=e.h),cn(this,n),this.o=t.o}else t&&(n=String(t).match(en))?(this.g=!!e,sn(this,n[1]||"",!0),this.s=ln(n[2]||""),on(this,n[3]||"",!0),an(this,n[4]),this.l=ln(n[5]||"",!0),cn(this,n[6]||"",!0),this.o=ln(n[7]||"")):(this.g=!!e,this.h=new vn(null,this.g))}function rn(t){return new nn(t)}function sn(t,e,n){t.j=n?ln(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function on(t,e,n){t.i=n?ln(e,!0):e}function an(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function cn(t,e,n){e instanceof vn?(t.h=e,function(t,e){e&&!t.j&&(bn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Tn(this,e),In(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=dn(e,yn)),t.h=new vn(e,t.g))}function un(t,e,n){t.h.set(e,n)}function hn(t){return un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ln(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function dn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,fn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}nn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(dn(e,gn,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(dn(e,gn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(dn(n,"/"==n.charAt(0)?pn:mn,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",dn(n,wn)),t.join("")};var gn=/[#\/\?@]/g,mn=/[#\?:]/g,pn=/[#\?]/g,yn=/[#\?@]/g,wn=/#/g;function vn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function bn(t){t.g||(t.g=new Je,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Tn(t,e){bn(t),e=Sn(t,e),tn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,tn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Ze(t)))}function En(t,e){return bn(t),e=Sn(t,e),tn(t.g.h,e)}function In(t,e,n){Tn(t,e),0<n.length&&(t.i=null,t.g.set(Sn(t,e),z(n)),t.h+=n.length)}function Sn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(D=vn.prototype).add=function(t,e){bn(this),this.i=null,t=Sn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},D.forEach=function(t,e){bn(this),this.g.forEach((function(n,r){K(n,(function(n){t.call(e,n,r,this)}),this)}),this)},D.T=function(){bn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n},D.R=function(t){bn(this);var e=[];if("string"==typeof t)En(this,t)&&(e=G(e,this.g.get(Sn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},D.set=function(t,e){return bn(this),this.i=null,En(this,t=Sn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},D.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},D.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}}return this.i=t.join("&")};var _n=function(t,e){this.h=t,this.g=e};function An(t){this.l=t||Dn,x.PerformanceNavigationTiming?t=0<(t=x.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(x.g&&x.g.Ea&&x.g.Ea()&&x.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Dn=10;function Nn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Cn(t){return t.h?1:t.g?t.g.size:0}function xn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function kn(t,e){t.g?t.g.add(e):t.h=e}function Rn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ln(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var s=A(t.g.values()),i=s.next();!i.done;i=s.next()){var o=i.value;r=r.concat(o.D)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r}return z(t.i)}function On(){}function Mn(){this.g=new On}function Fn(t,e,n){var r=n||"";try{Xe(t,(function(t,n){var s=t;L(t)&&(s=Qt(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Pn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function Vn(t){this.l=t.$b||null,this.j=t.ib||!1}function Un(t,e){Gt.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=qn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}An.prototype.cancel=function(){var t,e;if(this.i=Ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=A(this.g.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},On.prototype.stringify=function(t){return x.JSON.stringify(t,void 0)},On.prototype.parse=function(t){return x.JSON.parse(t,void 0)},q(Vn,De),Vn.prototype.g=function(){return new Un(this.l,this.j)},Vn.prototype.i=function(t){return function(){return t}}({}),q(Un,Gt);var qn=0;function Bn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function jn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,$n(t)}function $n(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(D=Un.prototype).open=function(t,e){if(this.readyState!=qn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,$n(this)},D.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||x).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},D.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jn(this)),this.readyState=qn},D.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==x.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Bn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},D.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?jn(this):$n(this),3==this.readyState&&Bn(this)}},D.Ua=function(t){this.g&&(this.response=this.responseText=t,jn(this))},D.Ta=function(t){this.g&&(this.response=t,jn(this))},D.ha=function(){this.g&&jn(this)},D.setRequestHeader=function(t,e){this.v.append(t,e)},D.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},D.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Un.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Kn=x.JSON.parse;function Gn(t){Gt.call(this),this.headers=new Je,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=zn,this.K=this.L=!1}q(Gn,Gt);var zn="",Hn=/^https?$/i,Qn=["POST","PUT"];function Wn(t){return"content-type"==t.toLowerCase()}function Yn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Xn(t),Zn(t)}function Xn(t){t.D||(t.D=!0,zt(t,"complete"),zt(t,"error"))}function Jn(t){if(t.h&&void 0!==C&&(!t.C[1]||4!=er(t)||2!=t.ba()))if(t.v&&4==er(t))ae(t.Fa,0,t);else if(zt(t,"readystatechange"),4==er(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var s;if(s=0===n){var i=String(t.H).match(en)[1]||null;if(!i&&x.self&&x.self.location){var o=x.self.location.protocol;i=o.substr(0,o.length-1)}s=!Hn.test(i?i.toLowerCase():"")}e=s}if(e)zt(t,"complete"),zt(t,"success");else{t.m=6;try{var a=2<er(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Xn(t)}}finally{Zn(t)}}}function Zn(t,e){if(t.g){tr(t);var n=t.g,r=t.C[0]?k:null;t.g=null,t.C=null,e||zt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function tr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(x.clearTimeout(t.A),t.A=null)}function er(t){return t.g?t.g.readyState:0}function nr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case zn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return tt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):un(t,e,n))}function sr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function ir(t){this.za=0,this.l=[],this.h=new ge,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=sr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=sr("baseRetryDelayMs",5e3,t),this.$a=sr("retryDelaySeedMs",1e4,t),this.Ya=sr("forwardChannelMaxRetries",2,t),this.ra=sr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new An(t&&t.concurrentRequestLimit),this.Ca=new Mn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function or(t){if(cr(t),3==t.G){var e=t.V++,n=rn(t.F);un(n,"SID",t.J),un(n,"RID",e),un(n,"TYPE","terminate"),dr(t,n),(e=new Me(t,t.h,e,void 0)).K=2,e.v=hn(rn(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(e.v.toString(),"")),!n&&x.Image&&((new Image).src=e.v,n=!0),n||(e.g=Sr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Ge(e)}Er(t)}function ar(t){t.g&&(pr(t),t.g.cancel(),t.g=null)}function cr(t){ar(t),t.u&&(x.clearTimeout(t.u),t.u=null),wr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&x.clearTimeout(t.m),t.m=null)}function ur(t,e){t.l.push(new _n(t.Za++,e)),3==t.G&&hr(t)}function hr(t){Nn(t.i)||t.m||(t.m=!0,ee(t.Ha,t),t.C=0)}function lr(t,e){var n;n=e?e.m:t.V++;var r=rn(t.F);un(r,"SID",t.J),un(r,"RID",n),un(r,"AID",t.U),dr(t,r),t.o&&t.s&&rr(r,t.o,t.s),n=new Me(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=fr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),kn(t.i,n),qe(n,r,e)}function dr(t,e){t.j&&Xe({},(function(t,n){un(e,n,t)}))}function fr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?V(t.j.Oa,t.j,t):null;t:for(var s=t.l,i=-1;;){var o=["count="+n];-1==i?0<n?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);for(var a=!0,c=0;c<n;c++){var u=s[c].h,h=s[c].g;if(0>(u-=i))i=Math.max(0,s[c].h-100),a=!1;else try{Fn(h,o,"req"+u+"_")}catch(t){r&&r(h)}}if(a){r=o.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function gr(t){t.g||t.u||(t.Y=1,ee(t.Ga,t),t.A=0)}function mr(t){return!(t.g||t.u||3<=t.A)&&(t.Y++,t.u=Se(V(t.Ga,t),br(t,t.A)),t.A++,!0)}function pr(t){null!=t.B&&(x.clearTimeout(t.B),t.B=null)}function yr(t){t.g=new Me(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=rn(t.oa);un(e,"RID","rpc"),un(e,"SID",t.J),un(e,"CI",t.N?"0":"1"),un(e,"AID",t.U),dr(t,e),un(e,"TYPE","xmlhttp"),t.o&&t.s&&rr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=hn(rn(e)),n.s=null,n.U=!0,Be(n,t)}function wr(t){null!=t.v&&(x.clearTimeout(t.v),t.v=null)}function vr(t,e){var n=null;if(t.g==e){wr(t),pr(t),t.g=null;var r=2}else{if(!xn(t.i,e))return;n=e.D,Rn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;zt(r=we(),new Ie(r,n,e,s)),hr(t)}else gr(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==r&&function(t,e){return!(Cn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Se(V(t.Ha,t,e),br(t,t.C)),t.C++,0)))}(t,e)||2==r&&mr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Tr(t,5);break;case 4:Tr(t,10);break;case 3:Tr(t,6);break;default:Tr(t,2)}}function br(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Tr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=V(t.jb,t);n||(n=new nn("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||sn(n,"https"),hn(n)),function(t,e){var n=new ge;if(x.Image){var r=new Image;r.onload=U(Pn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=U(Pn,n,r,"TestLoadImage: error",!1,e),r.onabort=U(Pn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=U(Pn,n,r,"TestLoadImage: timeout",!1,e),x.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ee(2);t.G=0,t.j&&t.j.va(e),Er(t),cr(t)}function Er(t){t.G=0,t.I=-1,t.j&&(0==Ln(t.i).length&&0==t.l.length||(t.i.i.length=0,z(t.l),t.l.length=0),t.j.ua())}function Ir(t,e,n){var r=function(t){return t instanceof nn?rn(t):new nn(t,void 0)}(n);if(""!=r.i)e&&on(r,e+"."+r.i),an(r,r.m);else{var s=x.location;r=function(t,e,n,r){var s=new nn(null,void 0);return t&&sn(s,t),e&&on(s,e),n&&an(s,n),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,n)}return t.aa&&tt(t.aa,(function(t,e){un(r,e,t)})),e=t.D,n=t.sa,e&&n&&un(r,e,n),un(r,"VER",t.ma),dr(t,r),r}function Sr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Gn(new Vn({ib:!0})):new Gn(t.qa)).L=t.H,e}function _r(){}function Ar(){if(ct&&!(10<=Number(Tt)))throw Error("Environmental error: no available transport.")}function Dr(t,e){Gt.call(this),this.g=new ir(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new xr(this)}function Nr(t){Re.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Cr(){Le.call(this),this.status=1}function xr(t){this.g=t}(D=Gn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():xe.g(),this.C=this.u?Ne(this.u):Ne(xe),this.g.onreadystatechange=V(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Yn(this,t)}t=n||"";var s=new Je(this.headers);r&&Xe(r,(function(t,e){s.set(e,t)})),r=function(t){t:{for(var e=Wn,n=t.length,r="string"==typeof t?t.split(""):t,s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=x.FormData&&t instanceof x.FormData,!(0<=$(Qn,e))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{tr(this),0<this.B&&((this.K=function(t){return ct&&vt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=V(this.pa,this)):this.A=ae(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Yn(this,t)}},D.pa=function(){void 0!==C&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,zt(this,"timeout"),this.abort(8))},D.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,zt(this,"complete"),zt(this,"abort"),Zn(this))},D.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Zn(this,!0)),Gn.Z.M.call(this)},D.Fa=function(){this.s||(this.F||this.v||this.l?Jn(this):this.cb())},D.cb=function(){Jn(this)},D.ba=function(){try{return 2<er(this)?this.g.status:-1}catch(t){return-1}},D.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},D.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Kn(e)}},D.Da=function(){return this.m},D.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(D=ir.prototype).ma=8,D.G=1,D.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},D.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Me(this,this.h,t,void 0),n=this.s;if(this.P&&(n?rt(n=et(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,s=0;s<this.l.length;s++){var i=this.l[s];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(r+=i)){r=s;break t}if(4096===r||s===this.l.length-1){r=s+1;break t}}r=1e3}else r=1e3;r=fr(this,e,r),un(s=rn(this.F),"RID",t),un(s,"CVER",22),this.D&&un(s,"X-HTTP-Session-Id",this.D),dr(this,s),this.o&&n&&rr(s,this.o,n),kn(this.i,e),this.Ra&&un(s,"TYPE","init"),this.ja?(un(s,"$req",r),un(s,"SID","null"),e.$=!0,qe(e,s,null)):qe(e,s,r),this.G=2}}else 3==this.G&&(t?lr(this,t):0==this.l.length||Nn(this.i)||lr(this))},D.Ga=function(){if(this.u=null,yr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Se(V(this.bb,this),t)}},D.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Ee(10),ar(this),yr(this))},D.ab=function(){null!=this.v&&(this.v=null,ar(this),mr(this),Ee(19))},D.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Ee(2)):(this.h.info("Failed to ping google.com"),Ee(1))},(D=_r.prototype).xa=function(){},D.wa=function(){},D.va=function(){},D.ua=function(){},D.Oa=function(){},Ar.prototype.g=function(t,e){return new Dr(t,e)},q(Dr,Gt),Dr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),ee(V(t.hb,t,e))),Ee(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Ir(t,null,t.W),hr(t)},Dr.prototype.close=function(){or(this.g)},Dr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,ur(this.g,e)}else this.v?((e={}).__data__=Qt(t),ur(this.g,e)):ur(this.g,t)},Dr.prototype.M=function(){this.g.j=null,delete this.j,or(this.g),delete this.g,Dr.Z.M.call(this)},q(Nr,Re),q(Cr,Le),q(xr,_r),xr.prototype.xa=function(){zt(this.g,"a")},xr.prototype.wa=function(t){zt(this.g,new Nr(t))},xr.prototype.va=function(t){zt(this.g,new Cr(t))},xr.prototype.ua=function(){zt(this.g,"b")},Ar.prototype.createWebChannel=Ar.prototype.g,Dr.prototype.send=Dr.prototype.u,Dr.prototype.open=Dr.prototype.m,Dr.prototype.close=Dr.prototype.close,_e.NO_ERROR=0,_e.TIMEOUT=8,_e.HTTP_ERROR=6,Ae.COMPLETE="complete",Ce.EventType=ke,ke.OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",Gt.prototype.listen=Gt.prototype.N,Gn.prototype.listenOnce=Gn.prototype.O,Gn.prototype.getLastError=Gn.prototype.La,Gn.prototype.getLastErrorCode=Gn.prototype.Da,Gn.prototype.getStatus=Gn.prototype.ba,Gn.prototype.getResponseJson=Gn.prototype.Qa,Gn.prototype.getResponseText=Gn.prototype.ga,Gn.prototype.send=Gn.prototype.ea;var kr=_e,Rr=Ae,Lr=pe,Or=10,Mr=11,Fr=Vn,Pr=Ce,Vr=Gn;let Ur="8.7.1";class qr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.t(t),this.i=t=>e.writeSequenceNumber(t))}t(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.i&&this.i(t),t}}qr.o=-1;const Br={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class jr extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}const $r=new S("@firebase/firestore");function Kr(){return $r.logLevel}function Gr(t){$r.setLogLevel(t)}function zr(t,...e){if($r.logLevel<=w.DEBUG){const n=e.map(Wr);$r.debug(`Firestore (${Ur}): ${t}`,...n)}}function Hr(t,...e){if($r.logLevel<=w.ERROR){const n=e.map(Wr);$r.error(`Firestore (${Ur}): ${t}`,...n)}}function Qr(t,...e){if($r.logLevel<=w.WARN){const n=e.map(Wr);$r.warn(`Firestore (${Ur}): ${t}`,...n)}}function Wr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Yr(t="Unexpected state"){const e=`FIRESTORE (${Ur}) INTERNAL ASSERTION FAILED: `+t;throw Hr(e),new Error(e)}function Xr(t,e){t||Yr()}function Jr(t,e){return t}function Zr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ts{static u(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Zr(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function es(t,e){return t<e?-1:t>e?1:0}function ns(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function rs(t){return t+"\0"}class ss{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new jr(Br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new jr(Br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new jr(Br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new jr(Br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ss.fromMillis(Date.now())}static fromDate(t){return ss.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ss(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?es(this.nanoseconds,t.nanoseconds):es(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class is{constructor(t){this.timestamp=t}static fromTimestamp(t){return new is(t)}static min(){return new is(new ss(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function os(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function as(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function cs(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class us{constructor(t,e,n){void 0===e?e=0:e>t.length&&Yr(),void 0===n?n=t.length-e:n>t.length-e&&Yr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===us.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof us?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class hs extends us{construct(t,e,n){return new hs(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new jr(Br.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new hs(e)}static emptyPath(){return new hs([])}}const ls=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ds extends us{construct(t,e,n){return new ds(t,e,n)}static isValidIdentifier(t){return ls.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ds.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ds(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new jr(Br.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new jr(Br.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new jr(Br.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new jr(Br.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ds(e)}static emptyPath(){return new ds([])}}class fs{constructor(t){this.fields=t,t.sort(ds.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ns(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class gs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new gs(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new gs(e)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return es(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gs.EMPTY_BYTE_STRING=new gs("");const ms=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ps(t){if(Xr(!!t),"string"==typeof t){let e=0;const n=ms.exec(t);if(Xr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ys(t.seconds),nanos:ys(t.nanos)}}function ys(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ws(t){return"string"==typeof t?gs.fromBase64String(t):gs.fromUint8Array(t)}function vs(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function bs(t){const e=t.mapValue.fields.__previous_value__;return vs(e)?bs(e):e}function Ts(t){const e=ps(t.mapValue.fields.__local_write_time__.timestampValue);return new ss(e.seconds,e.nanos)}function Es(t){return null==t}function Is(t){return 0===t&&1/t==-1/0}function Ss(t){return"number"==typeof t&&Number.isInteger(t)&&!Is(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class _s{constructor(t){this.path=t}static fromPath(t){return new _s(hs.fromString(t))}static fromName(t){return new _s(hs.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===hs.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return hs.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new _s(new hs(t.slice()))}}function As(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vs(t)?4:10:Yr()}function Ds(t,e){const n=As(t);if(n!==As(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ts(t).isEqual(Ts(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ps(t.timestampValue),r=ps(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ws(t.bytesValue).isEqual(ws(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ys(t.geoPointValue.latitude)===ys(e.geoPointValue.latitude)&&ys(t.geoPointValue.longitude)===ys(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ys(t.integerValue)===ys(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=ys(t.doubleValue),r=ys(e.doubleValue);return n===r?Is(n)===Is(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ns(t.arrayValue.values||[],e.arrayValue.values||[],Ds);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(os(n)!==os(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ds(n[t],r[t])))return!1;return!0}(t,e);default:return Yr()}}function Ns(t,e){return void 0!==(t.values||[]).find((t=>Ds(t,e)))}function Cs(t,e){const n=As(t),r=As(e);if(n!==r)return es(n,r);switch(n){case 0:return 0;case 1:return es(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=ys(t.integerValue||t.doubleValue),r=ys(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return xs(t.timestampValue,e.timestampValue);case 4:return xs(Ts(t),Ts(e));case 5:return es(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ws(t),r=ws(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=es(n[t],r[t]);if(0!==e)return e}return es(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=es(ys(t.latitude),ys(e.latitude));return 0!==n?n:es(ys(t.longitude),ys(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Cs(n[t],r[t]);if(e)return e}return es(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=es(r[t],i[t]);if(0!==e)return e;const o=Cs(n[r[t]],s[i[t]]);if(0!==o)return o}return es(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Yr()}}function xs(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return es(t,e);const n=ps(t),r=ps(e),s=es(n.seconds,r.seconds);return 0!==s?s:es(n.nanos,r.nanos)}function ks(t){return Rs(t)}function Rs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=ps(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ws(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,_s.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Rs(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${Rs(t.fields[s])}`;return n+"}"}(t.mapValue):Yr();var e,n}function Ls(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Os(t){return!!t&&"integerValue"in t}function Ms(t){return!!t&&"arrayValue"in t}function Fs(t){return!!t&&"nullValue"in t}function Ps(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Vs(t){return!!t&&"mapValue"in t}function Us(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return as(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Us(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Us(t.arrayValue.values[n]);return e}return Object.assign({},t)}class qs{constructor(t){this.value=t}static empty(){return new qs({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Vs(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Us(e)}setAll(t){let e=ds.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=Us(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Vs(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ds(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Vs(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){as(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new qs(Us(this.value))}}function Bs(t){const e=[];return as(t.fields,((t,n)=>{const r=new ds([t]);if(Vs(n)){const t=Bs(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new fs(e)}class js{constructor(t,e,n,r,s){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=s}static newInvalidDocument(t){return new js(t,0,is.min(),qs.empty(),0)}static newFoundDocument(t,e,n){return new js(t,1,e,n,0)}static newNoDocument(t,e){return new js(t,2,e,qs.empty(),0)}static newUnknownDocument(t,e){return new js(t,3,e,qs.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=qs.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=qs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof js&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new js(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class $s{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.h=null}}function Ks(t,e=null,n=[],r=[],s=null,i=null,o=null){return new $s(t,e,n,r,s,i,o)}function Gs(t){const e=Jr(t);if(null===e.h){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+ks(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Es(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=si(e.startAt)),e.endAt&&(t+="|ub:",t+=si(e.endAt)),e.h=t}return e.h}function zs(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!oi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!Ds(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ci(t.startAt,e.startAt)&&ci(t.endAt,e.endAt)}function Hs(t){return _s.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Qs extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Ws(t,e,n):"array-contains"===e?new Zs(t,n):"in"===e?new ti(t,n):"not-in"===e?new ei(t,n):"array-contains-any"===e?new ni(t,n):new Qs(t,e,n)}static l(t,e,n){return"in"===e?new Ys(t,n):new Xs(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Cs(e,this.value)):null!==e&&As(this.value)===As(e)&&this.m(Cs(e,this.value))}m(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Yr()}}g(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ws extends Qs{constructor(t,e,n){super(t,e,n),this.key=_s.fromName(n.referenceValue)}matches(t){const e=_s.comparator(t.key,this.key);return this.m(e)}}class Ys extends Qs{constructor(t,e){super(t,"in",e),this.keys=Js("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Xs extends Qs{constructor(t,e){super(t,"not-in",e),this.keys=Js("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Js(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>_s.fromName(t.referenceValue)))}class Zs extends Qs{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ms(e)&&Ns(e.arrayValue,this.value)}}class ti extends Qs{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Ns(this.value.arrayValue,e)}}class ei extends Qs{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ns(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Ns(this.value.arrayValue,e)}}class ni extends Qs{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ms(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Ns(this.value.arrayValue,t)))}}class ri{constructor(t,e){this.position=t,this.before=e}}function si(t){return`${t.before?"b":"a"}:${t.position.map((t=>ks(t))).join(",")}`}class ii{constructor(t,e="asc"){this.field=t,this.dir=e}}function oi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ai(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?_s.comparator(_s.fromName(o.referenceValue),n.key):Cs(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ci(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ds(t.position[n],e.position[n]))return!1;return!0}class ui{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt}}function hi(t,e,n,r,s,i,o,a){return new ui(t,e,n,r,s,i,o,a)}function li(t){return new ui(t)}function di(t){return!Es(t.limit)&&"F"===t.limitType}function fi(t){return!Es(t.limit)&&"L"===t.limitType}function gi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function mi(t){for(const e of t.filters)if(e.g())return e.field;return null}function pi(t){return null!==t.collectionGroup}function yi(t){const e=Jr(t);if(null===e.p){e.p=[];const t=mi(e),n=gi(e);if(null!==t&&null===n)t.isKeyField()||e.p.push(new ii(t)),e.p.push(new ii(ds.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.p.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ii(ds.keyField(),t))}}}return e.p}function wi(t){const e=Jr(t);if(!e.T)if("F"===e.limitType)e.T=Ks(e.path,e.collectionGroup,yi(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of yi(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ii(n.field,e))}const n=e.endAt?new ri(e.endAt.position,!e.endAt.before):null,r=e.startAt?new ri(e.startAt.position,!e.startAt.before):null;e.T=Ks(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.T}function vi(t,e,n){return new ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function bi(t,e){return zs(wi(t),wi(e))&&t.limitType===e.limitType}function Ti(t){return`${Gs(wi(t))}|lt:${t.limitType}`}function Ei(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${ks(e.value)}`;var e})).join(", ")}]`),Es(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+si(t.startAt)),t.endAt&&(e+=", endAt: "+si(t.endAt)),`Target(${e})`}(wi(t))}; limitType=${t.limitType})`}function Ii(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):_s.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!ai(t.startAt,yi(t),e))&&(!t.endAt||!ai(t.endAt,yi(t),e))}(t,e)}function Si(t){return(e,n)=>{let r=!1;for(const s of yi(t)){const t=_i(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function _i(t,e,n){const r=t.field.isKeyField()?_s.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?Cs(r,s):Yr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Yr()}}function Ai(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Is(e)?"-0":e}}function Di(t){return{integerValue:""+t}}function Ni(t,e){return Ss(e)?Di(e):Ai(t,e)}class Ci{constructor(){this._=void 0}}function xi(t,e,n){return t instanceof Li?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Oi?Mi(t,e):t instanceof Fi?Pi(t,e):function(t,e){const n=Ri(t,e),r=Ui(n)+Ui(t.A);return Os(n)&&Os(t.A)?Di(r):Ai(t.R,r)}(t,e)}function ki(t,e,n){return t instanceof Oi?Mi(t,e):t instanceof Fi?Pi(t,e):n}function Ri(t,e){return t instanceof Vi?Os(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Li extends Ci{}class Oi extends Ci{constructor(t){super(),this.elements=t}}function Mi(t,e){const n=qi(e);for(const e of t.elements)n.some((t=>Ds(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Fi extends Ci{constructor(t){super(),this.elements=t}}function Pi(t,e){let n=qi(e);for(const e of t.elements)n=n.filter((t=>!Ds(t,e)));return{arrayValue:{values:n}}}class Vi extends Ci{constructor(t,e){super(),this.R=t,this.A=e}}function Ui(t){return ys(t.integerValue||t.doubleValue)}function qi(t){return Ms(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Bi{constructor(t,e){this.field=t,this.transform=e}}class ji{constructor(t,e){this.version=t,this.transformResults=e}}class $i{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new $i}static exists(t){return new $i(void 0,t)}static updateTime(t){return new $i(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ki(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Gi{}function zi(t,e,n){t instanceof Xi?function(t,e,n){const r=t.value.clone(),s=to(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ji?function(t,e,n){if(!Ki(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=to(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Zi(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Hi(t,e,n){t instanceof Xi?function(t,e,n){if(!Ki(t.precondition,e))return;const r=t.value.clone(),s=eo(t.fieldTransforms,n,e);r.setAll(s),e.convertToFoundDocument(Yi(e),r).setHasLocalMutations()}(t,e,n):t instanceof Ji?function(t,e,n){if(!Ki(t.precondition,e))return;const r=eo(t.fieldTransforms,n,e),s=e.data;s.setAll(Zi(t)),s.setAll(r),e.convertToFoundDocument(Yi(e),s).setHasLocalMutations()}(t,e,n):function(t,e){Ki(t.precondition,e)&&e.convertToNoDocument(is.min())}(t,e)}function Qi(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Ri(r.transform,t||null);null!=s&&(null==n&&(n=qs.empty()),n.set(r.field,s))}return n||null}function Wi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ns(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Oi&&e instanceof Oi||t instanceof Fi&&e instanceof Fi?ns(t.elements,e.elements,Ds):t instanceof Vi&&e instanceof Vi?Ds(t.A,e.A):t instanceof Li&&e instanceof Li}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Yi(t){return t.isFoundDocument()?t.version:is.min()}class Xi extends Gi{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Ji extends Gi{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function Zi(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function to(t,e,n){const r=new Map;Xr(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,ki(o,a,n[s]))}return r}function eo(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,xi(t,i,e))}return r}class no extends Gi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class ro extends Gi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class so{constructor(t){this.count=t}}var io,oo;function ao(t){switch(t){case Br.OK:return Yr();case Br.CANCELLED:case Br.UNKNOWN:case Br.DEADLINE_EXCEEDED:case Br.RESOURCE_EXHAUSTED:case Br.INTERNAL:case Br.UNAVAILABLE:case Br.UNAUTHENTICATED:return!1;case Br.INVALID_ARGUMENT:case Br.NOT_FOUND:case Br.ALREADY_EXISTS:case Br.PERMISSION_DENIED:case Br.FAILED_PRECONDITION:case Br.ABORTED:case Br.OUT_OF_RANGE:case Br.UNIMPLEMENTED:case Br.DATA_LOSS:return!0;default:return Yr()}}function co(t){if(void 0===t)return Hr("GRPC error has no .code"),Br.UNKNOWN;switch(t){case io.OK:return Br.OK;case io.CANCELLED:return Br.CANCELLED;case io.UNKNOWN:return Br.UNKNOWN;case io.DEADLINE_EXCEEDED:return Br.DEADLINE_EXCEEDED;case io.RESOURCE_EXHAUSTED:return Br.RESOURCE_EXHAUSTED;case io.INTERNAL:return Br.INTERNAL;case io.UNAVAILABLE:return Br.UNAVAILABLE;case io.UNAUTHENTICATED:return Br.UNAUTHENTICATED;case io.INVALID_ARGUMENT:return Br.INVALID_ARGUMENT;case io.NOT_FOUND:return Br.NOT_FOUND;case io.ALREADY_EXISTS:return Br.ALREADY_EXISTS;case io.PERMISSION_DENIED:return Br.PERMISSION_DENIED;case io.FAILED_PRECONDITION:return Br.FAILED_PRECONDITION;case io.ABORTED:return Br.ABORTED;case io.OUT_OF_RANGE:return Br.OUT_OF_RANGE;case io.UNIMPLEMENTED:return Br.UNIMPLEMENTED;case io.DATA_LOSS:return Br.DATA_LOSS;default:return Yr()}}(oo=io||(io={}))[oo.OK=0]="OK",oo[oo.CANCELLED=1]="CANCELLED",oo[oo.UNKNOWN=2]="UNKNOWN",oo[oo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oo[oo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oo[oo.NOT_FOUND=5]="NOT_FOUND",oo[oo.ALREADY_EXISTS=6]="ALREADY_EXISTS",oo[oo.PERMISSION_DENIED=7]="PERMISSION_DENIED",oo[oo.UNAUTHENTICATED=16]="UNAUTHENTICATED",oo[oo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oo[oo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oo[oo.ABORTED=10]="ABORTED",oo[oo.OUT_OF_RANGE=11]="OUT_OF_RANGE",oo[oo.UNIMPLEMENTED=12]="UNIMPLEMENTED",oo[oo.INTERNAL=13]="INTERNAL",oo[oo.UNAVAILABLE=14]="UNAVAILABLE",oo[oo.DATA_LOSS=15]="DATA_LOSS";class uo{constructor(t,e){this.comparator=t,this.root=e||lo.EMPTY}insert(t,e){return new uo(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,lo.BLACK,null,null))}remove(t){return new uo(this.comparator,this.root.remove(t,this.comparator).copy(null,null,lo.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ho(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ho(this.root,t,this.comparator,!1)}getReverseIterator(){return new ho(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ho(this.root,t,this.comparator,!0)}}class ho{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class lo{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:lo.RED,this.left=null!=r?r:lo.EMPTY,this.right=null!=s?s:lo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new lo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return lo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return lo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,lo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,lo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Yr();if(this.right.isRed())throw Yr();const t=this.left.check();if(t!==this.right.check())throw Yr();return t+(this.isRed()?0:1)}}lo.EMPTY=null,lo.RED=!0,lo.BLACK=!1,lo.EMPTY=new class{constructor(){this.size=0}get key(){throw Yr()}get value(){throw Yr()}get color(){throw Yr()}get left(){throw Yr()}get right(){throw Yr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new lo(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class fo{constructor(t){this.comparator=t,this.data=new uo(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new go(this.data.getIterator())}getIteratorFrom(t){return new go(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof fo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new fo(this.comparator);return e.data=t,e}}class go{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const mo=new uo(_s.comparator);function po(){return mo}const yo=new uo(_s.comparator);function wo(){return yo}const vo=new uo(_s.comparator);function bo(){return vo}const To=new fo(_s.comparator);function Eo(...t){let e=To;for(const n of t)e=e.add(n);return e}const Io=new fo(es);function So(){return Io}class _o{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Ao.createSynthesizedTargetChangeForCurrentChange(t,e)),new _o(is.min(),n,So(),po(),Eo())}}class Ao{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Ao(gs.EMPTY_BYTE_STRING,e,Eo(),Eo(),Eo())}}class Do{constructor(t,e,n,r){this.P=t,this.removedTargetIds=e,this.key=n,this.v=r}}class No{constructor(t,e){this.targetId=t,this.V=e}}class Co{constructor(t,e,n=gs.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class xo{constructor(){this.S=0,this.D=Lo(),this.C=gs.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}get current(){return this.N}get resumeToken(){return this.C}get $(){return 0!==this.S}get O(){return this.k}F(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)}M(){let t=Eo(),e=Eo(),n=Eo();return this.D.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Yr()}})),new Ao(this.C,this.N,t,e,n)}L(){this.k=!1,this.D=Lo()}B(t,e){this.k=!0,this.D=this.D.insert(t,e)}U(t){this.k=!0,this.D=this.D.remove(t)}q(){this.S+=1}K(){this.S-=1}j(){this.k=!0,this.N=!0}}class ko{constructor(t){this.W=t,this.G=new Map,this.H=po(),this.J=Ro(),this.Y=new fo(es)}X(t){for(const e of t.P)t.v&&t.v.isFoundDocument()?this.Z(e,t.v):this.tt(e,t.key,t.v);for(const e of t.removedTargetIds)this.tt(e,t.key,t.v)}et(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.st(e)&&n.F(t.resumeToken);break;case 1:n.K(),n.$||n.L(),n.F(t.resumeToken);break;case 2:n.K(),n.$||this.removeTarget(e);break;case 3:this.st(e)&&(n.j(),n.F(t.resumeToken));break;case 4:this.st(e)&&(this.it(e),n.F(t.resumeToken));break;default:Yr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(((t,n)=>{this.st(n)&&e(n)}))}rt(t){const e=t.targetId,n=t.V.count,r=this.ot(e);if(r){const t=r.target;if(Hs(t))if(0===n){const n=new _s(t.path);this.tt(e,n,js.newNoDocument(n,is.min()))}else Xr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}}ut(t){const e=new Map;this.G.forEach(((n,r)=>{const s=this.ot(r);if(s){if(n.current&&Hs(s.target)){const e=new _s(s.target.path);null!==this.H.get(e)||this.at(r,e)||this.tt(r,e,js.newNoDocument(e,t))}n.O&&(e.set(r,n.M()),n.L())}}));let n=Eo();this.J.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.ot(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))}));const r=new _o(t,e,this.Y,this.H,n);return this.H=po(),this.J=Ro(),this.Y=new fo(es),r}Z(t,e){if(!this.st(t))return;const n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}tt(t,e,n){if(!this.st(t))return;const r=this.nt(t);this.at(t,e)?r.B(e,1):r.U(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}removeTarget(t){this.G.delete(t)}ct(t){const e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}q(t){this.nt(t).q()}nt(t){let e=this.G.get(t);return e||(e=new xo,this.G.set(t,e)),e}ht(t){let e=this.J.get(t);return e||(e=new fo(es),this.J=this.J.insert(t,e)),e}st(t){const e=null!==this.ot(t);return e||zr("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.G.get(t);return e&&e.$?null:this.W.lt(t)}it(t){this.G.set(t,new xo),this.W.getRemoteKeysForTarget(t).forEach((e=>{this.tt(t,e,null)}))}at(t,e){return this.W.getRemoteKeysForTarget(t).has(e)}}function Ro(){return new uo(_s.comparator)}function Lo(){return new uo(_s.comparator)}const Oo={asc:"ASCENDING",desc:"DESCENDING"},Mo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Fo{constructor(t,e){this.databaseId=t,this.I=e}}function Po(t,e){return t.I?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Vo(t,e){return t.I?e.toBase64():e.toUint8Array()}function Uo(t,e){return Po(t,e.toTimestamp())}function qo(t){return Xr(!!t),is.fromTimestamp(function(t){const e=ps(t);return new ss(e.seconds,e.nanos)}(t))}function Bo(t,e){return function(t){return new hs(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function jo(t){const e=hs.fromString(t);return Xr(da(e)),e}function $o(t,e){return Bo(t.databaseId,e.path)}function Ko(t,e){const n=jo(e);if(n.get(1)!==t.databaseId.projectId)throw new jr(Br.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new jr(Br.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new _s(Qo(n))}function Go(t,e){return Bo(t.databaseId,e)}function zo(t){const e=jo(t);return 4===e.length?hs.emptyPath():Qo(e)}function Ho(t){return new hs(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Qo(t){return Xr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Wo(t,e,n){return{name:$o(t,e),fields:n.value.mapValue.fields}}function Yo(t,e,n){const r=Ko(t,e.name),s=qo(e.updateTime),i=new qs({mapValue:{fields:e.fields}}),o=js.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Xo(t,e){let n;if(e instanceof Xi)n={update:Wo(t,e.key,e.value)};else if(e instanceof no)n={delete:$o(t,e.key)};else if(e instanceof Ji)n={update:Wo(t,e.key,e.data),updateMask:la(e.fieldMask)};else{if(!(e instanceof ro))return Yr();n={verify:$o(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Li)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Oi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Fi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Vi)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Yr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Uo(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Yr()}(t,e.precondition)),n}function Jo(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?$i.updateTime(qo(t.updateTime)):void 0!==t.exists?$i.exists(t.exists):$i.none()}(e.currentDocument):$i.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)Xr("REQUEST_TIME"===e.setToServerValue),n=new Li;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Oi(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Fi(t)}else"increment"in e?n=new Vi(t,e.increment):Yr();const r=ds.fromServerFormat(e.fieldPath);return new Bi(r,n)}(t,e))):[];if(e.update){e.update.name;const s=Ko(t,e.update.name),i=new qs({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new fs(e.map((t=>ds.fromServerFormat(t))))}(e.updateMask);return new Ji(s,i,t,n,r)}return new Xi(s,i,n,r)}if(e.delete){const r=Ko(t,e.delete);return new no(r,n)}if(e.verify){const r=Ko(t,e.verify);return new ro(r,n)}return Yr()}function Zo(t,e){return{documents:[Go(t,e.path)]}}function ta(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Go(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Go(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Ps(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NAN"}};if(Fs(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ps(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NOT_NAN"}};if(Fs(t.value))return{unaryFilter:{field:aa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aa(t.field),op:oa(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:aa(t.field),direction:ia(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.I||Es(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=ra(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ra(e.endAt)),n}function ea(t){let e=zo(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Xr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=na(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ii(ca(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Es(e)?null:e}(n.limit));let c=null;n.startAt&&(c=sa(n.startAt));let u=null;return n.endAt&&(u=sa(n.endAt)),hi(e,s,o,i,a,"F",c,u)}function na(t){return t?void 0!==t.unaryFilter?[ha(t)]:void 0!==t.fieldFilter?[ua(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>na(t))).reduce(((t,e)=>t.concat(e))):Yr():[]}function ra(t){return{before:t.before,values:t.position}}function sa(t){const e=!!t.before,n=t.values||[];return new ri(n,e)}function ia(t){return Oo[t]}function oa(t){return Mo[t]}function aa(t){return{fieldPath:t.canonicalString()}}function ca(t){return ds.fromServerFormat(t.fieldPath)}function ua(t){return Qs.create(ca(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Yr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ha(t){switch(t.unaryFilter.op){case"IS_NAN":const e=ca(t.unaryFilter.field);return Qs.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=ca(t.unaryFilter.field);return Qs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ca(t.unaryFilter.field);return Qs.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=ca(t.unaryFilter.field);return Qs.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Yr()}}function la(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function da(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function fa(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=ma(e)),e=ga(t.get(n),e);return ma(e)}function ga(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function ma(t){return t+""}function pa(t){const e=t.length;if(Xr(e>=2),2===e)return Xr(""===t.charAt(0)&&""===t.charAt(1)),hs.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&Yr(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===s.length?o=n:(s+=n,o=s,s=""),r.push(o);break;case"":s+=t.substring(i,e),s+="\0";break;case"":s+=t.substring(i,e+1);break;default:Yr()}i=e+2}return new hs(r)}class ya{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class wa{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}wa.store="owner",wa.key="owner";class va{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}va.store="mutationQueues",va.keyPath="userId";class ba{constructor(t,e,n,r,s){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}ba.store="mutations",ba.keyPath="batchId",ba.userMutationsIndex="userMutationsIndex",ba.userMutationsKeyPath=["userId","batchId"];class Ta{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,fa(e)]}static key(t,e,n){return[t,fa(e),n]}}Ta.store="documentMutations",Ta.PLACEHOLDER=new Ta;class Ea{constructor(t,e){this.path=t,this.readTime=e}}class Ia{constructor(t,e){this.path=t,this.version=e}}class Sa{constructor(t,e,n,r,s,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}Sa.store="remoteDocuments",Sa.readTimeIndex="readTimeIndex",Sa.readTimeIndexPath="readTime",Sa.collectionReadTimeIndex="collectionReadTimeIndex",Sa.collectionReadTimeIndexPath=["parentPath","readTime"];class _a{constructor(t){this.byteSize=t}}_a.store="remoteDocumentGlobal",_a.key="remoteDocumentGlobalKey";class Aa{constructor(t,e,n,r,s,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Aa.store="targets",Aa.keyPath="targetId",Aa.queryTargetsIndexName="queryTargetsIndex",Aa.queryTargetsKeyPath=["canonicalId","targetId"];class Da{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}Da.store="targetDocuments",Da.keyPath=["targetId","path"],Da.documentTargetsIndex="documentTargetsIndex",Da.documentTargetsKeyPath=["path","targetId"];class Na{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Na.key="targetGlobalKey",Na.store="targetGlobal";class Ca{constructor(t,e){this.collectionId=t,this.parent=e}}Ca.store="collectionParents",Ca.keyPath=["collectionId","parent"];class xa{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}xa.store="clientMetadata",xa.keyPath="clientId";class ka{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}ka.store="bundles",ka.keyPath="bundleId";class Ra{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Ra.store="namedQueries",Ra.keyPath="name";const La=[va.store,ba.store,Ta.store,Sa.store,Aa.store,wa.store,Na.store,Da.store,xa.store,_a.store,Ca.store,ka.store,Ra.store],Oa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ma{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class Fa{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Pa{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Yr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Pa(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Pa?e:Pa.resolve(e)}catch(t){return Pa.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Pa.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Pa.reject(e)}static resolve(t){return new Pa(((e,n)=>{e(t)}))}static reject(t){return new Pa(((e,n)=>{n(t)}))}static waitFor(t){return new Pa(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=Pa.resolve(!1);for(const n of t)e=e.next((t=>t?Pa.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}}class Va{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Fa,this.transaction.oncomplete=()=>{this.ft.resolve()},this.transaction.onabort=()=>{e.error?this.ft.reject(new Ba(t,e.error)):this.ft.resolve()},this.transaction.onerror=e=>{const n=za(e.target.error);this.ft.reject(new Ba(t,n))}}static open(t,e,n,r){try{return new Va(e,t.transaction(r,n))}catch(t){throw new Ba(e,t)}}get dt(){return this.ft.promise}abort(t){t&&this.ft.reject(t),this.aborted||(zr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new $a(e)}}class Ua{constructor(t,e,n){this.name=t,this.version=e,this.wt=n,12.2===Ua._t(h())&&Hr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return zr("SimpleDb","Removing database:",t),Ka(window.indexedDB.deleteDatabase(t)).toPromise()}static gt(){if("undefined"==typeof indexedDB)return!1;if(Ua.yt())return!0;const t=h(),e=Ua._t(t),n=0<e&&e<10,r=Ua.Et(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static yt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)}static It(t,e){return t.store(e)}static _t(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Et(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async At(t){return this.db||(zr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Ba(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new jr(Br.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Ba(t,r))},r.onupgradeneeded=t=>{zr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.wt.Rt(e,r.transaction,t.oldVersion,this.version).next((()=>{zr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Pt&&(this.db.onversionchange=t=>this.Pt(t)),this.db}bt(t){this.Pt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.At(t);const e=Va.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).catch((t=>(e.abort(t),Pa.reject(t)))).toPromise();return i.catch((()=>{})),await e.dt,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if(zr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class qa{constructor(t){this.vt=t,this.Vt=!1,this.St=null}get isDone(){return this.Vt}get Dt(){return this.St}set cursor(t){this.vt=t}done(){this.Vt=!0}Ct(t){this.St=t}delete(){return Ka(this.vt.delete())}}class Ba extends jr{constructor(t,e){super(Br.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function ja(t){return"IndexedDbTransactionError"===t.name}class $a{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(zr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(zr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ka(n)}add(t){return zr("SimpleDb","ADD",this.store.name,t,t),Ka(this.store.add(t))}get(t){return Ka(this.store.get(t)).next((e=>(void 0===e&&(e=null),zr("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return zr("SimpleDb","DELETE",this.store.name,t),Ka(this.store.delete(t))}count(){return zr("SimpleDb","COUNT",this.store.name),Ka(this.store.count())}Nt(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.xt(n,((t,e)=>{r.push(e)})).next((()=>r))}kt(t,e){zr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.$t=!1;const r=this.cursor(n);return this.xt(r,((t,e,n)=>n.delete()))}Ot(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.xt(r,e)}Ft(t){const e=this.cursor({});return new Pa(((n,r)=>{e.onerror=t=>{const e=za(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}xt(t,e){const n=[];return new Pa(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new qa(s),o=e(s.primaryKey,s.value,i);if(o instanceof Pa){const t=o.catch((t=>(i.done(),Pa.reject(t))));n.push(t)}i.isDone?r():null===i.Dt?s.continue():s.continue(i.Dt)}})).next((()=>Pa.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.$t?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ka(t){return new Pa(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=za(t.target.error);n(e)}}))}let Ga=!1;function za(t){const e=Ua._t(h());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new jr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ga||(Ga=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Ha extends Ma{constructor(t,e){super(),this.Mt=t,this.currentSequenceNumber=e}}function Qa(t,e){const n=Jr(t);return Ua.It(n.Mt,e)}class Wa{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&zi(r,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Hi(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Hi(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(is.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Eo())}isEqual(t){return this.batchId===t.batchId&&ns(this.mutations,t.mutations,((t,e)=>Wi(t,e)))&&ns(this.baseMutations,t.baseMutations,((t,e)=>Wi(t,e)))}}class Ya{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Xr(t.mutations.length===n.length);let r=bo();const s=t.mutations;for(let t=0;t<s.length;t++)r=r.insert(s[t].key,n[t].version);return new Ya(t,e,n,r)}}class Xa{constructor(t,e,n,r,s=is.min(),i=is.min(),o=gs.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new Xa(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Ja{constructor(t){this.Lt=t}}function Za(t,e){if(e.document)return Yo(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=_s.fromSegments(e.noDocument.path),n=sc(e.noDocument.readTime),r=js.newNoDocument(t,n);return e.hasCommittedMutations?r.setHasCommittedMutations():r}if(e.unknownDocument){const t=_s.fromSegments(e.unknownDocument.path),n=sc(e.unknownDocument.version);return js.newUnknownDocument(t,n)}return Yr()}function tc(t,e,n){const r=ec(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:$o(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Po(t,e.version.toTimestamp())}}(t.Lt,e),i=e.hasCommittedMutations;return new Sa(null,null,n,i,r,s)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=rc(e.version),i=e.hasCommittedMutations;return new Sa(null,new Ea(t,n),null,i,r,s)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=rc(e.version);return new Sa(new Ia(t,n),null,null,!0,r,s)}return Yr()}function ec(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function nc(t){const e=new ss(t[0],t[1]);return is.fromTimestamp(e)}function rc(t){const e=t.toTimestamp();return new ya(e.seconds,e.nanoseconds)}function sc(t){const e=new ss(t.seconds,t.nanoseconds);return is.fromTimestamp(e)}function ic(t,e){const n=(e.baseMutations||[]).map((e=>Jo(t.Lt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Jo(t.Lt,e))),s=ss.fromMillis(e.localWriteTimeMs);return new Wa(e.batchId,s,n,r)}function oc(t){const e=sc(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?sc(t.lastLimboFreeSnapshotVersion):is.min();let r;var s;return void 0!==t.query.documents?(Xr(1===(s=t.query).documents.length),r=wi(li(zo(s.documents[0])))):r=function(t){return wi(ea(t))}(t.query),new Xa(r,t.targetId,0,t.lastListenSequenceNumber,e,n,gs.fromBase64String(t.resumeToken))}function ac(t,e){const n=rc(e.snapshotVersion),r=rc(e.lastLimboFreeSnapshotVersion);let s;s=Hs(e.target)?Zo(t.Lt,e.target):ta(t.Lt,e.target);const i=e.resumeToken.toBase64();return new Aa(e.targetId,Gs(e.target),n,i,e.sequenceNumber,r,s)}function cc(t){const e=ea({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?vi(e,e.limit,"L"):e}class uc{getBundleMetadata(t,e){return hc(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:sc(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return hc(t).put({bundleId:(n=e).id,createTime:rc(qo(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return lc(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:cc(e.bundledQuery),readTime:sc(e.readTime)};var e}))}saveNamedQuery(t,e){return lc(t).put(function(t){return{name:t.name,readTime:rc(qo(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function hc(t){return Qa(t,ka.store)}function lc(t){return Qa(t,Ra.store)}class dc{constructor(){this.Bt=new fc}addToCollectionParentIndex(t,e){return this.Bt.add(e),Pa.resolve()}getCollectionParents(t,e){return Pa.resolve(this.Bt.getEntries(e))}}class fc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new fo(hs.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new fo(hs.comparator)).toArray()}}class gc{constructor(){this.Ut=new fc}addToCollectionParentIndex(t,e){if(!this.Ut.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.Ut.add(e)}));const s={collectionId:n,parent:fa(r)};return mc(t).put(s)}return Pa.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[rs(e),""],!1,!0);return mc(t).Nt(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(pa(r.parent))}return n}))}}function mc(t){return Qa(t,Ca.store)}const pc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new yc(t,yc.DEFAULT_COLLECTION_PERCENTILE,yc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function wc(t,e,n){const r=t.store(ba.store),s=t.store(Ta.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Ot({range:o},((t,e,n)=>(a++,n.delete())));i.push(c.next((()=>{Xr(1===a)})));const u=[];for(const t of n.mutations){const r=Ta.key(e,t.key.path,n.batchId);i.push(s.delete(r)),u.push(t.key)}return Pa.waitFor(i).next((()=>u))}function vc(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Yr();e=t.noDocument}return JSON.stringify(e).length}yc.DEFAULT_COLLECTION_PERCENTILE=10,yc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yc.DEFAULT=new yc(41943040,yc.DEFAULT_COLLECTION_PERCENTILE,yc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yc.DISABLED=new yc(-1,0,0);class bc{constructor(t,e,n,r){this.userId=t,this.R=e,this.qt=n,this.referenceDelegate=r,this.Kt={}}static jt(t,e,n,r){Xr(""!==t.uid);const s=t.isAuthenticated()?t.uid:"";return new bc(s,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ec(t).Ot({index:ba.userMutationsIndex,range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const s=Ic(t),i=Ec(t);return i.add({}).next((o=>{Xr("number"==typeof o);const a=new Wa(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map((e=>Xo(t.Lt,e))),s=n.mutations.map((e=>Xo(t.Lt,e)));return new ba(e,n.batchId,n.localWriteTime.toMillis(),r,s)}(this.R,this.userId,a),u=[];let h=new fo(((t,e)=>es(t.canonicalString(),e.canonicalString())));for(const t of r){const e=Ta.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(i.put(c)),u.push(s.put(e,Ta.PLACEHOLDER))}return h.forEach((e=>{u.push(this.qt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Kt[o]=a.keys()})),Pa.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return Ec(t).get(e).next((t=>t?(Xr(t.userId===this.userId),ic(this.R,t)):null))}Qt(t,e){return this.Kt[e]?Pa.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Kt[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Ec(t).Ot({index:ba.userMutationsIndex,range:r},((t,e,r)=>{e.userId===this.userId&&(Xr(e.batchId>=n),s=ic(this.R,e)),r.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ec(t).Ot({index:ba.userMutationsIndex,range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ec(t).Nt(ba.userMutationsIndex,e).next((t=>t.map((t=>ic(this.R,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Ta.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return Ic(t).Ot({range:r},((n,r,i)=>{const[o,a,c]=n,u=pa(a);if(o===this.userId&&e.path.isEqual(u))return Ec(t).get(c).next((t=>{if(!t)throw Yr();Xr(t.userId===this.userId),s.push(ic(this.R,t))}));i.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new fo(es);const r=[];return e.forEach((e=>{const s=Ta.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=Ic(t).Ot({range:i},((t,r,s)=>{const[i,o,a]=t,c=pa(o);i===this.userId&&e.path.isEqual(c)?n=n.add(a):s.done()}));r.push(o)})),Pa.waitFor(r).next((()=>this.Wt(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,s=Ta.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new fo(es);return Ic(t).Ot({range:i},((t,e,s)=>{const[i,a,c]=t,u=pa(a);i===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):s.done()})).next((()=>this.Wt(t,o)))}Wt(t,e){const n=[],r=[];return e.forEach((e=>{r.push(Ec(t).get(e).next((t=>{if(null===t)throw Yr();Xr(t.userId===this.userId),n.push(ic(this.R,t))})))})),Pa.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return wc(t.Mt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Gt(e.batchId)})),Pa.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Gt(t){delete this.Kt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Pa.resolve();const n=IDBKeyRange.lowerBound(Ta.prefixForUser(this.userId)),r=[];return Ic(t).Ot({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=pa(t[1]);r.push(e)}else n.done()})).next((()=>{Xr(0===r.length)}))}))}containsKey(t,e){return Tc(t,this.userId,e)}zt(t){return Sc(t).get(this.userId).next((t=>t||new va(this.userId,-1,"")))}}function Tc(t,e,n){const r=Ta.prefixForPath(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ic(t).Ot({range:i,$t:!0},((t,n,r)=>{const[i,a,c]=t;i===e&&a===s&&(o=!0),r.done()})).next((()=>o))}function Ec(t){return Qa(t,ba.store)}function Ic(t){return Qa(t,Ta.store)}function Sc(t){return Qa(t,va.store)}class _c{constructor(t){this.Ht=t}next(){return this.Ht+=2,this.Ht}static Jt(){return new _c(0)}static Yt(){return new _c(-1)}}class Ac{constructor(t,e){this.referenceDelegate=t,this.R=e}allocateTargetId(t){return this.Xt(t).next((e=>{const n=new _c(e.highestTargetId);return e.highestTargetId=n.next(),this.Zt(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Xt(t).next((t=>is.fromTimestamp(new ss(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Xt(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Xt(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.Zt(t,r))))}addTargetData(t,e){return this.te(t,e).next((()=>this.Xt(t).next((n=>(n.targetCount+=1,this.ee(e,n),this.Zt(t,n))))))}updateTargetData(t,e){return this.te(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Dc(t).delete(e.targetId))).next((()=>this.Xt(t))).next((e=>(Xr(e.targetCount>0),e.targetCount-=1,this.Zt(t,e))))}removeTargets(t,e,n){let r=0;const s=[];return Dc(t).Ot(((i,o)=>{const a=oc(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.removeTargetData(t,a)))})).next((()=>Pa.waitFor(s))).next((()=>r))}forEachTarget(t,e){return Dc(t).Ot(((t,n)=>{const r=oc(n);e(r)}))}Xt(t){return Nc(t).get(Na.key).next((t=>(Xr(null!==t),t)))}Zt(t,e){return Nc(t).put(Na.key,e)}te(t,e){return Dc(t).put(ac(this.R,e))}ee(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Xt(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Gs(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return Dc(t).Ot({range:r,index:Aa.queryTargetsIndexName},((t,n,r)=>{const i=oc(n);zs(e,i.target)&&(s=i,r.done())})).next((()=>s))}addMatchingKeys(t,e,n){const r=[],s=Cc(t);return e.forEach((e=>{const i=fa(e.path);r.push(s.put(new Da(n,i))),r.push(this.referenceDelegate.addReference(t,n,e))})),Pa.waitFor(r)}removeMatchingKeys(t,e,n){const r=Cc(t);return Pa.forEach(e,(e=>{const s=fa(e.path);return Pa.waitFor([r.delete([n,s]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Cc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Cc(t);let s=Eo();return r.Ot({range:n,$t:!0},((t,e,n)=>{const r=pa(t[1]),i=new _s(r);s=s.add(i)})).next((()=>s))}containsKey(t,e){const n=fa(e.path),r=IDBKeyRange.bound([n],[rs(n)],!1,!0);let s=0;return Cc(t).Ot({index:Da.documentTargetsIndex,$t:!0,range:r},(([t,e],n,r)=>{0!==t&&(s++,r.done())})).next((()=>s>0))}lt(t,e){return Dc(t).get(e).next((t=>t?oc(t):null))}}function Dc(t){return Qa(t,Aa.store)}function Nc(t){return Qa(t,Na.store)}function Cc(t){return Qa(t,Da.store)}async function xc(t){if(t.code!==Br.FAILED_PRECONDITION||t.message!==Oa)throw t;zr("LocalStore","Unexpectedly lost primary lease")}function kc([t,e],[n,r]){const s=es(t,n);return 0===s?es(e,r):s}class Rc{constructor(t){this.ne=t,this.buffer=new fo(kc),this.se=0}ie(){return++this.se}re(t){const e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();kc(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Lc{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)}stop(){this.ce&&(this.ce.cancel(),this.ce=null)}get started(){return null!==this.ce}ue(t){const e=this.oe?3e5:6e4;zr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.ce=null,this.oe=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){ja(t)?zr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await xc(t)}await this.ue(t)}))}}class Oc{constructor(t,e){this.ae=t,this.params=e}calculateTargetCount(t,e){return this.ae.he(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Pa.resolve(qr.o);const n=new Rc(e);return this.ae.forEachTarget(t,(t=>n.re(t.sequenceNumber))).next((()=>this.ae.le(t,(t=>n.re(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.ae.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.ae.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(zr("LruGarbageCollector","Garbage collection skipped; disabled"),Pa.resolve(pc)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(zr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),pc):this.fe(t,e)))}getCacheSize(t){return this.ae.getCacheSize(t)}fe(t,e){let n,r,s,i,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(zr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),Kr()<=w.DEBUG&&zr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-u}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Pa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}class Mc{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Oc(t,e)}(this,e)}he(t){const e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}de(t){let e=0;return this.le(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}le(t,e){return this.we(t,((t,n)=>e(n)))}addReference(t,e,n){return Fc(t,n)}removeReference(t,e,n){return Fc(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Fc(t,e)}_e(t,e){return function(t,e){let n=!1;return Sc(t).Ft((r=>Tc(t,r,e).next((t=>(t&&(n=!0),Pa.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.we(t,((i,o)=>{if(o<=e){const e=this._e(t,i).next((e=>{if(!e)return s++,n.getEntry(t,i).next((()=>(n.removeEntry(i),Cc(t).delete([0,fa(i.path)]))))}));r.push(e)}})).next((()=>Pa.waitFor(r))).next((()=>n.apply(t))).next((()=>s))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Fc(t,e)}we(t,e){const n=Cc(t);let r,s=qr.o;return n.Ot({index:Da.documentTargetsIndex},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==qr.o&&e(new _s(pa(r)),s),s=o,r=i):s=qr.o})).next((()=>{s!==qr.o&&e(new _s(pa(r)),s)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Fc(t,e){return Cc(t).put(function(t,e){return new Da(0,fa(t.path),e)}(e,t.currentSequenceNumber))}class Pc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1}forEach(t){as(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return cs(this.inner)}}class Vc{constructor(){this.changes=new Pc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:is.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:js.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Pa.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Uc{constructor(t,e){this.R=t,this.qt=e}addEntry(t,e,n){return jc(t).put($c(e),n)}removeEntry(t,e){const n=jc(t),r=$c(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.me(t,n))))}getEntry(t,e){return jc(t).get($c(e)).next((t=>this.ge(e,t)))}ye(t,e){return jc(t).get($c(e)).next((t=>({document:this.ge(e,t),size:vc(t)})))}getEntries(t,e){let n=po();return this.pe(t,e,((t,e)=>{const r=this.ge(t,e);n=n.insert(t,r)})).next((()=>n))}Ee(t,e){let n=po(),r=new uo(_s.comparator);return this.pe(t,e,((t,e)=>{const s=this.ge(t,e);n=n.insert(t,s),r=r.insert(t,vc(e))})).next((()=>({documents:n,Te:r})))}pe(t,e,n){if(e.isEmpty())return Pa.resolve();const r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),s=e.getIterator();let i=s.getNext();return jc(t).Ot({range:r},((t,e,r)=>{const o=_s.fromSegments(t);for(;i&&_s.comparator(i,o)<0;)n(i,null),i=s.getNext();i&&i.isEqual(o)&&(n(i,e),i=s.hasNext()?s.getNext():null),i?r.Ct(i.path.toArray()):r.done()})).next((()=>{for(;i;)n(i,null),i=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(t,e,n){let r=po();const s=e.path.length+1,i={};if(n.isEqual(is.min())){const t=e.path.toArray();i.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),r=ec(n);i.range=IDBKeyRange.lowerBound([t,r],!0),i.index=Sa.collectionReadTimeIndex}return jc(t).Ot(i,((t,n,i)=>{if(t.length!==s)return;const o=Za(this.R,n);e.path.isPrefixOf(o.key.path)?Ii(e,o)&&(r=r.insert(o.key,o)):i.done()})).next((()=>r))}newChangeBuffer(t){return new qc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Bc(t).get(_a.key).next((t=>(Xr(!!t),t)))}me(t,e){return Bc(t).put(_a.key,e)}ge(t,e){if(e){const t=Za(this.R,e);if(!t.isNoDocument()||!t.version.isEqual(is.min()))return t}return js.newInvalidDocument(t)}}class qc extends Vc{constructor(t,e){super(),this.Ie=t,this.trackRemovals=e,this.Ae=new Pc((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new fo(((t,e)=>es(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((s,i)=>{const o=this.Ae.get(s);if(i.document.isValidDocument()){const a=tc(this.Ie.R,i.document,this.getReadTime(s));r=r.add(s.path.popLast());const c=vc(a);n+=c-o,e.push(this.Ie.addEntry(t,s,a))}else if(n-=o,this.trackRemovals){const n=tc(this.Ie.R,js.newNoDocument(s,is.min()),this.getReadTime(s));e.push(this.Ie.addEntry(t,s,n))}else e.push(this.Ie.removeEntry(t,s))})),r.forEach((n=>{e.push(this.Ie.qt.addToCollectionParentIndex(t,n))})),e.push(this.Ie.updateMetadata(t,n)),Pa.waitFor(e)}getFromCache(t,e){return this.Ie.ye(t,e).next((t=>(this.Ae.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Ie.Ee(t,e).next((({documents:t,Te:e})=>(e.forEach(((t,e)=>{this.Ae.set(t,e)})),t)))}}function Bc(t){return Qa(t,_a.store)}function jc(t){return Qa(t,Sa.store)}function $c(t){return t.path.toArray()}class Kc{constructor(t){this.R=t}Rt(t,e,n,r){Xr(n<r&&n>=0&&r<=11);const s=new Va("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(wa.store)}(t),function(t){t.createObjectStore(va.store,{keyPath:va.keyPath}),t.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Ta.store)}(t),Gc(t),function(t){t.createObjectStore(Sa.store)}(t));let i=Pa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Da.store),t.deleteObjectStore(Aa.store),t.deleteObjectStore(Na.store)}(t),Gc(t)),i=i.next((()=>function(t){const e=t.store(Na.store),n=new Na(0,0,is.min().toTimestamp(),0);return e.put(Na.key,n)}(s)))),n<4&&r>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store(ba.store).Nt().next((n=>{t.deleteObjectStore(ba.store),t.createObjectStore(ba.store,{keyPath:ba.keyPath,autoIncrement:!0}).createIndex(ba.userMutationsIndex,ba.userMutationsKeyPath,{unique:!0});const r=e.store(ba.store),s=n.map((t=>r.put(t)));return Pa.waitFor(s)}))}(t,s)))),i=i.next((()=>{!function(t){t.createObjectStore(xa.store,{keyPath:xa.keyPath})}(t)}))),n<5&&r>=5&&(i=i.next((()=>this.Re(s)))),n<6&&r>=6&&(i=i.next((()=>(function(t){t.createObjectStore(_a.store)}(t),this.Pe(s))))),n<7&&r>=7&&(i=i.next((()=>this.be(s)))),n<8&&r>=8&&(i=i.next((()=>this.ve(t,s)))),n<9&&r>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Sa.store);e.createIndex(Sa.readTimeIndex,Sa.readTimeIndexPath,{unique:!1}),e.createIndex(Sa.collectionReadTimeIndex,Sa.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(i=i.next((()=>this.Ve(s)))),n<11&&r>=11&&(i=i.next((()=>{!function(t){t.createObjectStore(ka.store,{keyPath:ka.keyPath})}(t),function(t){t.createObjectStore(Ra.store,{keyPath:Ra.keyPath})}(t)}))),i}Pe(t){let e=0;return t.store(Sa.store).Ot(((t,n)=>{e+=vc(n)})).next((()=>{const n=new _a(e);return t.store(_a.store).put(_a.key,n)}))}Re(t){const e=t.store(va.store),n=t.store(ba.store);return e.Nt().next((e=>Pa.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Nt(ba.userMutationsIndex,r).next((n=>Pa.forEach(n,(n=>{Xr(n.userId===e.userId);const r=ic(this.R,n);return wc(t,e.userId,r).next((()=>{}))}))))}))))}be(t){const e=t.store(Da.store),n=t.store(Sa.store);return t.store(Na.store).get(Na.key).next((t=>{const r=[];return n.Ot(((n,s)=>{const i=new hs(n),o=function(t){return[0,fa(t)]}(i);r.push(e.get(o).next((n=>n?Pa.resolve():(n=>e.put(new Da(0,fa(n),t.highestListenSequenceNumber)))(i))))})).next((()=>Pa.waitFor(r)))}))}ve(t,e){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath});const n=e.store(Ca.store),r=new fc,s=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:fa(r)})}};return e.store(Sa.store).Ot({$t:!0},((t,e)=>{const n=new hs(t);return s(n.popLast())})).next((()=>e.store(Ta.store).Ot({$t:!0},(([t,e,n],r)=>{const i=pa(e);return s(i.popLast())}))))}Ve(t){const e=t.store(Aa.store);return e.Ot(((t,n)=>{const r=oc(n),s=ac(this.R,r);return e.put(s)}))}}function Gc(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath}).createIndex(Da.documentTargetsIndex,Da.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Aa.store,{keyPath:Aa.keyPath}).createIndex(Aa.queryTargetsIndexName,Aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Na.store)}const zc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Hc{constructor(t,e,n,r,s,i,o,a,c,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Se=s,this.window=i,this.document=o,this.De=c,this.Ce=u,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.$e=null,this.Oe=null,this.Fe=Number.NEGATIVE_INFINITY,this.Me=t=>Promise.resolve(),!Hc.gt())throw new jr(Br.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Mc(this,r),this.Le=e+"main",this.R=new Ja(a),this.Be=new Ua(this.Le,11,new Kc(this.R)),this.Ue=new Ac(this.referenceDelegate,this.R),this.qt=new gc,this.qe=function(t,e){return new Uc(t,e)}(this.R,this.qt),this.Ke=new uc,this.window&&this.window.localStorage?this.je=this.window.localStorage:(this.je=null,!1===u&&Hr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Qe().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new jr(Br.FAILED_PRECONDITION,zc);return this.We(),this.Ge(),this.ze(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Ue.getHighestSequenceNumber(t)))})).then((t=>{this.Ne=new qr(t,this.De)})).then((()=>{this.xe=!0})).catch((t=>(this.Be&&this.Be.close(),Promise.reject(t))))}He(t){return this.Me=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Be.bt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((async()=>{this.started&&await this.Qe()})))}Qe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Wc(t).put(new xa(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.Je(t).next((t=>{t||(this.isPrimary=!1,this.Se.enqueueRetryable((()=>this.Me(!1))))}))})).next((()=>this.Ye(t))).next((e=>this.isPrimary&&!e?this.Xe(t).next((()=>!1)):!!e&&this.Ze(t).next((()=>!0)))))).catch((t=>{if(ja(t))return zr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return zr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Se.enqueueRetryable((()=>this.Me(t))),this.isPrimary=t}))}Je(t){return Qc(t).get(wa.key).next((t=>Pa.resolve(this.tn(t))))}en(t){return Wc(t).delete(this.clientId)}async nn(){if(this.isPrimary&&!this.sn(this.Fe,18e5)){this.Fe=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=Qa(t,xa.store);return e.Nt().next((t=>{const n=this.rn(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return Pa.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.je)for(const e of t)this.je.removeItem(this.on(e.clientId))}}ze(){this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Qe().then((()=>this.nn())).then((()=>this.ze()))))}tn(t){return!!t&&t.ownerId===this.clientId}Ye(t){return this.Ce?Pa.resolve(!0):Qc(t).get(wa.key).next((e=>{if(null!==e&&this.sn(e.leaseTimestampMs,5e3)&&!this.cn(e.ownerId)){if(this.tn(e)&&this.networkEnabled)return!0;if(!this.tn(e)){if(!e.allowTabSynchronization)throw new jr(Br.FAILED_PRECONDITION,zc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Wc(t).Nt().next((t=>void 0===this.rn(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&zr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),await this.Be.runTransaction("shutdown","readwrite",[wa.store,xa.store],(t=>{const e=new Ha(t,qr.o);return this.Xe(e).next((()=>this.en(e)))})),this.Be.close(),this.ln()}rn(t,e){return t.filter((t=>this.sn(t.updateTimeMs,e)&&!this.cn(t.clientId)))}fn(){return this.runTransaction("getActiveClients","readonly",(t=>Wc(t).Nt().next((t=>this.rn(t,18e5).map((t=>t.clientId))))))}get started(){return this.xe}getMutationQueue(t){return bc.jt(t,this.R,this.qt,this.referenceDelegate)}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getIndexManager(){return this.qt}getBundleCache(){return this.Ke}runTransaction(t,e,n){zr("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite";let s;return this.Be.runTransaction(t,r,La,(r=>(s=new Ha(r,this.Ne?this.Ne.next():qr.o),"readwrite-primary"===e?this.Je(s).next((t=>!!t||this.Ye(s))).next((e=>{if(!e)throw Hr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Se.enqueueRetryable((()=>this.Me(!1))),new jr(Br.FAILED_PRECONDITION,Oa);return n(s)})).next((t=>this.Ze(s).next((()=>t)))):this.dn(s).next((()=>n(s)))))).then((t=>(s.raiseOnCommittedEvent(),t)))}dn(t){return Qc(t).get(wa.key).next((t=>{if(null!==t&&this.sn(t.leaseTimestampMs,5e3)&&!this.cn(t.ownerId)&&!this.tn(t)&&!(this.Ce||this.allowTabSynchronization&&t.allowTabSynchronization))throw new jr(Br.FAILED_PRECONDITION,zc)}))}Ze(t){const e=new wa(this.clientId,this.allowTabSynchronization,Date.now());return Qc(t).put(wa.key,e)}static gt(){return Ua.gt()}Xe(t){const e=Qc(t);return e.get(wa.key).next((t=>this.tn(t)?(zr("IndexedDbPersistence","Releasing primary lease."),e.delete(wa.key)):Pa.resolve()))}sn(t,e){const n=Date.now();return!(t<n-e||t>n&&(Hr(`Detected an update time that is in the future: ${t} > ${n}`),1))}We(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.$e=()=>{this.Se.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Qe())))},this.document.addEventListener("visibilitychange",this.$e),this.inForeground="visible"===this.document.visibilityState)}an(){this.$e&&(this.document.removeEventListener("visibilitychange",this.$e),this.$e=null)}Ge(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=()=>{this.un(),l()&&navigator.appVersion.match("Version/14")&&this.Se.enterRestrictedMode(!0),this.Se.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ke))}hn(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)}cn(t){var e;try{const n=null!==(null===(e=this.je)||void 0===e?void 0:e.getItem(this.on(t)));return zr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Hr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}un(){if(this.je)try{this.je.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Hr("Failed to set zombie client id.",t)}}ln(){if(this.je)try{this.je.removeItem(this.on(this.clientId))}catch(t){}}on(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Qc(t){return Qa(t,wa.store)}function Wc(t){return Qa(t,xa.store)}function Yc(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Xc{constructor(t,e){this.progress=t,this.wn=e}}class Jc{constructor(t,e,n){this.qe=t,this._n=e,this.qt=n}mn(t,e){return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.gn(t,e,n)))}gn(t,e,n){return this.qe.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}yn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}pn(t,e){return this.qe.getEntries(t,e).next((e=>this.En(t,e).next((()=>e))))}En(t,e){return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.yn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return _s.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):pi(e)?this.In(t,e,n):this.An(t,e,n)}Tn(t,e){return this.mn(t,new _s(e)).next((t=>{let e=wo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}In(t,e,n){const r=e.collectionGroup;let s=wo();return this.qt.getCollectionParents(t,r).next((i=>Pa.forEach(i,(i=>{const o=function(t,e){return new ui(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(r));return this.An(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}An(t,e,n){let r,s;return this.qe.getDocumentsMatchingQuery(t,e,n).next((n=>(r=n,this._n.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(s=e,this.Rn(t,s,r).next((t=>{r=t;for(const t of s)for(const e of t.mutations){const n=e.key;let s=r.get(n);null==s&&(s=js.newInvalidDocument(n),r=r.insert(n,s)),Hi(e,s,t.localWriteTime),s.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((t,n)=>{Ii(e,n)||(r=r.remove(t))})),r)))}Rn(t,e,n){let r=Eo();for(const t of e)for(const e of t.mutations)e instanceof Ji&&null===n.get(e.key)&&(r=r.add(e.key));let s=n;return this.qe.getEntries(t,r).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(s=s.insert(t,e))})),s)))}}class Zc{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Pn=n,this.bn=r}static vn(t,e){let n=Eo(),r=Eo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Zc(t,e.fromCache,n,r)}}class tu{Vn(t){this.Sn=t}getDocumentsMatchingQuery(t,e,n,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(is.min())?this.Dn(t,e):this.Sn.pn(t,r).next((s=>{const i=this.Cn(e,s);return(di(e)||fi(e))&&this.Nn(e.limitType,i,r,n)?this.Dn(t,e):(Kr()<=w.DEBUG&&zr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ei(e)),this.Sn.getDocumentsMatchingQuery(t,e,n).next((t=>(i.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Cn(t,e){let n=new fo(Si(t));return e.forEach(((e,r)=>{Ii(t,r)&&(n=n.add(r))})),n}Nn(t,e,n,r){if(n.size!==e.size)return!0;const s="F"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Dn(t,e){return Kr()<=w.DEBUG&&zr("QueryEngine","Using full collection scan to execute query:",Ei(e)),this.Sn.getDocumentsMatchingQuery(t,e,is.min())}}class eu{constructor(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new uo(es),this.$n=new Pc((t=>Gs(t)),zs),this.On=is.min(),this._n=t.getMutationQueue(n),this.Fn=t.getRemoteDocumentCache(),this.Ue=t.getTargetCache(),this.Mn=new Jc(this.Fn,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.kn)))}}function nu(t,e,n,r){return new eu(t,e,n,r)}async function ru(t,e){const n=Jr(t);let r=n._n,s=n.Mn;const i=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n._n.getAllMutationBatches(t).next((o=>(i=o,r=n.persistence.getMutationQueue(e),s=new Jc(n.Fn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)))).next((e=>{const n=[],r=[];let o=Eo();for(const t of i){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return s.pn(t,o).next((t=>({Ln:t,removedBatchIds:n,addedBatchIds:r})))}))}));return n._n=r,n.Mn=s,n.xn.Vn(n.Mn),i}function su(t){const e=Jr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Ue.getLastRemoteSnapshotVersion(t)))}function iu(t,e,n,r,s){let i=Eo();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=po();return n.forEach(((n,o)=>{const a=t.get(n),c=(null==s?void 0:s.get(n))||r;o.isNoDocument()&&o.version.isEqual(is.min())?(e.removeEntry(n,c),i=i.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o,c),i=i.insert(n,o)):zr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),i}))}function ou(t,e){const n=Jr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e))))}function au(t,e){const n=Jr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Ue.getTargetData(t,e).next((s=>s?(r=s,Pa.resolve(r)):n.Ue.allocateTargetId(t).next((s=>(r=new Xa(e,s,0,t.currentSequenceNumber),n.Ue.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.$n.set(e,t.targetId)),t}))}async function cu(t,e,n){const r=Jr(t),s=r.kn.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!ja(t))throw t;zr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.kn=r.kn.remove(e),r.$n.delete(s.target)}function uu(t,e,n){const r=Jr(t);let s=is.min(),i=Eo();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=Jr(t),s=r.$n.get(n);return void 0!==s?Pa.resolve(r.kn.get(s)):r.Ue.getTargetData(e,n)}(r,t,wi(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Ue.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.xn.getDocumentsMatchingQuery(t,e,n?s:is.min(),n?i:Eo()))).next((t=>({documents:t,Bn:i})))))}function hu(t,e){const n=Jr(t),r=Jr(n.Ue),s=n.kn.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",(t=>r.lt(t,e).next((t=>t?t.target:null))))}function lu(t){const e=Jr(t);return e.persistence.runTransaction("Get new document changes","readonly",(t=>function(t,e,n){const r=Jr(t);let s=po(),i=ec(n);const o=jc(e),a=IDBKeyRange.lowerBound(i,!0);return o.Ot({index:Sa.readTimeIndex,range:a},((t,e)=>{const n=Za(r.R,e);s=s.insert(n.key,n),i=e.readTime})).next((()=>({wn:s,readTime:nc(i)})))}(e.Fn,t,e.On))).then((({wn:t,readTime:n})=>(e.On=n,t)))}async function du(t,e,n=Eo()){const r=await au(t,wi(cc(e.bundledQuery))),s=Jr(t);return s.persistence.runTransaction("Save named query","readwrite",(t=>{const i=qo(e.readTime);if(r.snapshotVersion.compareTo(i)>=0)return s.Ke.saveNamedQuery(t,e);const o=r.withResumeToken(gs.EMPTY_BYTE_STRING,i);return s.kn=s.kn.insert(o.targetId,o),s.Ue.updateTargetData(t,o).next((()=>s.Ue.removeMatchingKeysForTargetId(t,r.targetId))).next((()=>s.Ue.addMatchingKeys(t,n,r.targetId))).next((()=>s.Ke.saveNamedQuery(t,e)))}))}class fu{constructor(t){this.R=t,this.jn=new Map,this.Qn=new Map}getBundleMetadata(t,e){return Pa.resolve(this.jn.get(e))}saveBundleMetadata(t,e){var n;return this.jn.set(e.id,{id:(n=e).id,version:n.version,createTime:qo(n.createTime)}),Pa.resolve()}getNamedQuery(t,e){return Pa.resolve(this.Qn.get(e))}saveNamedQuery(t,e){return this.Qn.set(e.name,function(t){return{name:t.name,query:cc(t.bundledQuery),readTime:qo(t.readTime)}}(e)),Pa.resolve()}}class gu{constructor(){this.Wn=new fo(mu.Gn),this.zn=new fo(mu.Hn)}isEmpty(){return this.Wn.isEmpty()}addReference(t,e){const n=new mu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)}Jn(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Yn(new mu(t,e))}Xn(t,e){t.forEach((t=>this.removeReference(t,e)))}Zn(t){const e=new _s(new hs([])),n=new mu(e,t),r=new mu(e,t+1),s=[];return this.zn.forEachInRange([n,r],(t=>{this.Yn(t),s.push(t.key)})),s}ts(){this.Wn.forEach((t=>this.Yn(t)))}Yn(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)}es(t){const e=new _s(new hs([])),n=new mu(e,t),r=new mu(e,t+1);let s=Eo();return this.zn.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new mu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class mu{constructor(t,e){this.key=t,this.ns=e}static Gn(t,e){return _s.comparator(t.key,e.key)||es(t.ns,e.ns)}static Hn(t,e){return es(t.ns,e.ns)||_s.comparator(t.key,e.key)}}class pu{constructor(t,e){this.qt=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new fo(mu.Gn)}checkEmpty(t){return Pa.resolve(0===this._n.length)}addMutationBatch(t,e,n,r){const s=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];const i=new Wa(s,e,n,r);this._n.push(i);for(const e of r)this.rs=this.rs.add(new mu(e.key,s)),this.qt.addToCollectionParentIndex(t,e.key.path.popLast());return Pa.resolve(i)}lookupMutationBatch(t,e){return Pa.resolve(this.os(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.cs(n),s=r<0?0:r;return Pa.resolve(this._n.length>s?this._n[s]:null)}getHighestUnacknowledgedBatchId(){return Pa.resolve(0===this._n.length?-1:this.ss-1)}getAllMutationBatches(t){return Pa.resolve(this._n.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new mu(e,0),r=new mu(e,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([n,r],(t=>{const e=this.os(t.ns);s.push(e)})),Pa.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new fo(es);return e.forEach((t=>{const e=new mu(t,0),r=new mu(t,Number.POSITIVE_INFINITY);this.rs.forEachInRange([e,r],(t=>{n=n.add(t.ns)}))})),Pa.resolve(this.us(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;_s.isDocumentKey(s)||(s=s.child(""));const i=new mu(new _s(s),0);let o=new fo(es);return this.rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.ns)),!0)}),i),Pa.resolve(this.us(o))}us(t){const e=[];return t.forEach((t=>{const n=this.os(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Xr(0===this.hs(e.batchId,"removed")),this._n.shift();let n=this.rs;return Pa.forEach(e.mutations,(r=>{const s=new mu(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.rs=n}))}Gt(t){}containsKey(t,e){const n=new mu(e,0),r=this.rs.firstAfterOrEqual(n);return Pa.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this._n.length,Pa.resolve()}hs(t,e){return this.cs(t)}cs(t){return 0===this._n.length?0:t-this._n[0].batchId}os(t){const e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]}}class yu{constructor(t,e){this.qt=t,this.ls=e,this.docs=new uo(_s.comparator),this.size=0}addEntry(t,e,n){const r=e.key,s=this.docs.get(r),i=s?s.size:0,o=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-i,this.qt.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Pa.resolve(n?n.document.clone():js.newInvalidDocument(e))}getEntries(t,e){let n=po();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():js.newInvalidDocument(t))})),Pa.resolve(n)}getDocumentsMatchingQuery(t,e,n){let r=po();const s=new _s(e.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:t,value:{document:s,readTime:o}}=i.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||Ii(e,s)&&(r=r.insert(s.key,s.clone()))}return Pa.resolve(r)}fs(t,e){return Pa.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new wu(this)}getSize(t){return Pa.resolve(this.size)}}class wu extends Vc{constructor(t){super(),this.Ie=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?e.push(this.Ie.addEntry(t,r.document,this.getReadTime(n))):this.Ie.removeEntry(n)})),Pa.waitFor(e)}getFromCache(t,e){return this.Ie.getEntry(t,e)}getAllFromCache(t,e){return this.Ie.getEntries(t,e)}}class vu{constructor(t){this.persistence=t,this.ds=new Pc((t=>Gs(t)),zs),this.lastRemoteSnapshotVersion=is.min(),this.highestTargetId=0,this.ws=0,this._s=new gu,this.targetCount=0,this.gs=_c.Jt()}forEachTarget(t,e){return this.ds.forEach(((t,n)=>e(n))),Pa.resolve()}getLastRemoteSnapshotVersion(t){return Pa.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Pa.resolve(this.ws)}allocateTargetId(t){return this.highestTargetId=this.gs.next(),Pa.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Pa.resolve()}te(t){this.ds.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.gs=new _c(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)}addTargetData(t,e){return this.te(e),this.targetCount+=1,Pa.resolve()}updateTargetData(t,e){return this.te(e),Pa.resolve()}removeTargetData(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Pa.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.ds.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.ds.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),Pa.waitFor(s).next((()=>r))}getTargetCount(t){return Pa.resolve(this.targetCount)}getTargetData(t,e){const n=this.ds.get(e)||null;return Pa.resolve(n)}addMatchingKeys(t,e,n){return this._s.Jn(e,n),Pa.resolve()}removeMatchingKeys(t,e,n){this._s.Xn(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),Pa.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._s.Zn(e),Pa.resolve()}getMatchingKeysForTargetId(t,e){const n=this._s.es(e);return Pa.resolve(n)}containsKey(t,e){return Pa.resolve(this._s.containsKey(e))}}class bu{constructor(t,e){this.ys={},this.Ne=new qr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.Ue=new vu(this),this.qt=new dc,this.qe=function(t,e){return new yu(t,e)}(this.qt,(t=>this.referenceDelegate.ps(t))),this.R=new Ja(e),this.Ke=new fu(this.R)}start(){return Promise.resolve()}shutdown(){return this.xe=!1,Promise.resolve()}get started(){return this.xe}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.qt}getMutationQueue(t){let e=this.ys[t.toKey()];return e||(e=new pu(this.qt,this.referenceDelegate),this.ys[t.toKey()]=e),e}getTargetCache(){return this.Ue}getRemoteDocumentCache(){return this.qe}getBundleCache(){return this.Ke}runTransaction(t,e,n){zr("MemoryPersistence","Starting transaction:",t);const r=new Tu(this.Ne.next());return this.referenceDelegate.Es(),n(r).next((t=>this.referenceDelegate.Ts(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Is(t,e){return Pa.or(Object.values(this.ys).map((n=>()=>n.containsKey(t,e))))}}class Tu extends Ma{constructor(t){super(),this.currentSequenceNumber=t}}class Eu{constructor(t){this.persistence=t,this.As=new gu,this.Rs=null}static Ps(t){return new Eu(t)}get bs(){if(this.Rs)return this.Rs;throw Yr()}addReference(t,e,n){return this.As.addReference(n,e),this.bs.delete(n.toString()),Pa.resolve()}removeReference(t,e,n){return this.As.removeReference(n,e),this.bs.add(n.toString()),Pa.resolve()}markPotentiallyOrphaned(t,e){return this.bs.add(e.toString()),Pa.resolve()}removeTarget(t,e){this.As.Zn(e.targetId).forEach((t=>this.bs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.bs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Es(){this.Rs=new Set}Ts(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pa.forEach(this.bs,(n=>{const r=_s.fromPath(n);return this.vs(t,r).next((t=>{t||e.removeEntry(r)}))})).next((()=>(this.Rs=null,e.apply(t))))}updateLimboDocument(t,e){return this.vs(t,e).next((t=>{t?this.bs.delete(e.toString()):this.bs.add(e.toString())}))}ps(t){return 0}vs(t,e){return Pa.or([()=>Pa.resolve(this.As.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Is(t,e)])}}class Iu{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}function Su(t,e){return`firestore_clients_${t}_${e}`}function _u(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Au(t,e){return`firestore_targets_${t}_${e}`}Iu.UNAUTHENTICATED=new Iu(null),Iu.GOOGLE_CREDENTIALS=new Iu("google-credentials-uid"),Iu.FIRST_PARTY=new Iu("first-party-uid");class Du{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Vs(t,e,n){const r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new jr(r.error.code,r.error.message))),i?new Du(t,e,r.state,s):(Hr("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Ss(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Nu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Vs(t,e){const n=JSON.parse(e);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new jr(n.error.code,n.error.message))),s?new Nu(t,n.state,r):(Hr("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Ss(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Cu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Vs(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=So();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Ss(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new Cu(t,s):(Hr("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class xu{constructor(t,e){this.clientId=t,this.onlineState=e}static Vs(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new xu(e.clientId,e.onlineState):(Hr("SharedClientState",`Failed to parse online state: ${t}`),null)}}class ku{constructor(){this.activeTargetIds=So()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}Cs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ru{constructor(t,e,n,r,s){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.$s=new uo(es),this.started=!1,this.Os=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Fs=Su(this.persistenceKey,this.Ns),this.Ms=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.$s=this.$s.insert(this.Ns,new ku),this.Ls=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Bs=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.Us=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.qs=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Ks=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}static gt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.fn();for(const e of t){if(e===this.Ns)continue;const t=this.getItem(Su(this.persistenceKey,e));if(t){const n=Cu.Vs(e,t);n&&(this.$s=this.$s.insert(n.clientId,n))}}this.js();const e=this.storage.getItem(this.qs);if(e){const t=this.Qs(e);t&&this.Ws(t)}for(const t of this.Os)this.ks(t);this.Os=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Ms,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Gs(this.$s)}isActiveQueryTarget(t){let e=!1;return this.$s.forEach(((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.zs(t,"pending")}updateMutationState(t,e,n){this.zs(t,e,n),this.Hs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(Au(this.persistenceKey,t));if(n){const r=Nu.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.js(),e}removeLocalQueryTarget(t){this.Js.Cs(t),this.js()}isLocalQueryTarget(t){return this.Js.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Au(this.persistenceKey,t))}updateQueryState(t,e,n){this.Ys(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Hs(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Xs(t)}notifyBundleLoaded(){this.Zs()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Fs),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return zr("SharedClientState","READ",t,e),e}setItem(t,e){zr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){zr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ks(t){const e=t;if(e.storageArea===this.storage){if(zr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Fs)return void Hr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Ls.test(e.key)){if(null==e.newValue){const t=this.ti(e.key);return this.ei(t,null)}{const t=this.ni(e.key,e.newValue);if(t)return this.ei(t.clientId,t)}}else if(this.Bs.test(e.key)){if(null!==e.newValue){const t=this.si(e.key,e.newValue);if(t)return this.ii(t)}}else if(this.Us.test(e.key)){if(null!==e.newValue){const t=this.ri(e.key,e.newValue);if(t)return this.oi(t)}}else if(e.key===this.qs){if(null!==e.newValue){const t=this.Qs(e.newValue);if(t)return this.Ws(t)}}else if(e.key===this.Ms){const t=function(t){let e=qr.o;if(null!=t)try{const n=JSON.parse(t);Xr("number"==typeof n),e=n}catch(t){Hr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==qr.o&&this.sequenceNumberHandler(t)}else if(e.key===this.Ks)return this.syncEngine.ci()}else this.Os.push(e)}))}}get Js(){return this.$s.get(this.Ns)}js(){this.setItem(this.Fs,this.Js.Ss())}zs(t,e,n){const r=new Du(this.currentUser,t,e,n),s=_u(this.persistenceKey,this.currentUser,t);this.setItem(s,r.Ss())}Hs(t){const e=_u(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Xs(t){const e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.qs,JSON.stringify(e))}Ys(t,e,n){const r=Au(this.persistenceKey,t),s=new Nu(t,e,n);this.setItem(r,s.Ss())}Zs(){this.setItem(this.Ks,"value-not-used")}ti(t){const e=this.Ls.exec(t);return e?e[1]:null}ni(t,e){const n=this.ti(t);return Cu.Vs(n,e)}si(t,e){const n=this.Bs.exec(t),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return Du.Vs(new Iu(s),r,e)}ri(t,e){const n=this.Us.exec(t),r=Number(n[1]);return Nu.Vs(r,e)}Qs(t){return xu.Vs(t)}async ii(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.ui(t.batchId,t.state,t.error);zr("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}oi(t){return this.syncEngine.ai(t.targetId,t.state,t.error)}ei(t,e){const n=e?this.$s.insert(t,e):this.$s.remove(t),r=this.Gs(this.$s),s=this.Gs(n),i=[],o=[];return s.forEach((t=>{r.has(t)||i.push(t)})),r.forEach((t=>{s.has(t)||o.push(t)})),this.syncEngine.hi(i,o).then((()=>{this.$s=n}))}Ws(t){this.$s.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Gs(t){let e=So();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class Lu{constructor(){this.li=new ku,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.li.Ds(t),this.fi[t]||"not-current"}updateQueryState(t,e,n){this.fi[t]=e}removeLocalQueryTarget(t){this.li.Cs(t)}isLocalQueryTarget(t){return this.li.activeTargetIds.has(t)}clearQueryState(t){delete this.fi[t]}getAllActiveQueryTargets(){return this.li.activeTargetIds}isActiveQueryTarget(t){return this.li.activeTargetIds.has(t)}start(){return this.li=new ku,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class Ou{di(t){}shutdown(){}}class Mu{constructor(){this.wi=()=>this._i(),this.mi=()=>this.gi(),this.yi=[],this.pi()}di(t){this.yi.push(t)}shutdown(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)}pi(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)}_i(){zr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.yi)t(0)}gi(){zr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.yi)t(1)}static gt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Fu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Pu{constructor(t){this.Ei=t.Ei,this.Ti=t.Ti}Ii(t){this.Ai=t}Ri(t){this.Pi=t}onMessage(t){this.bi=t}close(){this.Ti()}send(t){this.Ei(t)}vi(){this.Ai()}Vi(t){this.Pi(t)}Si(t){this.bi(t)}}class Vu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Ni(t,e,n,r){const s=this.xi(t,e);zr("RestConnection","Sending: ",s,n);const i={};return this.ki(i,r),this.$i(t,s,i,n).then((t=>(zr("RestConnection","Received: ",t),t)),(e=>{throw Qr("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e}))}Oi(t,e,n,r){return this.Ni(t,e,n,r)}ki(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+Ur,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}xi(t,e){const n=Fu[t];return`${this.Di}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}$i(t,e,n,r){return new Promise(((s,i)=>{const o=new Vr;o.listenOnce(Rr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case kr.NO_ERROR:const e=o.getResponseJson();zr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case kr.TIMEOUT:zr("Connection",'RPC "'+t+'" timed out'),i(new jr(Br.DEADLINE_EXCEEDED,"Request time out"));break;case kr.HTTP_ERROR:const n=o.getStatus();if(zr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Br).indexOf(e)>=0?e:Br.UNKNOWN}(t.status);i(new jr(e,t.message))}else i(new jr(Br.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new jr(Br.UNAVAILABLE,"Connection failed."));break;default:Yr()}}finally{zr("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}Fi(t,e){const n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Ar,s=we(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};var o;this.useFetchStreams&&(i.xmlHttpFactory=new Fr({})),this.ki(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())||"object"==typeof navigator&&"ReactNative"===navigator.product||h().indexOf("Electron/")>=0||function(){var t=h();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||h().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(i.httpHeadersOverwriteParam="$httpHeaders");const a=n.join("");zr("Connection","Creating WebChannel: "+a,i);const c=r.createWebChannel(a,i);let u=!1,l=!1;const d=new Pu({Ei:t=>{l?zr("Connection","Not sending because WebChannel is closed:",t):(u||(zr("Connection","Opening WebChannel transport."),c.open(),u=!0),zr("Connection","WebChannel sending:",t),c.send(t))},Ti:()=>c.close()}),f=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return f(c,Pr.EventType.OPEN,(()=>{l||zr("Connection","WebChannel transport opened.")})),f(c,Pr.EventType.CLOSE,(()=>{l||(l=!0,zr("Connection","WebChannel transport closed"),d.Vi())})),f(c,Pr.EventType.ERROR,(t=>{l||(l=!0,Qr("Connection","WebChannel transport errored:",t),d.Vi(new jr(Br.UNAVAILABLE,"The operation could not be completed")))})),f(c,Pr.EventType.MESSAGE,(t=>{var e;if(!l){const n=t.data[0];Xr(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){zr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=io[t];if(void 0!==e)return co(e)}(t),n=s.message;void 0===e&&(e=Br.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),l=!0,d.Vi(new jr(e,n)),c.close()}else zr("Connection","WebChannel received:",n),d.Si(n)}})),f(s,Lr.STAT_EVENT,(t=>{t.stat===Or?zr("Connection","Detected buffering proxy"):t.stat===Mr&&zr("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.vi()}),0),d}}function Uu(){return"undefined"!=typeof window?window:null}function qu(){return"undefined"!=typeof document?document:null}function Bu(t){return new Fo(t,!0)}class ju{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=s,this.Ui=0,this.qi=null,this.Ki=Date.now(),this.reset()}reset(){this.Ui=0}ji(){this.Ui=this.Bi}Qi(t){this.cancel();const e=Math.floor(this.Ui+this.Wi()),n=Math.max(0,Date.now()-this.Ki),r=Math.max(0,e-n);r>0&&zr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ui} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qi=this.Se.enqueueAfterDelay(this.timerId,r,(()=>(this.Ki=Date.now(),t()))),this.Ui*=this.Li,this.Ui<this.Mi&&(this.Ui=this.Mi),this.Ui>this.Bi&&(this.Ui=this.Bi)}Gi(){null!==this.qi&&(this.qi.skipDelay(),this.qi=null)}cancel(){null!==this.qi&&(this.qi.cancel(),this.qi=null)}Wi(){return(Math.random()-.5)*this.Ui}}class $u{constructor(t,e,n,r,s,i){this.Se=t,this.zi=n,this.Hi=r,this.Ji=s,this.listener=i,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new ju(t,e)}tr(){return 1===this.state||2===this.state||4===this.state}er(){return 2===this.state}start(){3!==this.state?this.auth():this.nr()}async stop(){this.tr()&&await this.close(0)}sr(){this.state=0,this.Zi.reset()}ir(){this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(()=>this.rr())))}cr(t){this.ur(),this.stream.send(t)}async rr(){if(this.er())return this.close(0)}ur(){this.Xi&&(this.Xi.cancel(),this.Xi=null)}async close(t,e){this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Br.RESOURCE_EXHAUSTED?(Hr(e.toString()),Hr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.ji()):e&&e.code===Br.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ri(e)}ar(){}auth(){this.state=1;const t=this.hr(this.Yi),e=this.Yi;this.Ji.getToken().then((t=>{this.Yi===e&&this.lr(t)}),(e=>{t((()=>{const t=new jr(Br.UNKNOWN,"Fetching auth token failed: "+e.message);return this.dr(t)}))}))}lr(t){const e=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((()=>{e((()=>(this.state=2,this.listener.Ii())))})),this.stream.Ri((t=>{e((()=>this.dr(t)))})),this.stream.onMessage((t=>{e((()=>this.onMessage(t)))}))}nr(){this.state=4,this.Zi.Qi((async()=>{this.state=0,this.start()}))}dr(t){return zr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}hr(t){return e=>{this.Se.enqueueAndForget((()=>this.Yi===t?e():(zr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ku extends $u{constructor(t,e,n,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,s),this.R=r}wr(t){return this.Hi.Fi("Listen",t)}onMessage(t){this.Zi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Yr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.I?(Xr(void 0===e||"string"==typeof e),gs.fromBase64String(e||"")):(Xr(void 0===e||e instanceof Uint8Array),gs.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Br.UNKNOWN:co(t.code);return new jr(e,t.message||"")}(o);n=new Co(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ko(t,r.document.name),i=qo(r.document.updateTime),o=new qs({mapValue:{fields:r.document.fields}}),a=js.newFoundDocument(s,i,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Do(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ko(t,r.document),i=r.readTime?qo(r.readTime):is.min(),o=js.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Do([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ko(t,r.document),i=r.removedTargetIds||[];n=new Do([],i,s,null)}else{if(!("filter"in e))return Yr();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,s=new so(r),i=t.targetId;n=new No(i,s)}}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return is.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?is.min():e.readTime?qo(e.readTime):is.min()}(t);return this.listener._r(e,n)}mr(t){const e={};e.database=Ho(this.R),e.addTarget=function(t,e){let n;const r=e.target;return n=Hs(r)?{documents:Zo(t,r)}:{query:ta(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Vo(t,e.resumeToken):e.snapshotVersion.compareTo(is.min())>0&&(n.readTime=Po(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Yr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)}gr(t){const e={};e.database=Ho(this.R),e.removeTarget=t,this.cr(e)}}class Gu extends $u{constructor(t,e,n,r,s){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,s),this.R=r,this.yr=!1}get pr(){return this.yr}start(){this.yr=!1,this.lastStreamToken=void 0,super.start()}ar(){this.yr&&this.Er([])}wr(t){return this.Hi.Fi("Write",t)}onMessage(t){if(Xr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.yr){this.Zi.reset();const e=function(t,e){return t&&t.length>0?(Xr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?qo(t.updateTime):qo(e);return n.isEqual(is.min())&&(n=qo(e)),new ji(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=qo(t.commitTime);return this.listener.Tr(n,e)}return Xr(!t.writeResults||0===t.writeResults.length),this.yr=!0,this.listener.Ir()}Ar(){const t={};t.database=Ho(this.R),this.cr(t)}Er(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Xo(this.R,t)))};this.cr(e)}}class zu extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Hi=e,this.R=n,this.Rr=!1}Pr(){if(this.Rr)throw new jr(Br.FAILED_PRECONDITION,"The client has already been terminated.")}Ni(t,e,n){return this.Pr(),this.credentials.getToken().then((r=>this.Hi.Ni(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Br.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new jr(Br.UNKNOWN,t.toString())}))}Oi(t,e,n){return this.Pr(),this.credentials.getToken().then((r=>this.Hi.Oi(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Br.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new jr(Br.UNKNOWN,t.toString())}))}terminate(){this.Rr=!0}}class Hu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.br=0,this.vr=null,this.Vr=!0}Sr(){0===this.br&&(this.Dr("Unknown"),this.vr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.vr=null,this.Cr("Backend didn't respond within 10 seconds."),this.Dr("Offline"),Promise.resolve()))))}Nr(t){"Online"===this.state?this.Dr("Unknown"):(this.br++,this.br>=1&&(this.kr(),this.Cr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Dr("Offline")))}set(t){this.kr(),this.br=0,"Online"===t&&(this.Vr=!1),this.Dr(t)}Dr(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Cr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(Hr(e),this.Vr=!1):zr("OnlineStateTracker",e)}kr(){null!==this.vr&&(this.vr.cancel(),this.vr=null)}}class Qu{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.$r=[],this.Or=new Map,this.Fr=new Set,this.Mr=[],this.Lr=s,this.Lr.di((t=>{n.enqueueAndForget((async()=>{rh(this)&&(zr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Jr(t);e.Fr.add(4),await Yu(e),e.Br.set("Unknown"),e.Fr.delete(4),await Wu(e)}(this))}))})),this.Br=new Hu(n,r)}}async function Wu(t){if(rh(t))for(const e of t.Mr)await e(!0)}async function Yu(t){for(const e of t.Mr)await e(!1)}function Xu(t,e){const n=Jr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),nh(n)?eh(n):bh(n).er()&&Zu(n,e))}function Ju(t,e){const n=Jr(t),r=bh(n);n.Or.delete(e),r.er()&&th(n,e),0===n.Or.size&&(r.er()?r.ir():rh(n)&&n.Br.set("Unknown"))}function Zu(t,e){t.Ur.q(e.targetId),bh(t).mr(e)}function th(t,e){t.Ur.q(e),bh(t).gr(e)}function eh(t){t.Ur=new ko({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.Or.get(e)||null}),bh(t).start(),t.Br.Sr()}function nh(t){return rh(t)&&!bh(t).tr()&&t.Or.size>0}function rh(t){return 0===Jr(t).Fr.size}function sh(t){t.Ur=void 0}async function ih(t){t.Or.forEach(((e,n)=>{Zu(t,e)}))}async function oh(t,e){sh(t),nh(t)?(t.Br.Nr(e),eh(t)):t.Br.set("Unknown")}async function ah(t,e,n){if(t.Br.set("Online"),e instanceof Co&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Or.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Or.delete(r),t.Ur.removeTarget(r))}(t,e)}catch(n){zr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ch(t,n)}else if(e instanceof Do?t.Ur.X(e):e instanceof No?t.Ur.rt(e):t.Ur.et(e),!n.isEqual(is.min()))try{const e=await su(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Ur.ut(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Or.get(r);s&&t.Or.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.Or.get(e);if(!n)return;t.Or.set(e,n.withResumeToken(gs.EMPTY_BYTE_STRING,n.snapshotVersion)),th(t,e);const r=new Xa(n.target,e,1,n.sequenceNumber);Zu(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){zr("RemoteStore","Failed to raise snapshot:",e),await ch(t,e)}}async function ch(t,e,n){if(!ja(e))throw e;t.Fr.add(1),await Yu(t),t.Br.set("Offline"),n||(n=()=>su(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{zr("RemoteStore","Retrying IndexedDB access"),await n(),t.Fr.delete(1),await Wu(t)}))}function uh(t,e){return e().catch((n=>ch(t,n,e)))}async function hh(t){const e=Jr(t),n=Th(e);let r=e.$r.length>0?e.$r[e.$r.length-1].batchId:-1;for(;lh(e);)try{const t=await ou(e.localStore,r);if(null===t){0===e.$r.length&&n.ir();break}r=t.batchId,dh(e,t)}catch(t){await ch(e,t)}fh(e)&&gh(e)}function lh(t){return rh(t)&&t.$r.length<10}function dh(t,e){t.$r.push(e);const n=Th(t);n.er()&&n.pr&&n.Er(e.mutations)}function fh(t){return rh(t)&&!Th(t).tr()&&t.$r.length>0}function gh(t){Th(t).start()}async function mh(t){Th(t).Ar()}async function ph(t){const e=Th(t);for(const n of t.$r)e.Er(n.mutations)}async function yh(t,e,n){const r=t.$r.shift(),s=Ya.from(r,e,n);await uh(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await hh(t)}async function wh(t,e){e&&Th(t).pr&&await async function(t,e){if(ao(n=e.code)&&n!==Br.ABORTED){const n=t.$r.shift();Th(t).sr(),await uh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await hh(t)}var n}(t,e),fh(t)&&gh(t)}async function vh(t,e){const n=Jr(t);e?(n.Fr.delete(2),await Wu(n)):e||(n.Fr.add(2),await Yu(n),n.Br.set("Unknown"))}function bh(t){return t.qr||(t.qr=function(t,e,n){const r=Jr(t);return r.Pr(),new Ku(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ih.bind(null,t),Ri:oh.bind(null,t),_r:ah.bind(null,t)}),t.Mr.push((async e=>{e?(t.qr.sr(),nh(t)?eh(t):t.Br.set("Unknown")):(await t.qr.stop(),sh(t))}))),t.qr}function Th(t){return t.Kr||(t.Kr=function(t,e,n){const r=Jr(t);return r.Pr(),new Gu(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:mh.bind(null,t),Ri:wh.bind(null,t),Ir:ph.bind(null,t),Tr:yh.bind(null,t)}),t.Mr.push((async e=>{e?(t.Kr.sr(),await hh(t)):(await t.Kr.stop(),t.$r.length>0&&(zr("RemoteStore",`Stopping write stream with ${t.$r.length} pending writes`),t.$r=[]))}))),t.Kr}class Eh{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Fa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Eh(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new jr(Br.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ih(t,e){if(Hr("AsyncQueue",`${e}: ${t}`),ja(t))return new jr(Br.UNAVAILABLE,`${e}: ${t}`);throw t}class Sh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||_s.comparator(e.key,n.key):(t,e)=>_s.comparator(t.key,e.key),this.keyedMap=wo(),this.sortedSet=new uo(this.comparator)}static emptySet(t){return new Sh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Sh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Sh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class _h{constructor(){this.jr=new uo(_s.comparator)}track(t){const e=t.doc.key,n=this.jr.get(e);n?0!==t.type&&3===n.type?this.jr=this.jr.insert(e,t):3===t.type&&1!==n.type?this.jr=this.jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.jr=this.jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.jr=this.jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.jr=this.jr.remove(e):1===t.type&&2===n.type?this.jr=this.jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.jr=this.jr.insert(e,{type:2,doc:t.doc}):Yr():this.jr=this.jr.insert(e,t)}Qr(){const t=[];return this.jr.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Ah{constructor(t,e,n,r,s,i,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Ah(t,e,Sh.emptySet(e),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&bi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Dh{constructor(){this.Wr=void 0,this.listeners=[]}}class Nh{constructor(){this.queries=new Pc((t=>Ti(t)),bi),this.onlineState="Unknown",this.Gr=new Set}}async function Ch(t,e){const n=Jr(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Dh),s)try{i.Wr=await n.onListen(r)}catch(t){const n=Ih(t,`Initialization of query '${Ei(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.listeners.push(e),e.zr(n.onlineState),i.Wr&&e.Hr(i.Wr)&&Lh(n)}async function xh(t,e){const n=Jr(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function kh(t,e){const n=Jr(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Hr(t)&&(r=!0);s.Wr=t}}r&&Lh(n)}function Rh(t,e,n){const r=Jr(t),s=r.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);r.queries.delete(e)}function Lh(t){t.Gr.forEach((t=>{t.next()}))}class Oh{constructor(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}Hr(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ah(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),e=!0):this.eo(t,this.onlineState)&&(this.no(t),e=!0),this.Xr=t,e}onError(t){this.Jr.error(t)}zr(t){this.onlineState=t;let e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e}eo(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)}Zr(t){if(t.docChanges.length>0)return!0;const e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}no(t){t=Ah.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)}}class Mh{constructor(t,e){this.payload=t,this.byteLength=e}io(){return"metadata"in this.payload}}class Fh{constructor(t){this.R=t}Un(t){return Ko(this.R,t)}qn(t){return t.metadata.exists?Yo(this.R,t.document,!1):js.newNoDocument(this.Un(t.metadata.name),this.Kn(t.metadata.readTime))}Kn(t){return qo(t)}}class Ph{constructor(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=Vh(t)}oo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}co(t){const e=new Map,n=new Fh(this.R);for(const r of t)if(r.metadata.queries){const t=n.Un(r.metadata.name);for(const n of r.metadata.queries){const r=(e.get(n)||Eo()).add(t);e.set(n,r)}}return e}async complete(){const t=await async function(t,e,n,r){const s=Jr(t);let i=Eo(),o=po(),a=bo();for(const t of n){const n=e.Un(t.metadata.name);t.document&&(i=i.add(n)),o=o.insert(n,e.qn(t)),a=a.insert(n,e.Kn(t.metadata.readTime))}const c=s.Fn.newChangeBuffer({trackRemovals:!0}),u=await au(s,function(t){return wi(li(hs.fromString(`__bundle__/docs/${t}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",(t=>iu(t,c,o,is.min(),a).next((e=>(c.apply(t),e))).next((e=>s.Ue.removeMatchingKeysForTargetId(t,u.targetId).next((()=>s.Ue.addMatchingKeys(t,i,u.targetId))).next((()=>s.Mn.En(t,e))).next((()=>e))))))}(this.localStore,new Fh(this.R),this.documents,this.ro.id),e=this.co(this.documents);for(const t of this.queries)await du(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new Xc(Object.assign({},this.progress),t)}}function Vh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class Uh{constructor(t){this.key=t}}class qh{constructor(t){this.key=t}}class Bh{constructor(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Eo(),this.mutatedKeys=Eo(),this.lo=Si(t),this.fo=new Sh(this.lo)}get wo(){return this.uo}_o(t,e){const n=e?e.mo:new _h,r=e?e.fo:this.fo;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a=di(this.query)&&r.size===this.query.limit?r.last():null,c=fi(this.query)&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Ii(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.yo(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.lo(h,a)>0||c&&this.lo(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),di(this.query)||fi(this.query))for(;i.size>this.query.limit;){const t=di(this.query)?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{fo:i,mo:n,Nn:o,mutatedKeys:s}}yo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;const s=t.mo.Qr();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Yr()}};return n(t)-n(e)}(t.type,e.type)||this.lo(t.doc,e.doc))),this.po(n);const i=e?this.Eo():[],o=0===this.ho.size&&this.current?1:0,a=o!==this.ao;return this.ao=o,0!==s.length||a?{snapshot:new Ah(this.query,t.fo,r,s,t.mutatedKeys,0===o,a,!1),To:i}:{To:i}}zr(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new _h,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}}Io(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations}po(t){t&&(t.addedDocuments.forEach((t=>this.uo=this.uo.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.uo=this.uo.delete(t))),this.current=t.current)}Eo(){if(!this.current)return[];const t=this.ho;this.ho=Eo(),this.fo.forEach((t=>{this.Io(t.key)&&(this.ho=this.ho.add(t.key))}));const e=[];return t.forEach((t=>{this.ho.has(t)||e.push(new qh(t))})),this.ho.forEach((n=>{t.has(n)||e.push(new Uh(n))})),e}Ao(t){this.uo=t.Bn,this.ho=Eo();const e=this._o(t.documents);return this.applyChanges(e,!0)}Ro(){return Ah.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)}}class jh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class $h{constructor(t){this.key=t,this.Po=!1}}class Kh{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.bo={},this.vo=new Pc((t=>Ti(t)),bi),this.Vo=new Map,this.So=new Set,this.Do=new uo(_s.comparator),this.Co=new Map,this.No=new gu,this.xo={},this.ko=new Map,this.$o=_c.Yt(),this.onlineState="Unknown",this.Oo=void 0}get isPrimaryClient(){return!0===this.Oo}}async function Gh(t,e){const n=yl(t);let r,s;const i=n.vo.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Ro();else{const t=await au(n.localStore,wi(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await zh(n,e,r,"current"===i),n.isPrimaryClient&&Xu(n.remoteStore,t)}return s}async function zh(t,e,n,r){t.Fo=(e,n,r)=>async function(t,e,n,r){let s=e.view._o(n);s.Nn&&(s=await uu(t.localStore,e.query,!1).then((({documents:t})=>e.view._o(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,i);return rl(t,e.targetId,o.To),o.snapshot}(t,e,n,r);const s=await uu(t.localStore,e,!0),i=new Bh(e,s.Bn),o=i._o(s.documents),a=Ao.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=i.applyChanges(o,t.isPrimaryClient,a);rl(t,n,c.To);const u=new jh(e,n,i);return t.vo.set(e,u),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot}async function Hh(t,e){const n=Jr(t),r=n.vo.get(e),s=n.Vo.get(r.targetId);if(s.length>1)return n.Vo.set(r.targetId,s.filter((t=>!bi(t,e)))),void n.vo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await cu(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Ju(n.remoteStore,r.targetId),el(n,r.targetId)})).catch(xc)):(el(n,r.targetId),await cu(n.localStore,r.targetId,!0))}async function Qh(t,e){const n=Jr(t);try{const t=await function(t,e){const n=Jr(t),r=e.snapshotVersion;let s=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Fn.newChangeBuffer({trackRemovals:!0});s=n.kn;const o=[];e.targetChanges.forEach(((e,i)=>{const a=s.get(i);if(!a)return;o.push(n.Ue.removeMatchingKeys(t,e.removedDocuments,i).next((()=>n.Ue.addMatchingKeys(t,e.addedDocuments,i))));const c=e.resumeToken;if(c.approximateByteSize()>0){const u=a.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber);s=s.insert(i,u),function(t,e,n){return Xr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,e)&&o.push(n.Ue.updateTargetData(t,u))}}));let a=po();if(e.documentUpdates.forEach(((r,s)=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(iu(t,i,e.documentUpdates,r,void 0).next((t=>{a=t}))),!r.isEqual(is.min())){const e=n.Ue.getLastRemoteSnapshotVersion(t).next((e=>n.Ue.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return Pa.waitFor(o).next((()=>i.apply(t))).next((()=>n.Mn.En(t,a))).next((()=>a))})).then((t=>(n.kn=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Co.get(e);r&&(Xr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Po=!0:t.modifiedDocuments.size>0?Xr(r.Po):t.removedDocuments.size>0&&(Xr(r.Po),r.Po=!1))})),await ol(n,t,e)}catch(t){await xc(t)}}function Wh(t,e,n){const r=Jr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.vo.forEach(((n,r)=>{const s=r.view.zr(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Jr(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.zr(e)&&(r=!0)})),r&&Lh(n)}(r.eventManager,e),t.length&&r.bo._r(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Yh(t,e,n){const r=Jr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Co.get(e),i=s&&s.key;if(i){let t=new uo(_s.comparator);t=t.insert(i,js.newNoDocument(i,is.min()));const n=Eo().add(i),s=new _o(is.min(),new Map,new fo(es),t,n);await Qh(r,s),r.Do=r.Do.remove(i),r.Co.delete(e),il(r)}else await cu(r.localStore,e,!1).then((()=>el(r,e,n))).catch(xc)}async function Xh(t,e){const n=Jr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Jr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Fn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Pa.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);Xr(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),o.next((()=>t._n.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n._n.performConsistencyCheck(t))).next((()=>n.Mn.pn(t,r)))}))}(n.localStore,e);tl(n,r,null),Zh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await ol(n,t)}catch(t){await xc(t)}}async function Jh(t,e,n){const r=Jr(t);try{const t=await function(t,e){const n=Jr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n._n.lookupMutationBatch(t,e).next((e=>(Xr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)))).next((()=>n._n.performConsistencyCheck(t))).next((()=>n.Mn.pn(t,r)))}))}(r.localStore,e);tl(r,e,n),Zh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await ol(r,t)}catch(n){await xc(n)}}function Zh(t,e){(t.ko.get(e)||[]).forEach((t=>{t.resolve()})),t.ko.delete(e)}function tl(t,e,n){const r=Jr(t);let s=r.xo[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.xo[r.currentUser.toKey()]=s}}function el(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Vo.get(e))t.vo.delete(r),n&&t.bo.Mo(r,n);t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((e=>{t.No.containsKey(e)||nl(t,e)}))}function nl(t,e){t.So.delete(e.path.canonicalString());const n=t.Do.get(e);null!==n&&(Ju(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),il(t))}function rl(t,e,n){for(const r of n)r instanceof Uh?(t.No.addReference(r.key,e),sl(t,r)):r instanceof qh?(zr("SyncEngine","Document no longer in limbo: "+r.key),t.No.removeReference(r.key,e),t.No.containsKey(r.key)||nl(t,r.key)):Yr()}function sl(t,e){const n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(zr("SyncEngine","New document in limbo: "+n),t.So.add(r),il(t))}function il(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){const e=t.So.values().next().value;t.So.delete(e);const n=new _s(hs.fromString(e)),r=t.$o.next();t.Co.set(r,new $h(n)),t.Do=t.Do.insert(n,r),Xu(t.remoteStore,new Xa(wi(li(n.path)),r,2,qr.o))}}async function ol(t,e,n){const r=Jr(t),s=[],i=[],o=[];r.vo.isEmpty()||(r.vo.forEach(((t,a)=>{o.push(r.Fo(a,e,n).then((t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=Zc.vn(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.bo._r(s),await async function(t,e){const n=Jr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Pa.forEach(e,(e=>Pa.forEach(e.Pn,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>Pa.forEach(e.bn,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!ja(t))throw t;zr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.kn.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.kn=n.kn.insert(e,s)}}}(r.localStore,i))}async function al(t,e){const n=Jr(t);if(!n.currentUser.isEqual(e)){zr("SyncEngine","User change. New user:",e.toKey());const t=await ru(n.localStore,e);n.currentUser=e,function(t,e){t.ko.forEach((t=>{t.forEach((t=>{t.reject(new jr(Br.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ol(n,t.Ln)}}function cl(t,e){const n=Jr(t),r=n.Co.get(e);if(r&&r.Po)return Eo().add(r.key);{let t=Eo();const r=n.Vo.get(e);if(!r)return t;for(const e of r){const r=n.vo.get(e);t=t.unionWith(r.view.wo)}return t}}async function ul(t,e){const n=Jr(t),r=await uu(n.localStore,e.query,!0),s=e.view.Ao(r);return n.isPrimaryClient&&rl(n,e.targetId,s.To),s}async function hl(t){const e=Jr(t);return lu(e.localStore).then((t=>ol(e,t)))}async function ll(t,e,n,r){const s=Jr(t),i=await function(t,e){const n=Jr(t),r=Jr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>r.Qt(t,e).next((e=>e?n.Mn.pn(t,e):Pa.resolve(null)))))}(s.localStore,e);null!==i?("pending"===n?await hh(s.remoteStore):"acknowledged"===n||"rejected"===n?(tl(s,e,r||null),Zh(s,e),function(t,e){Jr(Jr(t)._n).Gt(e)}(s.localStore,e)):Yr(),await ol(s,i)):zr("SyncEngine","Cannot apply mutation batch with id: "+e)}async function dl(t,e,n){const r=Jr(t),s=[],i=[];for(const t of e){let e;const n=r.Vo.get(t);if(n&&0!==n.length){e=await au(r.localStore,wi(n[0]));for(const t of n){const e=r.vo.get(t),n=await ul(r,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await hu(r.localStore,t);e=await au(r.localStore,n),await zh(r,fl(n),t,!1)}s.push(e)}return r.bo._r(i),s}function fl(t){return hi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function gl(t){const e=Jr(t);return Jr(Jr(e.localStore).persistence).fn()}async function ml(t,e,n,r){const s=Jr(t);if(s.Oo)zr("SyncEngine","Ignoring unexpected query state notification.");else if(s.Vo.has(e))switch(n){case"current":case"not-current":{const t=await lu(s.localStore),r=_o.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await ol(s,t,r);break}case"rejected":await cu(s.localStore,e,!0),el(s,e,r);break;default:Yr()}}async function pl(t,e,n){const r=yl(t);if(r.Oo){for(const t of e){if(r.Vo.has(t)){zr("SyncEngine","Adding an already active target "+t);continue}const e=await hu(r.localStore,t),n=await au(r.localStore,e);await zh(r,fl(e),n.targetId,!1),Xu(r.remoteStore,n)}for(const t of n)r.Vo.has(t)&&await cu(r.localStore,t,!1).then((()=>{Ju(r.remoteStore,t),el(r,t)})).catch(xc)}}function yl(t){const e=Jr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=cl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yh.bind(null,e),e.bo._r=kh.bind(null,e.eventManager),e.bo.Mo=Rh.bind(null,e.eventManager),e}function wl(t){const e=Jr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Xh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Jh.bind(null,e),e}class vl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.R=Bu(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.Uo(t),await this.persistence.start(),this.gcScheduler=this.qo(t),this.localStore=this.Ko(t)}qo(t){return null}Ko(t){return nu(this.persistence,new tu,t.initialUser,this.R)}Uo(t){return new bu(Eu.Ps,this.R)}Bo(t){return new Lu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class bl extends vl{constructor(t,e,n){super(),this.jo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=Jr(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=jc(t);let n=is.min();return e.Ot({index:Sa.readTimeIndex,reverse:!0},((t,e,r)=>{e.readTime&&(n=nc(e.readTime)),r.done()})).next((()=>n))}(t))).then((t=>{e.On=t}))}(this.localStore),await this.jo.initialize(this,t),await wl(this.jo.syncEngine),await hh(this.jo.remoteStore)}Ko(t){return nu(this.persistence,new tu,t.initialUser,this.R)}qo(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Lc(e,t.asyncQueue)}Uo(t){const e=Yc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?yc.withCacheSize(this.cacheSizeBytes):yc.DEFAULT;return new Hc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Uu(),qu(),this.R,this.sharedClientState,!!this.forceOwnership)}Bo(t){return new Lu}}class Tl extends bl{constructor(t,e){super(t,e,!1),this.jo=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.jo.syncEngine;this.sharedClientState instanceof Ru&&(this.sharedClientState.syncEngine={ui:ll.bind(null,e),ai:ml.bind(null,e),hi:pl.bind(null,e),fn:gl.bind(null,e),ci:hl.bind(null,e)},await this.sharedClientState.start()),await this.persistence.He((async t=>{await async function(t,e){const n=Jr(t);if(yl(n),wl(n),!0===e&&!0!==n.Oo){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await dl(n,t.toArray());n.Oo=!0,await vh(n.remoteStore,!0);for(const t of e)Xu(n.remoteStore,t)}else if(!1===e&&!1!==n.Oo){const t=[];let e=Promise.resolve();n.Vo.forEach(((r,s)=>{n.sharedClientState.isLocalQueryTarget(s)?t.push(s):e=e.then((()=>(el(n,s),cu(n.localStore,s,!0)))),Ju(n.remoteStore,s)})),await e,await dl(n,t),function(t){const e=Jr(t);e.Co.forEach(((t,n)=>{Ju(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new uo(_s.comparator)}(n),n.Oo=!1,await vh(n.remoteStore,!1)}}(this.jo.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}Bo(t){const e=Uu();if(!Ru.gt(e))throw new jr(Br.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Yc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Ru(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class El{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Wh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=al.bind(null,this.syncEngine),await vh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Nh}createDatastore(t){const e=Bu(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new Vu(r));var r;return function(t,e,n){return new zu(t,e,n)}(t.credentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,s=t=>Wh(this.syncEngine,t,0),i=Mu.gt()?new Mu:new Ou,new Qu(e,n,r,s,i);var e,n,r,s,i}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Kh(t,e,n,r,s,i);return o&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Jr(t);zr("RemoteStore","RemoteStore shutting down."),e.Fr.add(5),await Yu(e),e.Lr.shutdown(),e.Br.set("Unknown")}(this.remoteStore)}}function Il(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Sl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Qo(this.observer.next,t)}error(t){this.observer.error?this.Qo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Wo(){this.muted=!0}Qo(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class _l{constructor(t,e){this.Go=t,this.R=e,this.metadata=new Fa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((t=>{t&&t.io()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Go.cancel()}async getMetadata(){return this.metadata.promise}async Lo(){return await this.getMetadata(),this.Ho()}async Ho(){const t=await this.Jo();if(null===t)return null;const e=this.zo.decode(t),n=Number(e);isNaN(n)&&this.Yo(`length string (${e}) is not valid number`);const r=await this.Xo(n);return new Mh(JSON.parse(r),t.length+n)}Zo(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async Jo(){for(;this.Zo()<0&&!await this.tc(););if(0===this.buffer.length)return null;const t=this.Zo();t<0&&this.Yo("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async Xo(t){for(;this.buffer.length<t;)await this.tc()&&this.Yo("Reached the end of bundle when more is expected.");const e=this.zo.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Yo(t){throw this.Go.cancel(),new Error(`Invalid bundle format: ${t}`)}async tc(){const t=await this.Go.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Al{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new jr(Br.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Jr(t),r=Ho(n.R)+"/documents",s={documents:e.map((t=>$o(n.R,t)))},i=await n.Oi("BatchGetDocuments",r,s),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){Xr(!!e.found),e.found.name,e.found.updateTime;const n=Ko(t,e.found.name),r=qo(e.found.updateTime),s=new qs({mapValue:{fields:e.found.fields}});return js.newFoundDocument(n,r,s)}(t,e):"missing"in e?function(t,e){Xr(!!e.missing),Xr(!!e.readTime);const n=Ko(t,e.missing),r=qo(e.readTime);return js.newNoDocument(n,r)}(t,e):Yr()}(n.R,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());Xr(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new no(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=_s.fromPath(e);this.mutations.push(new ro(n,this.precondition(n)))})),await async function(t,e){const n=Jr(t),r=Ho(n.R)+"/documents",s={writes:e.map((t=>Xo(n.R,t)))};await n.Ni("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Yr();e=is.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new jr(Br.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?$i.updateTime(e):$i.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(is.min()))throw new jr(Br.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $i.updateTime(e)}return $i.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class Dl{constructor(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new ju(this.asyncQueue,"transaction_retry")}run(){this.ec-=1,this.nc()}nc(){this.Zi.Qi((async()=>{const t=new Al(this.datastore),e=this.sc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.ic(t)}))))})).catch((t=>{this.ic(t)}))}))}sc(t){try{const e=this.updateFunction(t);return!Es(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ic(t){this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((()=>(this.nc(),Promise.resolve())))):this.deferred.reject(t)}rc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!ao(e)}return!1}}class Nl{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Iu.UNAUTHENTICATED,this.clientId=ts.u(),this.credentialListener=()=>Promise.resolve(),this.credentials.setChangeListener(e,(async t=>{zr("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t}))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new jr(Br.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Fa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.removeChangeListener(),t.resolve()}catch(e){const n=Ih(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Cl(t,e){t.asyncQueue.verifyOperationInProgress(),zr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await ru(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function xl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await kl(t);zr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>async function(t,e){const n=Jr(t);n.asyncQueue.verifyOperationInProgress(),zr("RemoteStore","RemoteStore received new credentials");const r=rh(n);n.Fr.add(3),await Yu(n),r&&n.Br.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Fr.delete(3),await Wu(n)}(e.remoteStore,t))),t.onlineComponents=e}async function kl(t){return t.offlineComponents||(zr("FirestoreClient","Using default OfflineComponentProvider"),await Cl(t,new vl)),t.offlineComponents}async function Rl(t){return t.onlineComponents||(zr("FirestoreClient","Using default OnlineComponentProvider"),await xl(t,new El)),t.onlineComponents}function Ll(t){return kl(t).then((t=>t.persistence))}function Ol(t){return kl(t).then((t=>t.localStore))}function Ml(t){return Rl(t).then((t=>t.remoteStore))}function Fl(t){return Rl(t).then((t=>t.syncEngine))}async function Pl(t){const e=await Rl(t),n=e.eventManager;return n.onListen=Gh.bind(null,e.syncEngine),n.onUnlisten=Hh.bind(null,e.syncEngine),n}function Vl(t,e,n={}){const r=new Fa;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new Sl({next:i=>{e.enqueueAndForget((()=>xh(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new jr(Br.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new jr(Br.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new Oh(li(n.path),i,{includeMetadataChanges:!0,so:!0});return Ch(t,o)}(await Pl(t),t.asyncQueue,e,n,r))),r.promise}function Ul(t,e,n={}){const r=new Fa;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new Sl({next:n=>{e.enqueueAndForget((()=>xh(t,o))),n.fromCache&&"server"===r.source?s.reject(new jr(Br.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new Oh(n,i,{includeMetadataChanges:!0,so:!0});return Ch(t,o)}(await Pl(t),t.asyncQueue,e,n,r))),r.promise}function ql(t,e,n,r){const s=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new _l(t,e)}(function(t,e){if(t instanceof Uint8Array)return Il(t,e);if(t instanceof ArrayBuffer)return Il(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Bu(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const r=Jr(t);(async function(t,e,n){try{const r=await e.getMetadata();if(await function(t,e){const n=Jr(t),r=qo(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Ke.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(r)>=0))}(t.localStore,r))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r));n._updateProgress(Vh(r));const s=new Ph(r,t.localStore,e.R);let i=await e.Lo();for(;i;){const t=await s.oo(i);t&&n._updateProgress(t),i=await e.Lo()}const o=await s.complete();await ol(t,o.wn,void 0),await function(t,e){const n=Jr(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Ke.saveBundleMetadata(t,e)))}(t.localStore,r),n._completeWith(o.progress)}catch(t){Qr("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(r,e,n).then((()=>{r.sharedClientState.notifyBundleLoaded()}))}(await Fl(t),s,r)}))}class Bl{constructor(t,e,n,r,s,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class jl{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof jl&&t.projectId===this.projectId&&t.database===this.database}}const $l=new Map;class Kl{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class Gl{constructor(){this.changeListener=null}getToken(){return Promise.resolve(null)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(Iu.UNAUTHENTICATED)))}removeChangeListener(){this.changeListener=null}}class zl{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}setChangeListener(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}removeChangeListener(){this.changeListener=null}}class Hl{constructor(t){this.currentUser=Iu.UNAUTHENTICATED,this.oc=new Fa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=()=>{this.cc++,this.currentUser=this.ac(),this.oc.resolve(),this.changeListener&&this.asyncQueue.enqueueRetryable((()=>this.changeListener(this.currentUser)))};const e=t=>{zr("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.uc)};t.onInit((t=>e(t))),setTimeout((()=>{if(!this.auth){const n=t.getImmediate({optional:!0});n?e(n):(zr("FirebaseCredentialsProvider","Auth not yet detected"),this.oc.resolve())}}),0)}getToken(){const t=this.cc,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.cc!==t?(zr("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Xr("string"==typeof e.accessToken),new Kl(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}setChangeListener(t,e){this.asyncQueue=t,this.asyncQueue.enqueueRetryable((async()=>{await this.oc.promise,await e(this.currentUser),this.changeListener=e}))}removeChangeListener(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=()=>Promise.resolve()}ac(){const t=this.auth&&this.auth.getUid();return Xr(null===t||"string"==typeof t),new Iu(t)}}class Ql{constructor(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Iu.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t}}class Wl{constructor(t,e,n){this.hc=t,this.lc=e,this.fc=n}getToken(){return Promise.resolve(new Ql(this.hc,this.lc,this.fc))}setChangeListener(t,e){t.enqueueRetryable((()=>e(Iu.FIRST_PARTY)))}removeChangeListener(){}invalidateToken(){}}function Yl(t,e,n){if(!n)throw new jr(Br.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Xl(t){if(!_s.isDocumentKey(t))throw new jr(Br.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Jl(t){if(_s.isDocumentKey(t))throw new jr(Br.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Zl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Yr()}function td(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new jr(Br.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Zl(t);throw new jr(Br.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function ed(t,e){if(e<=0)throw new jr(Br.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class nd{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new jr(Br.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new jr(Br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,r){if(!0===e&&!0===r)throw new jr(Br.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class rd{constructor(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nd({}),this._settingsFrozen=!1,t instanceof jl?(this._databaseId=t,this._credentials=new Gl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new jr(Br.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jl(t.options.projectId)}(t),this._credentials=new Hl(e))}get app(){if(!this._app)throw new jr(Br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new jr(Br.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nd(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Gl;switch(t.type){case"gapi":const e=t.client;return Xr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Wl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new jr(Br.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=$l.get(t);e&&(zr("ComponentProvider","Removing Datastore"),$l.delete(t),e.terminate())}(this),Promise.resolve()}}function sd(t,e,n,r={}){const s=(t=td(t,rd))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Qr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${n}`,ssl:!1})),r.mockUserToken){const e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var i=a({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[u.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),u.encodeString(JSON.stringify(i),!1),""].join(".")}(r.mockUserToken),n=r.mockUserToken.sub||r.mockUserToken.user_id;if(!n)throw new jr(Br.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new zl(new Kl(e,new Iu(n)))}}class id{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ad(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new id(this.firestore,t,this._key)}}class od{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new od(this.firestore,t,this._query)}}class ad extends od{constructor(t,e,n){super(t,e,li(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new id(this.firestore,null,new _s(t))}withConverter(t){return new ad(this.firestore,t,this._path)}}function cd(t,e,...n){if(t=p(t),Yl("collection","path",e),t instanceof rd){const r=hs.fromString(e,...n);return Jl(r),new ad(t,null,r)}{if(!(t instanceof id||t instanceof ad))throw new jr(Br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=hs.fromString(t.path,...n).child(hs.fromString(e));return Jl(r),new ad(t.firestore,null,r)}}function ud(t,e){if(t=td(t,rd),Yl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new jr(Br.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new od(t,null,function(t){return new ui(hs.emptyPath(),t)}(e))}function hd(t,e,...n){if(t=p(t),1===arguments.length&&(e=ts.u()),Yl("doc","path",e),t instanceof rd){const r=hs.fromString(e,...n);return Xl(r),new id(t,null,new _s(r))}{if(!(t instanceof id||t instanceof ad))throw new jr(Br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(hs.fromString(e,...n));return Xl(r),new id(t.firestore,t instanceof ad?t.converter:null,new _s(r))}}function ld(t,e){return t=p(t),e=p(e),(t instanceof id||t instanceof ad)&&(e instanceof id||e instanceof ad)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function dd(t,e){return t=p(t),e=p(e),t instanceof od&&e instanceof od&&t.firestore===e.firestore&&bi(t._query,e._query)&&t.converter===e.converter}class fd{constructor(){this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.gc=null,this.yc=!1,this.Ec=!1,this.Tc=[],this.Zi=new ju(this,"async_queue_retry"),this.Ic=()=>{const t=qu();t&&zr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Zi.Gi()};const t=qu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ic)}get isShuttingDown(){return this._c}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ac(),this.Rc(t)}enterRestrictedMode(t){if(!this._c){this._c=!0,this.Ec=t||!1;const e=qu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}}enqueue(t){if(this.Ac(),this._c)return new Promise((()=>{}));const e=new Fa;return this.Rc((()=>this._c&&this.Ec?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.wc.push(t),this.Pc())))}async Pc(){if(0!==this.wc.length){try{await this.wc[0](),this.wc.shift(),this.Zi.reset()}catch(t){if(!ja(t))throw t;zr("AsyncQueue","Operation failed with retryable error: "+t)}this.wc.length>0&&this.Zi.Qi((()=>this.Pc()))}}Rc(t){const e=this.dc.then((()=>(this.yc=!0,t().catch((t=>{throw this.gc=t,this.yc=!1,Hr("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((t=>(this.yc=!1,t))))));return this.dc=e,e}enqueueAfterDelay(t,e,n){this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);const r=Eh.createAndSchedule(this,t,e,n,(t=>this.bc(t)));return this.mc.push(r),r}Ac(){this.gc&&Yr()}verifyOperationInProgress(){}async vc(){let t;do{t=this.dc,await t}while(t!==this.dc)}Vc(t){for(const e of this.mc)if(e.timerId===t)return!0;return!1}Sc(t){return this.vc().then((()=>{this.mc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.mc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.vc()}))}Dc(t){this.Tc.push(t)}bc(t){const e=this.mc.indexOf(t);this.mc.splice(e,1)}}function gd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class md{constructor(){this._progressObserver={},this._taskCompletionResolver=new Fa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const pd=-1;class yd extends rd{constructor(t,e){super(t,e),this.type="firestore",this._queue=new fd,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Td(this),this._firestoreClient.terminate()}}function wd(e,n){const r=t(e,"firestore-exp");if(r.isInitialized())throw new jr(Br.FAILED_PRECONDITION,"Firestore can only be initialized once per app.");if(void 0!==n.cacheSizeBytes&&-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new jr(Br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:n})}function vd(n=e()){return t(n,"firestore-exp").getImmediate()}function bd(t){return t._firestoreClient||Td(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Td(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new Bl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Nl(t._credentials,t._queue,r)}function Ed(t,e){Rd(t=td(t,yd));const n=bd(t),r=t._freezeSettings(),s=new El;return Sd(n,s,new bl(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function Id(t){Rd(t=td(t,yd));const e=bd(t),n=t._freezeSettings(),r=new El;return Sd(e,r,new Tl(r,n.cacheSizeBytes))}function Sd(t,e,n){const r=new Fa;return t.asyncQueue.enqueue((async()=>{try{await Cl(t,n),await xl(t,e),r.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===Br.FAILED_PRECONDITION||t.code===Br.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}function _d(t){if(t._initialized&&!t._terminated)throw new jr(Br.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Fa;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Ua.gt())return Promise.resolve();const e=t+"main";await Ua.delete(e)}(Yc(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Ad(t){return function(t){const e=new Fa;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=Jr(t);rh(n.remoteStore)||zr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=Jr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e._n.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const r=n.ko.get(t)||[];r.push(e),n.ko.set(t,r)}catch(t){const n=Ih(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Fl(t),e))),e.promise}(bd(t=td(t,yd)))}function Dd(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Ll(t),n=await Ml(t);return e.setNetworkEnabled(!0),function(t){const e=Jr(t);return e.Fr.delete(0),Wu(e)}(n)}))}(bd(t=td(t,yd)))}function Nd(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await Ll(t),n=await Ml(t);return e.setNetworkEnabled(!1),async function(t){const e=Jr(t);e.Fr.add(0),await Yu(e),e.Br.set("Offline")}(n)}))}(bd(t=td(t,yd)))}function Cd(t){return n(t.app,"firestore-exp"),t._delete()}function xd(t,e){const n=bd(t=td(t,yd)),r=new md;return ql(n,t._databaseId,e,r),r}function kd(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=Jr(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Ke.getNamedQuery(t,e)))}(await Ol(t),e)))}(bd(t=td(t,yd)),e).then((e=>e?new od(t,null,e.query):null))}function Rd(t){if(t._initialized||t._terminated)throw new jr(Br.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ld{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new jr(Br.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ds(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function Od(){return new Ld("__name__")}class Md{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Md(gs.fromBase64String(t))}catch(t){throw new jr(Br.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Md(gs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Fd{constructor(t){this._methodName=t}}class Pd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new jr(Br.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new jr(Br.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return es(this._lat,t._lat)||es(this._long,t._long)}}const Vd=/^__.*__$/;class Ud{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ji(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xi(t,this.data,e,this.fieldTransforms)}}class qd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ji(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Bd(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Yr()}}class jd{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Cc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Nc(){return this.settings.Nc}xc(t){return new jd(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}kc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,$c:!1});return r.Oc(t),r}Fc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,$c:!1});return r.Cc(),r}Mc(t){return this.xc({path:void 0,$c:!0})}Lc(t){return uf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.Uc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Cc(){if(this.path)for(let t=0;t<this.path.length;t++)this.Oc(this.path.get(t))}Oc(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Bd(this.Nc)&&Vd.test(t))throw this.Lc('Document fields cannot begin and end with "__"')}}class $d{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Bu(t)}qc(t,e,n,r=!1){return new jd({Nc:t,methodName:e,Uc:n,path:ds.emptyPath(),$c:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)}}function Kd(t){const e=t._freezeSettings(),n=Bu(t._databaseId);return new $d(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Gd(t,e,n,r,s,i={}){const o=t.qc(i.merge||i.mergeFields?2:0,e,n,s);sf("Data must be an object, but it was:",o,r);const a=nf(r,o);let c,u;if(i.merge)c=new fs(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=of(e,r,n);if(!o.contains(s))throw new jr(Br.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);hf(t,s)||t.push(s)}c=new fs(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Ud(new qs(a),c,u)}class zd extends Fd{_toFieldTransform(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(`${this._methodName}() can only appear at the top level of your update data`):t.Lc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof zd}}function Hd(t,e,n){return new jd({Nc:3,Uc:e.settings.Uc,methodName:t._methodName,$c:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}class Qd extends Fd{_toFieldTransform(t){return new Bi(t.path,new Li)}isEqual(t){return t instanceof Qd}}class Wd extends Fd{constructor(t,e){super(t),this.Kc=e}_toFieldTransform(t){const e=Hd(this,t,!0),n=this.Kc.map((t=>ef(t,e))),r=new Oi(n);return new Bi(t.path,r)}isEqual(t){return this===t}}class Yd extends Fd{constructor(t,e){super(t),this.Kc=e}_toFieldTransform(t){const e=Hd(this,t,!0),n=this.Kc.map((t=>ef(t,e))),r=new Fi(n);return new Bi(t.path,r)}isEqual(t){return this===t}}class Xd extends Fd{constructor(t,e){super(t),this.jc=e}_toFieldTransform(t){const e=new Vi(t.R,Ni(t.R,this.jc));return new Bi(t.path,e)}isEqual(t){return this===t}}function Jd(t,e,n,r){const s=t.qc(1,e,n);sf("Data must be an object, but it was:",s,r);const i=[],o=qs.empty();as(r,((t,r)=>{const a=cf(e,t,n);r=p(r);const c=s.Fc(a);if(r instanceof zd)i.push(a);else{const t=ef(r,c);null!=t&&(i.push(a),o.set(a,t))}}));const a=new fs(i);return new qd(o,a,s.fieldTransforms)}function Zd(t,e,n,r,s,i){const o=t.qc(1,e,n),a=[of(e,r,n)],c=[s];if(i.length%2!=0)throw new jr(Br.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(of(e,i[t])),c.push(i[t+1]);const u=[],h=qs.empty();for(let t=a.length-1;t>=0;--t)if(!hf(u,a[t])){const e=a[t];let n=c[t];n=p(n);const r=o.Fc(e);if(n instanceof zd)u.push(e);else{const t=ef(n,r);null!=t&&(u.push(e),h.set(e,t))}}const l=new fs(u);return new qd(h,l,o.fieldTransforms)}function tf(t,e,n,r=!1){return ef(n,t.qc(r?4:3,e))}function ef(t,e){if(rf(t=p(t)))return sf("Unsupported field value:",e,t),nf(t,e);if(t instanceof Fd)return function(t,e){if(!Bd(e.Nc))throw e.Lc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Lc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.$c&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=ef(s,e.Mc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=p(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ni(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ss.fromDate(t);return{timestampValue:Po(e.R,n)}}if(t instanceof ss){const n=new ss(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Po(e.R,n)}}if(t instanceof Pd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Md)return{bytesValue:Vo(e.R,t._byteString)};if(t instanceof id){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Bo(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc(`Unsupported field value: ${Zl(t)}`)}(t,e)}function nf(t,e){const n={};return cs(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):as(t,((t,r)=>{const s=ef(r,e.kc(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function rf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ss||t instanceof Pd||t instanceof Md||t instanceof id||t instanceof Fd)}function sf(t,e,n){if(!rf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Zl(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function of(t,e,n){if((e=p(e))instanceof Ld)return e._internalPath;if("string"==typeof e)return cf(t,e);throw uf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const af=new RegExp("[~\\*/\\[\\]]");function cf(t,e,n){if(e.search(af)>=0)throw uf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ld(...e.split("."))._internalPath}catch(r){throw uf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function uf(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new jr(Br.INVALID_ARGUMENT,a+t+c)}function hf(t,e){return t.some((t=>t.isEqual(e)))}class lf{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new id(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new df(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(ff("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class df extends lf{data(){return super.data()}}function ff(t,e){return"string"==typeof e?cf(t,e):e instanceof Ld?e._internalPath:e._delegate._internalPath}class gf{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class mf extends lf{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new pf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(ff("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class pf extends mf{data(t={}){return super.data(t)}}class yf{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new gf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new pf(this._firestore,this._userDataWriter,n.key,n,new gf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new jr(Br.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new pf(t._firestore,t._userDataWriter,n.doc.key,n.doc,new gf(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new pf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new gf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:wf(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function wf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Yr()}}function vf(t,e){return t instanceof mf&&e instanceof mf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof yf&&e instanceof yf&&t._firestore===e._firestore&&dd(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function bf(t){if(fi(t)&&0===t.explicitOrderBy.length)throw new jr(Br.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Tf{}function Ef(t,...e){for(const n of e)t=n._apply(t);return t}class If extends Tf{constructor(t,e,n){super(),this.Qc=t,this.Wc=e,this.Gc=n,this.type="where"}_apply(t){const e=Kd(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new jr(Br.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Vf(o,i);const e=[];for(const n of o)e.push(Pf(r,t,n));a={arrayValue:{values:e}}}else a=Pf(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Vf(o,i),a=tf(n,"where",o,"in"===i||"not-in"===i);const c=Qs.create(s,i,a);return function(t,e){if(e.g()){const n=mi(t);if(null!==n&&!n.isEqual(e.field))throw new jr(Br.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=gi(t);null!==r&&Uf(t,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new jr(Br.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new jr(Br.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Wc,this.Gc);return new od(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Sf(t,e,n){const r=e,s=ff("where",t);return new If(s,r,n)}class _f extends Tf{constructor(t,e){super(),this.Qc=t,this.zc=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new ii(e,n);return function(t,e){if(null===gi(t)){const n=mi(t);null!==n&&Uf(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.zc);return new od(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new ui(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Af(t,e="asc"){const n=e,r=ff("orderBy",t);return new _f(r,n)}class Df extends Tf{constructor(t,e,n){super(),this.type=t,this.Hc=e,this.Jc=n}_apply(t){return new od(t.firestore,t.converter,vi(t._query,this.Hc,this.Jc))}}function Nf(t){return ed("limit",t),new Df("limit",t,"F")}function Cf(t){return ed("limitToLast",t),new Df("limitToLast",t,"L")}class xf extends Tf{constructor(t,e,n){super(),this.type=t,this.Yc=e,this.Xc=n}_apply(t){const e=Ff(t,this.type,this.Yc,this.Xc);return new od(t.firestore,t.converter,function(t,e){return new ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function kf(...t){return new xf("startAt",t,!0)}function Rf(...t){return new xf("startAfter",t,!1)}class Lf extends Tf{constructor(t,e,n){super(),this.type=t,this.Yc=e,this.Xc=n}_apply(t){const e=Ff(t,this.type,this.Yc,this.Xc);return new od(t.firestore,t.converter,function(t,e){return new ui(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Of(...t){return new Lf("endBefore",t,!0)}function Mf(...t){return new Lf("endAt",t,!1)}function Ff(t,e,n,r){if(n[0]=p(n[0]),n[0]instanceof lf)return function(t,e,n,r,s){if(!r)throw new jr(Br.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of yi(t))if(n.field.isKeyField())i.push(Ls(e,r.key));else{const t=r.data.field(n.field);if(vs(t))throw new jr(Br.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new jr(Br.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new ri(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=Kd(t.firestore);return function(t,e,n,r,s,i){const o=t.explicitOrderBy;if(s.length>o.length)throw new jr(Br.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const c=s[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new jr(Br.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!pi(t)&&-1!==c.indexOf("/"))throw new jr(Br.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(hs.fromString(c));if(!_s.isDocumentKey(n))throw new jr(Br.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new _s(n);a.push(Ls(e,s))}else{const t=tf(n,r,c);a.push(t)}}return new ri(a,i)}(t._query,t.firestore._databaseId,s,e,n,r)}}function Pf(t,e,n){if("string"==typeof(n=p(n))){if(""===n)throw new jr(Br.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!pi(e)&&-1!==n.indexOf("/"))throw new jr(Br.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(hs.fromString(n));if(!_s.isDocumentKey(r))throw new jr(Br.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ls(t,new _s(r))}if(n instanceof id)return Ls(t,n._key);throw new jr(Br.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zl(n)}.`)}function Vf(t,e){if(!Array.isArray(t)||0===t.length)throw new jr(Br.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new jr(Br.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Uf(t,e,n){if(!n.isEqual(e))throw new jr(Br.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class qf{convertValue(t,e="none"){switch(As(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ys(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ws(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Yr()}}convertObject(t,e){const n={};return as(t.fields,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Pd(ys(t.latitude),ys(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=bs(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ts(t));default:return null}}convertTimestamp(t){const e=ps(t);return new ss(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=hs.fromString(t);Xr(da(n));const r=new jl(n.get(1),n.get(3)),s=new _s(n.popFirst(5));return r.isEqual(e)||Hr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}function Bf(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class jf extends qf{constructor(t){super(),this.firestore=t}convertBytes(t){return new Md(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new id(this.firestore,null,e)}}class $f{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Kd(t)}set(t,e,n){this._verifyNotCommitted();const r=Kf(t,this._firestore),s=Bf(r.converter,e,n),i=Gd(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,$i.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const s=Kf(t,this._firestore);let i;return i="string"==typeof(e=p(e))||e instanceof Ld?Zd(this._dataReader,"WriteBatch.update",s._key,e,n,r):Jd(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(i.toMutation(s._key,$i.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Kf(t,this._firestore);return this._mutations=this._mutations.concat(new no(e._key,$i.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new jr(Br.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Kf(t,e){if((t=p(t)).firestore!==e)throw new jr(Br.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Gf(t){t=td(t,id);const e=td(t.firestore,yd);return Vl(bd(e),t._key).then((n=>ig(e,t,n)))}class zf extends qf{constructor(t){super(),this.firestore=t}convertBytes(t){return new Md(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new id(this.firestore,null,e)}}function Hf(t){t=td(t,id);const e=td(t.firestore,yd),n=bd(e),r=new zf(e);return function(t,e){const n=new Fa;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await function(t,e){const n=Jr(t);return n.persistence.runTransaction("read document","readonly",(t=>n.Mn.mn(t,e)))}(t,e);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new jr(Br.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const r=Ih(t,`Failed to get document '${e} from cache`);n.reject(r)}}(await Ol(t),e,n))),n.promise}(n,t._key).then((n=>new mf(e,r,t._key,n,new gf(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Qf(t){t=td(t,id);const e=td(t.firestore,yd);return Vl(bd(e),t._key,{source:"server"}).then((n=>ig(e,t,n)))}function Wf(t){t=td(t,od);const e=td(t.firestore,yd),n=bd(e),r=new zf(e);return bf(t._query),Ul(n,t._query).then((n=>new yf(e,r,t,n)))}function Yf(t){t=td(t,od);const e=td(t.firestore,yd),n=bd(e),r=new zf(e);return function(t,e){const n=new Fa;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const r=await uu(t,e,!0),s=new Bh(e,r.Bn),i=s._o(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const r=Ih(t,`Failed to execute query '${e} against cache`);n.reject(r)}}(await Ol(t),e,n))),n.promise}(n,t._query).then((n=>new yf(e,r,t,n)))}function Xf(t){t=td(t,od);const e=td(t.firestore,yd),n=bd(e),r=new zf(e);return Ul(n,t._query,{source:"server"}).then((n=>new yf(e,r,t,n)))}function Jf(t,e,n){t=td(t,id);const r=td(t.firestore,yd),s=Bf(t.converter,e,n);return sg(r,[Gd(Kd(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,$i.none())])}function Zf(t,e,n,...r){t=td(t,id);const s=td(t.firestore,yd),i=Kd(s);let o;return o="string"==typeof(e=p(e))||e instanceof Ld?Zd(i,"updateDoc",t._key,e,n,r):Jd(i,"updateDoc",t._key,e),sg(s,[o.toMutation(t._key,$i.exists(!0))])}function tg(t){return sg(td(t.firestore,yd),[new no(t._key,$i.none())])}function eg(t,e){const n=td(t.firestore,yd),r=hd(t),s=Bf(t.converter,e);return sg(n,[Gd(Kd(t.firestore),"addDoc",r._key,s,null!==t.converter,{}).toMutation(r._key,$i.exists(!1))]).then((()=>r))}function ng(t,...e){var n,r,s;t=p(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||gd(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(gd(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let c,u,h;if(t instanceof id)u=td(t.firestore,yd),h=li(t._key.path),c={next:n=>{e[o]&&e[o](ig(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=td(t,od);u=td(n.firestore,yd),h=n._query;const r=new zf(u);c={next:t=>{e[o]&&e[o](new yf(u,r,n,t))},error:e[o+1],complete:e[o+2]},bf(t._query)}return function(t,e,n,r){const s=new Sl(r),i=new Oh(e,s,n);return t.asyncQueue.enqueueAndForget((async()=>Ch(await Pl(t),i))),()=>{s.Wo(),t.asyncQueue.enqueueAndForget((async()=>xh(await Pl(t),i)))}}(bd(u),h,a,c)}function rg(t,e){return function(t,e){const n=new Sl(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){Jr(t).Gr.add(e),e.next()}(await Pl(t),n))),()=>{n.Wo(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){Jr(t).Gr.delete(e)}(await Pl(t),n)))}}(bd(t=td(t,yd)),gd(e)?e:{next:e})}function sg(t,e){return function(t,e){const n=new Fa;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=wl(t);try{const t=await function(t,e){const n=Jr(t),r=ss.now(),s=e.reduce(((t,e)=>t.add(e.key)),Eo());let i;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Mn.pn(t,s).next((s=>{i=s;const o=[];for(const t of e){const e=Qi(t,i.get(t.key));null!=e&&o.push(new Ji(t.key,e,Bs(e.value.mapValue),$i.exists(!0)))}return n._n.addMutationBatch(t,r,o,e)})))).then((t=>(t.applyToLocalDocumentSet(i),{batchId:t.batchId,changes:i})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.xo[t.currentUser.toKey()];r||(r=new uo(es)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,t.batchId,n),await ol(r,t.changes),await hh(r.remoteStore)}catch(t){const e=Ih(t,"Failed to persist write");n.reject(e)}}(await Fl(t),e,n))),n.promise}(bd(t),e)}function ig(t,e,n){const r=n.docs.get(e._key),s=new zf(t);return new mf(t,s,e._key,r,new gf(n.hasPendingWrites,n.fromCache),e.converter)}class og extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Kd(t)}get(t){const e=Kf(t,this._firestore),n=new jf(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return Yr();const r=t[0];if(r.isFoundDocument())return new lf(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new lf(this._firestore,n,e._key,null,e.converter);throw Yr()}))}set(t,e,n){const r=Kf(t,this._firestore),s=Bf(r.converter,e,n),i=Gd(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(t,e,n,...r){const s=Kf(t,this._firestore);let i;return i="string"==typeof(e=p(e))||e instanceof Ld?Zd(this._dataReader,"Transaction.update",s._key,e,n,r):Jd(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,i),this}delete(t){const e=Kf(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=Kf(t,this._firestore),n=new zf(this._firestore);return super.get(t).then((t=>new mf(this._firestore,n,e._key,t._document,new gf(!1,!1),e.converter)))}}function ag(t,e){return function(t,e){const n=new Fa;return t.asyncQueue.enqueueAndForget((async()=>{const r=await function(t){return Rl(t).then((t=>t.datastore))}(t);new Dl(t.asyncQueue,r,e,n).run()})),n.promise}(bd(t),(n=>e(new og(t,n))))}function cg(){return new zd("deleteField")}function ug(){return new Qd("serverTimestamp")}function hg(...t){return new Wd("arrayUnion",t)}function lg(...t){return new Yd("arrayRemove",t)}function dg(t){return new Xd("increment",t)}function fg(t){return bd(t=td(t,yd)),new $f(t,(e=>sg(t,e)))}Ur=i,r(new v("firestore-exp",((t,{options:e})=>{const n=t.getProvider("app-exp").getImmediate(),r=new yd(n,t.getProvider("auth-internal"));return e=Object.assign({useFetchStreams:!1},e),r._setSettings(e),r}),"PUBLIC")),s("@firebase/firestore","0.0.900-exp.6ef484a04",undefined);export{qf as AbstractUserDataWriter,Md as Bytes,pd as CACHE_SIZE_UNLIMITED,ad as CollectionReference,id as DocumentReference,mf as DocumentSnapshot,Ld as FieldPath,Fd as FieldValue,yd as FirebaseFirestore,jr as FirestoreError,Pd as GeoPoint,md as LoadBundleTask,od as Query,Tf as QueryConstraint,pf as QueryDocumentSnapshot,yf as QuerySnapshot,gf as SnapshotMetadata,ss as Timestamp,og as Transaction,$f as WriteBatch,eg as addDoc,lg as arrayRemove,hg as arrayUnion,_d as clearIndexedDbPersistence,cd as collection,ud as collectionGroup,sd as connectFirestoreEmulator,tg as deleteDoc,cg as deleteField,Nd as disableNetwork,hd as doc,Od as documentId,Ed as enableIndexedDbPersistence,Id as enableMultiTabIndexedDbPersistence,Dd as enableNetwork,Mf as endAt,Of as endBefore,bd as ensureFirestoreConfigured,sg as executeWrite,Gf as getDoc,Hf as getDocFromCache,Qf as getDocFromServer,Wf as getDocs,Yf as getDocsFromCache,Xf as getDocsFromServer,vd as getFirestore,dg as increment,wd as initializeFirestore,Nf as limit,Cf as limitToLast,xd as loadBundle,kd as namedQuery,ng as onSnapshot,rg as onSnapshotsInSync,Af as orderBy,Ef as query,dd as queryEqual,ld as refEqual,ag as runTransaction,ug as serverTimestamp,Jf as setDoc,Gr as setLogLevel,vf as snapshotEqual,Rf as startAfter,kf as startAt,Cd as terminate,Zf as updateDoc,Ad as waitForPendingWrites,Sf as where,fg as writeBatch};
//# sourceMappingURL=firebase-firestore.js.map
